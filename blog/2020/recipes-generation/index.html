<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.10.0"/><meta data-react-helmet="true" name="description" content="I&#x27;ve trained a character-level LSTM RNN on ~100k recipes dataset using TensorFlow, and it suggested me to cook Cream Soda with Onions, Puff Pastry Strawberry Soup, Zucchini flavor Tea and Salmon Mousse of Beef and Stilton Salad with Jalapenos"/><meta data-react-helmet="true" name="image" content="https://trekhleb.dev/static/05340351fcb1004d0e25300d243978cd/c5a76/01-cover.jpg"/><meta data-react-helmet="true" property="og:title" content="Generating cooking recipes using TensorFlow and LSTM Recurrent Neural Network: A step-by-step guide | Trekhleb"/><meta data-react-helmet="true" property="og:description" content="I&#x27;ve trained a character-level LSTM RNN on ~100k recipes dataset using TensorFlow, and it suggested me to cook Cream Soda with Onions, Puff Pastry Strawberry Soup, Zucchini flavor Tea and Salmon Mousse of Beef and Stilton Salad with Jalapenos"/><meta data-react-helmet="true" property="og:url" content="https://trekhleb.dev/blog/2020/recipes-generation/"/><meta data-react-helmet="true" property="og:image" content="https://trekhleb.dev/static/05340351fcb1004d0e25300d243978cd/c5a76/01-cover.jpg"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@Trekhleb"/><meta data-react-helmet="true" name="twitter:title" content="Generating cooking recipes using TensorFlow and LSTM Recurrent Neural Network: A step-by-step guide | Trekhleb"/><meta data-react-helmet="true" name="twitter:description" content="I&#x27;ve trained a character-level LSTM RNN on ~100k recipes dataset using TensorFlow, and it suggested me to cook Cream Soda with Onions, Puff Pastry Strawberry Soup, Zucchini flavor Tea and Salmon Mousse of Beef and Stilton Salad with Jalapenos"/><meta data-react-helmet="true" name="twitter:image" content="https://trekhleb.dev/static/05340351fcb1004d0e25300d243978cd/c5a76/01-cover.jpg"/><meta data-react-helmet="true" name="twitter:url" content="https://trekhleb.dev/blog/2020/recipes-generation/"/><style data-href="/styles.4a36b10556183b294e05.css" data-identity="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap);.prose blockquote p:first-of-type:before,.prose blockquote p:last-of-type:after,.prose code:after,.prose code:before{content:""!important}.prose blockquote{font-weight:400!important}.prose li code.language-text,.prose p code.language-text,.prose td code.language-text,.prose th code.language-text,.prose tr code.language-text{font-weight:400;padding:2px 5px 1px}.prose p>img{margin:auto}.prose h1>a.gatsby-remark-autolink-header-anchor,.prose h2>a.gatsby-remark-autolink-header-anchor,.prose h3>a.gatsby-remark-autolink-header-anchor,.prose h4>a.gatsby-remark-autolink-header-anchor,.prose h5>a.gatsby-remark-autolink-header-anchor{display:inline-block;margin-left:10px;visibility:hidden}.prose h1:hover>a.gatsby-remark-autolink-header-anchor,.prose h2:hover>a.gatsby-remark-autolink-header-anchor,.prose h3:hover>a.gatsby-remark-autolink-header-anchor,.prose h4:hover>a.gatsby-remark-autolink-header-anchor,.prose h5:hover>a.gatsby-remark-autolink-header-anchor{visibility:visible}

/* ! tailwindcss v3.3.2 | MIT License | https://tailwindcss.com */*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}html{-webkit-text-size-adjust:100%;font-feature-settings:normal;font-family:Roboto,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-variation-settings:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.prose{color:var(--tw-prose-body);max-width:65ch}.prose :where(p):not(:where([class~=not-prose] *)){margin-bottom:1.25em;margin-top:1.25em}.prose :where([class~=lead]):not(:where([class~=not-prose] *)){color:var(--tw-prose-lead);font-size:1.25em;line-height:1.6;margin-bottom:1.2em;margin-top:1.2em}.prose :where(a):not(:where([class~=not-prose] *)){color:#dc2626;font-weight:500;text-decoration:underline}.prose :where(a):not(:where([class~=not-prose] *)):hover{color:#ef4444}.prose :where(strong):not(:where([class~=not-prose] *)){color:var(--tw-prose-bold);font-weight:600}.prose :where(a strong):not(:where([class~=not-prose] *)){color:inherit}.prose :where(blockquote strong):not(:where([class~=not-prose] *)){color:inherit}.prose :where(thead th strong):not(:where([class~=not-prose] *)){color:inherit}.prose :where(ol):not(:where([class~=not-prose] *)){list-style-type:decimal;margin-bottom:1.25em;margin-top:1.25em;padding-left:1.625em}.prose :where(ol[type=A]):not(:where([class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a]):not(:where([class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=A s]):not(:where([class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a s]):not(:where([class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=I]):not(:where([class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i]):not(:where([class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type=I s]):not(:where([class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i s]):not(:where([class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type="1"]):not(:where([class~=not-prose] *)){list-style-type:decimal}.prose :where(ul):not(:where([class~=not-prose] *)){list-style-type:disc;margin-bottom:1.25em;margin-top:1.25em;padding-left:1.625em}.prose :where(ol>li):not(:where([class~=not-prose] *))::marker{color:var(--tw-prose-counters);font-weight:400}.prose :where(ul>li):not(:where([class~=not-prose] *))::marker{color:var(--tw-prose-bullets)}.prose :where(hr):not(:where([class~=not-prose] *)){border-color:var(--tw-prose-hr);border-top-width:1px;margin-bottom:3em;margin-top:3em}.prose :where(blockquote):not(:where([class~=not-prose] *)){border-left-color:var(--tw-prose-quote-borders);border-left-width:.25rem;color:var(--tw-prose-quotes);font-style:italic;font-weight:500;margin-bottom:1.6em;margin-top:1.6em;padding-left:1em;quotes:"\201C""\201D""\2018""\2019"}.prose :where(blockquote p:first-of-type):not(:where([class~=not-prose] *)):before{content:open-quote}.prose :where(blockquote p:last-of-type):not(:where([class~=not-prose] *)):after{content:close-quote}.prose :where(h1):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-size:2.25em;font-weight:800;line-height:1.1111111;margin-bottom:.8888889em;margin-top:0}.prose :where(h1 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:900}.prose :where(h2):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.5em;font-weight:700;line-height:1.3333333;margin-bottom:1em;margin-top:2em}.prose :where(h2 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:800}.prose :where(h3):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.25em;font-weight:600;line-height:1.6;margin-bottom:.6em;margin-top:1.6em}.prose :where(h3 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(h4):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;line-height:1.5;margin-bottom:.5em;margin-top:1.5em}.prose :where(h4 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(img):not(:where([class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(figure>*):not(:where([class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose :where(figcaption):not(:where([class~=not-prose] *)){color:var(--tw-prose-captions);font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose :where(code):not(:where([class~=not-prose] *)){color:var(--tw-prose-code);font-size:.875em;font-weight:600}.prose :where(code):not(:where([class~=not-prose] *)):before{content:"`"}.prose :where(code):not(:where([class~=not-prose] *)):after{content:"`"}.prose :where(a code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(h1 code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(h2 code):not(:where([class~=not-prose] *)){color:inherit;font-size:.875em}.prose :where(h3 code):not(:where([class~=not-prose] *)){color:inherit;font-size:.9em}.prose :where(h4 code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(blockquote code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(thead th code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(pre):not(:where([class~=not-prose] *)){background-color:var(--tw-prose-pre-bg);border-radius:.375rem;color:var(--tw-prose-pre-code);font-size:.875em;font-weight:400;line-height:1.7142857;margin-bottom:1.7142857em;margin-top:1.7142857em;overflow-x:auto;padding:.8571429em 1.1428571em}.prose :where(pre code):not(:where([class~=not-prose] *)){background-color:transparent;border-radius:0;border-width:0;color:inherit;font-family:inherit;font-size:inherit;font-weight:inherit;line-height:inherit;padding:0}.prose :where(pre code):not(:where([class~=not-prose] *)):before{content:none}.prose :where(pre code):not(:where([class~=not-prose] *)):after{content:none}.prose :where(table):not(:where([class~=not-prose] *)){font-size:.875em;line-height:1.7142857;margin-bottom:2em;margin-top:2em;table-layout:auto;text-align:left;width:100%}.prose :where(thead):not(:where([class~=not-prose] *)){border-bottom-color:var(--tw-prose-th-borders);border-bottom-width:1px}.prose :where(thead th):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;padding-bottom:.5714286em;padding-left:.5714286em;padding-right:.5714286em;vertical-align:bottom}.prose :where(tbody tr):not(:where([class~=not-prose] *)){border-bottom-color:var(--tw-prose-td-borders);border-bottom-width:1px}.prose :where(tbody tr:last-child):not(:where([class~=not-prose] *)){border-bottom-width:0}.prose :where(tbody td):not(:where([class~=not-prose] *)){vertical-align:baseline}.prose :where(tfoot):not(:where([class~=not-prose] *)){border-top-color:var(--tw-prose-th-borders);border-top-width:1px}.prose :where(tfoot td):not(:where([class~=not-prose] *)){vertical-align:top}.prose{--tw-prose-body:#374151;--tw-prose-headings:#111827;--tw-prose-lead:#4b5563;--tw-prose-links:#111827;--tw-prose-bold:#111827;--tw-prose-counters:#6b7280;--tw-prose-bullets:#d1d5db;--tw-prose-hr:#e5e7eb;--tw-prose-quotes:#111827;--tw-prose-quote-borders:#e5e7eb;--tw-prose-captions:#6b7280;--tw-prose-code:#111827;--tw-prose-pre-code:#e5e7eb;--tw-prose-pre-bg:#1f2937;--tw-prose-th-borders:#d1d5db;--tw-prose-td-borders:#e5e7eb;--tw-prose-invert-body:#d1d5db;--tw-prose-invert-headings:#fff;--tw-prose-invert-lead:#9ca3af;--tw-prose-invert-links:#fff;--tw-prose-invert-bold:#fff;--tw-prose-invert-counters:#9ca3af;--tw-prose-invert-bullets:#4b5563;--tw-prose-invert-hr:#374151;--tw-prose-invert-quotes:#f3f4f6;--tw-prose-invert-quote-borders:#374151;--tw-prose-invert-captions:#9ca3af;--tw-prose-invert-code:#fff;--tw-prose-invert-pre-code:#d1d5db;--tw-prose-invert-pre-bg:rgba(0,0,0,.5);--tw-prose-invert-th-borders:#4b5563;--tw-prose-invert-td-borders:#374151;font-size:1rem;line-height:1.75}.prose :where(video):not(:where([class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(figure):not(:where([class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(li):not(:where([class~=not-prose] *)){margin-bottom:.5em;margin-top:.5em}.prose :where(ol>li):not(:where([class~=not-prose] *)){padding-left:.375em}.prose :where(ul>li):not(:where([class~=not-prose] *)){padding-left:.375em}.prose :where(.prose>ul>li p):not(:where([class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(.prose>ul>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ul>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.25em}.prose :where(.prose>ol>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ol>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.25em}.prose :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(hr+*):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(h2+*):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(h3+*):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(h4+*):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(thead th:first-child):not(:where([class~=not-prose] *)){padding-left:0}.prose :where(thead th:last-child):not(:where([class~=not-prose] *)){padding-right:0}.prose :where(tbody td,tfoot td):not(:where([class~=not-prose] *)){padding:.5714286em}.prose :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose] *)){padding-left:0}.prose :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose] *)){padding-right:0}.prose :where(.prose>:first-child):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(.prose>:last-child):not(:where([class~=not-prose] *)){margin-bottom:0}.prose-sm{font-size:.875rem;line-height:1.7142857}.prose-sm :where(p):not(:where([class~=not-prose] *)){margin-bottom:1.1428571em;margin-top:1.1428571em}.prose-sm :where([class~=lead]):not(:where([class~=not-prose] *)){font-size:1.2857143em;line-height:1.5555556;margin-bottom:.8888889em;margin-top:.8888889em}.prose-sm :where(blockquote):not(:where([class~=not-prose] *)){margin-bottom:1.3333333em;margin-top:1.3333333em;padding-left:1.1111111em}.prose-sm :where(h1):not(:where([class~=not-prose] *)){font-size:2.1428571em;line-height:1.2;margin-bottom:.8em;margin-top:0}.prose-sm :where(h2):not(:where([class~=not-prose] *)){font-size:1.4285714em;line-height:1.4;margin-bottom:.8em;margin-top:1.6em}.prose-sm :where(h3):not(:where([class~=not-prose] *)){font-size:1.2857143em;line-height:1.5555556;margin-bottom:.4444444em;margin-top:1.5555556em}.prose-sm :where(h4):not(:where([class~=not-prose] *)){line-height:1.4285714;margin-bottom:.5714286em;margin-top:1.4285714em}.prose-sm :where(img):not(:where([class~=not-prose] *)){margin-bottom:1.7142857em;margin-top:1.7142857em}.prose-sm :where(video):not(:where([class~=not-prose] *)){margin-bottom:1.7142857em;margin-top:1.7142857em}.prose-sm :where(figure):not(:where([class~=not-prose] *)){margin-bottom:1.7142857em;margin-top:1.7142857em}.prose-sm :where(figure>*):not(:where([class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose-sm :where(figcaption):not(:where([class~=not-prose] *)){font-size:.8571429em;line-height:1.3333333;margin-top:.6666667em}.prose-sm :where(code):not(:where([class~=not-prose] *)){font-size:.8571429em}.prose-sm :where(h2 code):not(:where([class~=not-prose] *)){font-size:.9em}.prose-sm :where(h3 code):not(:where([class~=not-prose] *)){font-size:.8888889em}.prose-sm :where(pre):not(:where([class~=not-prose] *)){border-radius:.25rem;font-size:.8571429em;line-height:1.6666667;margin-bottom:1.6666667em;margin-top:1.6666667em;padding:.6666667em 1em}.prose-sm :where(ol):not(:where([class~=not-prose] *)){margin-bottom:1.1428571em;margin-top:1.1428571em;padding-left:1.5714286em}.prose-sm :where(ul):not(:where([class~=not-prose] *)){margin-bottom:1.1428571em;margin-top:1.1428571em;padding-left:1.5714286em}.prose-sm :where(li):not(:where([class~=not-prose] *)){margin-bottom:.2857143em;margin-top:.2857143em}.prose-sm :where(ol>li):not(:where([class~=not-prose] *)){padding-left:.4285714em}.prose-sm :where(ul>li):not(:where([class~=not-prose] *)){padding-left:.4285714em}.prose-sm :where(.prose-sm>ul>li p):not(:where([class~=not-prose] *)){margin-bottom:.5714286em;margin-top:.5714286em}.prose-sm :where(.prose-sm>ul>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.1428571em}.prose-sm :where(.prose-sm>ul>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.1428571em}.prose-sm :where(.prose-sm>ol>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.1428571em}.prose-sm :where(.prose-sm>ol>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.1428571em}.prose-sm :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose] *)){margin-bottom:.5714286em;margin-top:.5714286em}.prose-sm :where(hr):not(:where([class~=not-prose] *)){margin-bottom:2.8571429em;margin-top:2.8571429em}.prose-sm :where(hr+*):not(:where([class~=not-prose] *)){margin-top:0}.prose-sm :where(h2+*):not(:where([class~=not-prose] *)){margin-top:0}.prose-sm :where(h3+*):not(:where([class~=not-prose] *)){margin-top:0}.prose-sm :where(h4+*):not(:where([class~=not-prose] *)){margin-top:0}.prose-sm :where(table):not(:where([class~=not-prose] *)){font-size:.8571429em;line-height:1.5}.prose-sm :where(thead th):not(:where([class~=not-prose] *)){padding-bottom:.6666667em;padding-left:1em;padding-right:1em}.prose-sm :where(thead th:first-child):not(:where([class~=not-prose] *)){padding-left:0}.prose-sm :where(thead th:last-child):not(:where([class~=not-prose] *)){padding-right:0}.prose-sm :where(tbody td,tfoot td):not(:where([class~=not-prose] *)){padding:.6666667em 1em}.prose-sm :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose] *)){padding-left:0}.prose-sm :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose] *)){padding-right:0}.prose-sm :where(.prose-sm>:first-child):not(:where([class~=not-prose] *)){margin-top:0}.prose-sm :where(.prose-sm>:last-child):not(:where([class~=not-prose] *)){margin-bottom:0}.prose-red{--tw-prose-links:#dc2626;--tw-prose-invert-links:#ef4444}.visible{visibility:visible}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-y-0{bottom:0;top:0}.bottom-0{bottom:0}.left-0{left:0}.right-0{right:0}.m-auto{margin:auto}.mb-0{margin-bottom:0}.mb-1{margin-bottom:.25rem}.mb-12{margin-bottom:3rem}.mb-2{margin-bottom:.5rem}.mb-24{margin-bottom:6rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.ml-0{margin-left:0}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.ml-3{margin-left:.75rem}.ml-4{margin-left:1rem}.ml-5{margin-left:1.25rem}.mr-0{margin-right:0}.mr-1{margin-right:.25rem}.mr-2{margin-right:.5rem}.mr-3{margin-right:.75rem}.mr-4{margin-right:1rem}.mr-5{margin-right:1.25rem}.mr-6{margin-right:1.5rem}.mt-1{margin-top:.25rem}.mt-16{margin-top:4rem}.mt-2{margin-top:.5rem}.mt-24{margin-top:6rem}.mt-3{margin-top:.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-0{height:0}.h-0\.5{height:.125rem}.h-16{height:4rem}.h-4{height:1rem}.h-48{height:12rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-64{height:16rem}.h-96{height:24rem}.h-full{height:100%}.w-1{width:.25rem}.w-10{width:2.5rem}.w-14{width:3.5rem}.w-16{width:4rem}.w-2{width:.5rem}.w-36{width:9rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-64{width:16rem}.w-full{width:100%}.max-w-md{max-width:28rem}.max-w-screen-xl{max-width:1280px}.flex-1{flex:1 1 0%}.shrink{flex-shrink:1}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes spin{to{transform:rotate(1turn)}}.animate-spin{animation:spin 1s linear infinite}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.resize{resize:both}.appearance-none{-webkit-appearance:none;-moz-appearance:none;appearance:none}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.items-stretch{align-items:stretch}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-items-center{justify-items:center}.gap-12{gap:3rem}.self-start{align-self:flex-start}.self-stretch{align-self:stretch}.justify-self-end{justify-self:end}.overflow-hidden{overflow:hidden}.overflow-scroll{overflow:scroll}.whitespace-nowrap{white-space:nowrap}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-md{border-radius:.375rem}.rounded-sm{border-radius:.125rem}.border{border-width:1px}.border-4{border-width:4px}.border-b-2{border-bottom-width:2px}.border-solid{border-style:solid}.border-dashed{border-style:dashed}.border-dotted{border-style:dotted}.border-black{--tw-border-opacity:1;border-color:rgb(0 0 0/var(--tw-border-opacity))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity))}.border-gray-400{--tw-border-opacity:1;border-color:rgb(156 163 175/var(--tw-border-opacity))}.border-red-500{--tw-border-opacity:1;border-color:rgb(239 68 68/var(--tw-border-opacity))}.border-slate-400{--tw-border-opacity:1;border-color:rgb(148 163 184/var(--tw-border-opacity))}.border-white{--tw-border-opacity:1;border-color:rgb(255 255 255/var(--tw-border-opacity))}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254/var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity))}.bg-gray-400{--tw-bg-opacity:1;background-color:rgb(156 163 175/var(--tw-bg-opacity))}.bg-orange-100{--tw-bg-opacity:1;background-color:rgb(255 237 213/var(--tw-bg-opacity))}.bg-orange-500{--tw-bg-opacity:1;background-color:rgb(249 115 22/var(--tw-bg-opacity))}.bg-red-100{--tw-bg-opacity:1;background-color:rgb(254 226 226/var(--tw-bg-opacity))}.bg-rose-200{--tw-bg-opacity:1;background-color:rgb(254 205 211/var(--tw-bg-opacity))}.bg-rose-500{--tw-bg-opacity:1;background-color:rgb(244 63 94/var(--tw-bg-opacity))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249/var(--tw-bg-opacity))}.bg-slate-200{--tw-bg-opacity:1;background-color:rgb(226 232 240/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-cover{background-size:cover}.p-3{padding:.75rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-bottom:.25rem;padding-top:.25rem}.py-12{padding-bottom:3rem;padding-top:3rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-3{padding-bottom:.75rem;padding-top:.75rem}.py-6{padding-top:1.5rem}.pb-6,.py-6{padding-bottom:1.5rem}.pt-4{padding-top:1rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-light{font-weight:300}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.italic{font-style:italic}.tracking-wider{letter-spacing:.05em}.tracking-widest{letter-spacing:.1em}.text-black{--tw-text-opacity:1;color:rgb(0 0 0/var(--tw-text-opacity))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235/var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38/var(--tw-text-opacity))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.underline{text-decoration-line:underline}.no-underline{text-decoration-line:none}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-card{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-card{--tw-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12);--tw-shadow-colored:0 2px 1px -1px var(--tw-shadow-color),0 1px 1px 0 var(--tw-shadow-color),0 1px 3px 0 var(--tw-shadow-color)}.shadow-inner{--tw-shadow:inset 0 2px 4px 0 rgba(0,0,0,.05);--tw-shadow-colored:inset 0 2px 4px 0 var(--tw-shadow-color)}.shadow-inner,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.outline{outline-style:solid}.grayscale{--tw-grayscale:grayscale(100%)}.filter,.grayscale{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-all{transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-200{transition-duration:.2s}.duration-500{transition-duration:.5s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}@media (min-width:640px){.sm\:prose{color:var(--tw-prose-body);max-width:65ch}.sm\:prose :where(p):not(:where([class~=not-prose] *)){margin-bottom:1.25em;margin-top:1.25em}.sm\:prose :where([class~=lead]):not(:where([class~=not-prose] *)){color:var(--tw-prose-lead);font-size:1.25em;line-height:1.6;margin-bottom:1.2em;margin-top:1.2em}.sm\:prose :where(a):not(:where([class~=not-prose] *)){color:#dc2626;font-weight:500;text-decoration:underline}.sm\:prose :where(a):not(:where([class~=not-prose] *)):hover{color:#ef4444}.sm\:prose :where(strong):not(:where([class~=not-prose] *)){color:var(--tw-prose-bold);font-weight:600}.sm\:prose :where(a strong):not(:where([class~=not-prose] *)){color:inherit}.sm\:prose :where(blockquote strong):not(:where([class~=not-prose] *)){color:inherit}.sm\:prose :where(thead th strong):not(:where([class~=not-prose] *)){color:inherit}.sm\:prose :where(ol):not(:where([class~=not-prose] *)){list-style-type:decimal;margin-bottom:1.25em;margin-top:1.25em;padding-left:1.625em}.sm\:prose :where(ol[type=A]):not(:where([class~=not-prose] *)){list-style-type:upper-alpha}.sm\:prose :where(ol[type=a]):not(:where([class~=not-prose] *)){list-style-type:lower-alpha}.sm\:prose :where(ol[type=A s]):not(:where([class~=not-prose] *)){list-style-type:upper-alpha}.sm\:prose :where(ol[type=a s]):not(:where([class~=not-prose] *)){list-style-type:lower-alpha}.sm\:prose :where(ol[type=I]):not(:where([class~=not-prose] *)){list-style-type:upper-roman}.sm\:prose :where(ol[type=i]):not(:where([class~=not-prose] *)){list-style-type:lower-roman}.sm\:prose :where(ol[type=I s]):not(:where([class~=not-prose] *)){list-style-type:upper-roman}.sm\:prose :where(ol[type=i s]):not(:where([class~=not-prose] *)){list-style-type:lower-roman}.sm\:prose :where(ol[type="1"]):not(:where([class~=not-prose] *)){list-style-type:decimal}.sm\:prose :where(ul):not(:where([class~=not-prose] *)){list-style-type:disc;margin-bottom:1.25em;margin-top:1.25em;padding-left:1.625em}.sm\:prose :where(ol>li):not(:where([class~=not-prose] *))::marker{color:var(--tw-prose-counters);font-weight:400}.sm\:prose :where(ul>li):not(:where([class~=not-prose] *))::marker{color:var(--tw-prose-bullets)}.sm\:prose :where(hr):not(:where([class~=not-prose] *)){border-color:var(--tw-prose-hr);border-top-width:1px;margin-bottom:3em;margin-top:3em}.sm\:prose :where(blockquote):not(:where([class~=not-prose] *)){border-left-color:var(--tw-prose-quote-borders);border-left-width:.25rem;color:var(--tw-prose-quotes);font-style:italic;font-weight:500;margin-bottom:1.6em;margin-top:1.6em;padding-left:1em;quotes:"\201C""\201D""\2018""\2019"}.sm\:prose :where(blockquote p:first-of-type):not(:where([class~=not-prose] *)):before{content:open-quote}.sm\:prose :where(blockquote p:last-of-type):not(:where([class~=not-prose] *)):after{content:close-quote}.sm\:prose :where(h1):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-size:2.25em;font-weight:800;line-height:1.1111111;margin-bottom:.8888889em;margin-top:0}.sm\:prose :where(h1 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:900}.sm\:prose :where(h2):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.5em;font-weight:700;line-height:1.3333333;margin-bottom:1em;margin-top:2em}.sm\:prose :where(h2 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:800}.sm\:prose :where(h3):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.25em;font-weight:600;line-height:1.6;margin-bottom:.6em;margin-top:1.6em}.sm\:prose :where(h3 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:700}.sm\:prose :where(h4):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;line-height:1.5;margin-bottom:.5em;margin-top:1.5em}.sm\:prose :where(h4 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:700}.sm\:prose :where(img):not(:where([class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.sm\:prose :where(figure>*):not(:where([class~=not-prose] *)){margin-bottom:0;margin-top:0}.sm\:prose :where(figcaption):not(:where([class~=not-prose] *)){color:var(--tw-prose-captions);font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.sm\:prose :where(code):not(:where([class~=not-prose] *)){color:var(--tw-prose-code);font-size:.875em;font-weight:600}.sm\:prose :where(code):not(:where([class~=not-prose] *)):before{content:"`"}.sm\:prose :where(code):not(:where([class~=not-prose] *)):after{content:"`"}.sm\:prose :where(a code):not(:where([class~=not-prose] *)){color:inherit}.sm\:prose :where(h1 code):not(:where([class~=not-prose] *)){color:inherit}.sm\:prose :where(h2 code):not(:where([class~=not-prose] *)){color:inherit;font-size:.875em}.sm\:prose :where(h3 code):not(:where([class~=not-prose] *)){color:inherit;font-size:.9em}.sm\:prose :where(h4 code):not(:where([class~=not-prose] *)){color:inherit}.sm\:prose :where(blockquote code):not(:where([class~=not-prose] *)){color:inherit}.sm\:prose :where(thead th code):not(:where([class~=not-prose] *)){color:inherit}.sm\:prose :where(pre):not(:where([class~=not-prose] *)){background-color:var(--tw-prose-pre-bg);border-radius:.375rem;color:var(--tw-prose-pre-code);font-size:.875em;font-weight:400;line-height:1.7142857;margin-bottom:1.7142857em;margin-top:1.7142857em;overflow-x:auto;padding:.8571429em 1.1428571em}.sm\:prose :where(pre code):not(:where([class~=not-prose] *)){background-color:transparent;border-radius:0;border-width:0;color:inherit;font-family:inherit;font-size:inherit;font-weight:inherit;line-height:inherit;padding:0}.sm\:prose :where(pre code):not(:where([class~=not-prose] *)):before{content:none}.sm\:prose :where(pre code):not(:where([class~=not-prose] *)):after{content:none}.sm\:prose :where(table):not(:where([class~=not-prose] *)){font-size:.875em;line-height:1.7142857;margin-bottom:2em;margin-top:2em;table-layout:auto;text-align:left;width:100%}.sm\:prose :where(thead):not(:where([class~=not-prose] *)){border-bottom-color:var(--tw-prose-th-borders);border-bottom-width:1px}.sm\:prose :where(thead th):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;padding-bottom:.5714286em;padding-left:.5714286em;padding-right:.5714286em;vertical-align:bottom}.sm\:prose :where(tbody tr):not(:where([class~=not-prose] *)){border-bottom-color:var(--tw-prose-td-borders);border-bottom-width:1px}.sm\:prose :where(tbody tr:last-child):not(:where([class~=not-prose] *)){border-bottom-width:0}.sm\:prose :where(tbody td):not(:where([class~=not-prose] *)){vertical-align:baseline}.sm\:prose :where(tfoot):not(:where([class~=not-prose] *)){border-top-color:var(--tw-prose-th-borders);border-top-width:1px}.sm\:prose :where(tfoot td):not(:where([class~=not-prose] *)){vertical-align:top}.sm\:prose{--tw-prose-body:#374151;--tw-prose-headings:#111827;--tw-prose-lead:#4b5563;--tw-prose-links:#111827;--tw-prose-bold:#111827;--tw-prose-counters:#6b7280;--tw-prose-bullets:#d1d5db;--tw-prose-hr:#e5e7eb;--tw-prose-quotes:#111827;--tw-prose-quote-borders:#e5e7eb;--tw-prose-captions:#6b7280;--tw-prose-code:#111827;--tw-prose-pre-code:#e5e7eb;--tw-prose-pre-bg:#1f2937;--tw-prose-th-borders:#d1d5db;--tw-prose-td-borders:#e5e7eb;--tw-prose-invert-body:#d1d5db;--tw-prose-invert-headings:#fff;--tw-prose-invert-lead:#9ca3af;--tw-prose-invert-links:#fff;--tw-prose-invert-bold:#fff;--tw-prose-invert-counters:#9ca3af;--tw-prose-invert-bullets:#4b5563;--tw-prose-invert-hr:#374151;--tw-prose-invert-quotes:#f3f4f6;--tw-prose-invert-quote-borders:#374151;--tw-prose-invert-captions:#9ca3af;--tw-prose-invert-code:#fff;--tw-prose-invert-pre-code:#d1d5db;--tw-prose-invert-pre-bg:rgba(0,0,0,.5);--tw-prose-invert-th-borders:#4b5563;--tw-prose-invert-td-borders:#374151;font-size:1rem;line-height:1.75}.sm\:prose :where(video):not(:where([class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.sm\:prose :where(figure):not(:where([class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.sm\:prose :where(li):not(:where([class~=not-prose] *)){margin-bottom:.5em;margin-top:.5em}.sm\:prose :where(ol>li):not(:where([class~=not-prose] *)){padding-left:.375em}.sm\:prose :where(ul>li):not(:where([class~=not-prose] *)){padding-left:.375em}.sm\:prose :where(.sm\:prose>ul>li p):not(:where([class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.sm\:prose :where(.sm\:prose>ul>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.25em}.sm\:prose :where(.sm\:prose>ul>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.25em}.sm\:prose :where(.sm\:prose>ol>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.25em}.sm\:prose :where(.sm\:prose>ol>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.25em}.sm\:prose :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.sm\:prose :where(hr+*):not(:where([class~=not-prose] *)){margin-top:0}.sm\:prose :where(h2+*):not(:where([class~=not-prose] *)){margin-top:0}.sm\:prose :where(h3+*):not(:where([class~=not-prose] *)){margin-top:0}.sm\:prose :where(h4+*):not(:where([class~=not-prose] *)){margin-top:0}.sm\:prose :where(thead th:first-child):not(:where([class~=not-prose] *)){padding-left:0}.sm\:prose :where(thead th:last-child):not(:where([class~=not-prose] *)){padding-right:0}.sm\:prose :where(tbody td,tfoot td):not(:where([class~=not-prose] *)){padding:.5714286em}.sm\:prose :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose] *)){padding-left:0}.sm\:prose :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose] *)){padding-right:0}.sm\:prose :where(.sm\:prose>:first-child):not(:where([class~=not-prose] *)){margin-top:0}.sm\:prose :where(.sm\:prose>:last-child):not(:where([class~=not-prose] *)){margin-bottom:0}}.last\:mr-0:last-child{margin-right:0}.hover\:-translate-y-1:hover{--tw-translate-y:-0.25rem}.hover\:-translate-y-1:hover,.hover\:scale-105:hover{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05}.hover\:border-gray-400:hover{--tw-border-opacity:1;border-color:rgb(156 163 175/var(--tw-border-opacity))}.hover\:border-white:hover{--tw-border-opacity:1;border-color:rgb(255 255 255/var(--tw-border-opacity))}.hover\:bg-black:hover{--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity))}.hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.hover\:bg-red-500:hover{--tw-bg-opacity:1;background-color:rgb(239 68 68/var(--tw-bg-opacity))}.hover\:bg-white:hover{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.hover\:text-black:hover{--tw-text-opacity:1;color:rgb(0 0 0/var(--tw-text-opacity))}.hover\:text-gray-500:hover{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}.hover\:text-red-600:hover{--tw-text-opacity:1;color:rgb(220 38 38/var(--tw-text-opacity))}.hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.hover\:underline:hover{text-decoration-line:underline}.group:hover .group-hover\:inline-block{display:inline-block}@media (min-width:640px){.sm\:mb-0{margin-bottom:0}.sm\:mr-6{margin-right:1.5rem}.sm\:flex{display:flex}.sm\:h-20{height:5rem}.sm\:h-auto{height:auto}.sm\:w-2\/5{width:40%}.sm\:w-20{width:5rem}.sm\:w-3\/5{width:60%}.sm\:flex-1{flex:1 1 0%}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\:flex-row{flex-direction:row}.sm\:items-start{align-items:flex-start}.sm\:items-center{align-items:center}.sm\:px-12{padding-left:3rem;padding-right:3rem}.sm\:text-left{text-align:left}}@media (min-width:1024px){.lg\:w-1\/4{width:25%}.lg\:w-3\/4{width:75%}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}.\[\&\>h2\>a\]\:invisible>h2>a{visibility:hidden}.\[\&\>h2\>a\]\:hidden>h2>a{display:none}.\[\&\>h2\>a\]\:h-0>h2>a{height:0}.\[\&\>h2\>a\]\:w-0>h2>a{width:0}.\[\&\>h2\>a\]\:overflow-hidden>h2>a{overflow:hidden}.\[\&\>h2\>a\]\:opacity-0>h2>a{opacity:0}.\[\&\>h2\]\:inline>h2{display:inline}.\[\&\>p\]\:m-0>p{margin:0}.\[\&\>p\]\:inline>p{display:inline}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.post--2021--binary-floating-point--bit-button:hover{box-shadow:0 0 5px 1px rgba(0,0,0,.2);transition:box-shadow .2s ease-in-out}.custom-fade-in-opacity{animation-duration:.8s;animation-iteration-count:1;animation-name:customFadeInOpacity;animation-timing-function:ease-out;opacity:1}@keyframes customFadeInOpacity{0%{opacity:0}to{opacity:1}}input:checked~.toggle__dot{transform:translateX(100%)}input:checked~.toggle__line{background-color:#48bb78}.post--2021--water-line--gyro-cube .gyro-cube-container{align-items:center;display:flex;height:400px;justify-content:center;perspective:800px;perspective-origin:50%}.post--2021--water-line--gyro-cube .gyro-cube{height:200px;position:relative;transform-style:preserve-3d;width:200px}.post--2021--water-line--gyro-cube .gyro-cube-side{align-items:center;border:2px solid #fff;color:#fff;display:flex;font-size:100px;font-weight:700;height:100%;justify-content:center;opacity:.8;position:absolute;width:100%}.post--2021--water-line--gyro-cube .gyro-cube-front{background-color:#d50000;transform:translateZ(100px)}.post--2021--water-line--gyro-cube .gyro-cube-back{background-color:#a0f;transform:translateZ(-100px)}.post--2021--water-line--gyro-cube .gyro-cube-left{background-color:#304ffe;transform:translateX(100px) rotateY(90deg)}.post--2021--water-line--gyro-cube .gyro-cube-right{background-color:#0091ea;transform:translateX(-100px) rotateY(90deg)}.post--2021--water-line--gyro-cube .gyro-cube-top{background-color:#00bfa5;transform:translateY(-100px) rotateX(90deg)}.post--2021--water-line--gyro-cube .gyro-cube-bottom{background-color:#64dd17;transform:translateY(100px) rotateX(90deg)}.react-flow__container{height:100%;left:0;position:absolute;top:0;width:100%}.react-flow__pane{cursor:grab;z-index:1}.react-flow__pane.selection{cursor:pointer}.react-flow__pane.dragging{cursor:grabbing}.react-flow__viewport{pointer-events:none;transform-origin:0 0;z-index:2}.react-flow__renderer{z-index:4}.react-flow__selection{z-index:6}.react-flow__nodesselection-rect:focus,.react-flow__nodesselection-rect:focus-visible{outline:none}.react-flow .react-flow__edges{overflow:visible;pointer-events:none}.react-flow__connection-path,.react-flow__edge-path{stroke:#b1b1b7;stroke-width:1;fill:none}.react-flow__edge{cursor:pointer;pointer-events:visibleStroke}.react-flow__edge.animated path{stroke-dasharray:5;animation:dashdraw .5s linear infinite}.react-flow__edge.animated path.react-flow__edge-interaction{stroke-dasharray:none;animation:none}.react-flow__edge.inactive{pointer-events:none}.react-flow__edge.selected,.react-flow__edge:focus,.react-flow__edge:focus-visible{outline:none}.react-flow__edge.selected .react-flow__edge-path,.react-flow__edge:focus .react-flow__edge-path,.react-flow__edge:focus-visible .react-flow__edge-path{stroke:#555}.react-flow__edge-textwrapper{pointer-events:all}.react-flow__edge-textbg{fill:#fff}.react-flow__edge .react-flow__edge-text{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.react-flow__connection{pointer-events:none}.react-flow__connection .animated{stroke-dasharray:5;animation:dashdraw .5s linear infinite}.react-flow__connectionline{z-index:1001}.react-flow__nodes{pointer-events:none;transform-origin:0 0}.react-flow__node{box-sizing:border-box;cursor:grab;pointer-events:all;position:absolute;transform-origin:0 0;-webkit-user-select:none;-moz-user-select:none;user-select:none}.react-flow__node.dragging{cursor:grabbing}.react-flow__nodesselection{pointer-events:none;transform-origin:left top;z-index:3}.react-flow__nodesselection-rect{cursor:grab;pointer-events:all;position:absolute}.react-flow__handle{background:#1a192b;border:1px solid #fff;border-radius:100%;height:6px;min-height:5px;min-width:5px;pointer-events:none;position:absolute;width:6px}.react-flow__handle.connectionindicator{cursor:crosshair;pointer-events:all}.react-flow__handle-bottom{bottom:-4px;left:50%;top:auto;transform:translate(-50%)}.react-flow__handle-top{left:50%;top:-4px;transform:translate(-50%)}.react-flow__handle-left{left:-4px;top:50%;transform:translateY(-50%)}.react-flow__handle-right{right:-4px;top:50%;transform:translateY(-50%)}.react-flow__edgeupdater{cursor:move;pointer-events:all}.react-flow__panel{margin:15px;position:absolute;z-index:5}.react-flow__panel.top{top:0}.react-flow__panel.bottom{bottom:0}.react-flow__panel.left{left:0}.react-flow__panel.right{right:0}.react-flow__panel.center{left:50%;transform:translateX(-50%)}.react-flow__attribution{background:hsla(0,0%,100%,.5);font-size:10px;margin:0;padding:2px 3px}.react-flow__attribution a{color:#999;text-decoration:none}@keyframes dashdraw{0%{stroke-dashoffset:10}}.react-flow__edgelabel-renderer{height:100%;pointer-events:none;position:absolute;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:100%}.react-flow__edge.updating .react-flow__edge-path{stroke:#777}.react-flow__edge-text{font-size:10px}.react-flow__node.selectable:focus,.react-flow__node.selectable:focus-visible{outline:none}.react-flow__node-default,.react-flow__node-group,.react-flow__node-input,.react-flow__node-output{background-color:#fff;border:1px solid #1a192b;border-radius:3px;color:#222;font-size:12px;padding:10px;text-align:center;width:150px}.react-flow__node-default.selectable:hover,.react-flow__node-group.selectable:hover,.react-flow__node-input.selectable:hover,.react-flow__node-output.selectable:hover{box-shadow:0 1px 4px 1px rgba(0,0,0,.08)}.react-flow__node-default.selectable.selected,.react-flow__node-default.selectable:focus,.react-flow__node-default.selectable:focus-visible,.react-flow__node-group.selectable.selected,.react-flow__node-group.selectable:focus,.react-flow__node-group.selectable:focus-visible,.react-flow__node-input.selectable.selected,.react-flow__node-input.selectable:focus,.react-flow__node-input.selectable:focus-visible,.react-flow__node-output.selectable.selected,.react-flow__node-output.selectable:focus,.react-flow__node-output.selectable:focus-visible{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-group{background-color:hsla(0,0%,94%,.25)}.react-flow__nodesselection-rect,.react-flow__selection{background:rgba(0,89,220,.08);border:1px dotted rgba(0,89,220,.8)}.react-flow__nodesselection-rect:focus,.react-flow__nodesselection-rect:focus-visible,.react-flow__selection:focus,.react-flow__selection:focus-visible{outline:none}.react-flow__controls{box-shadow:0 0 2px 1px rgba(0,0,0,.08)}.react-flow__controls-button{align-items:center;background:#fefefe;border:none;border-bottom:1px solid #eee;box-sizing:content-box;cursor:pointer;display:flex;height:16px;justify-content:center;padding:5px;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:16px}.react-flow__controls-button:hover{background:#f4f4f4}.react-flow__controls-button svg{max-height:12px;max-width:12px;width:100%}.react-flow__controls-button:disabled{pointer-events:none}.react-flow__controls-button:disabled svg{fill-opacity:.4}.react-flow__minimap{background-color:#fff}.react-flow__resize-control{position:absolute}.react-flow__resize-control.left,.react-flow__resize-control.right{cursor:ew-resize}.react-flow__resize-control.bottom,.react-flow__resize-control.top{cursor:ns-resize}.react-flow__resize-control.bottom.right,.react-flow__resize-control.top.left{cursor:nwse-resize}.react-flow__resize-control.bottom.left,.react-flow__resize-control.top.right{cursor:nesw-resize}.react-flow__resize-control.handle{background-color:#3367d9;border:1px solid #fff;border-radius:1px;height:4px;transform:translate(-50%,-50%);width:4px}.react-flow__resize-control.handle.left{left:0;top:50%}.react-flow__resize-control.handle.right{left:100%;top:50%}.react-flow__resize-control.handle.top{left:50%;top:0}.react-flow__resize-control.handle.bottom{left:50%;top:100%}.react-flow__resize-control.handle.bottom.left,.react-flow__resize-control.handle.top.left{left:0}.react-flow__resize-control.handle.bottom.right,.react-flow__resize-control.handle.top.right{left:100%}.react-flow__resize-control.line{border:0 solid #3367d9}.react-flow__resize-control.line.left,.react-flow__resize-control.line.right{height:100%;top:0;transform:translate(-50%);width:1px}.react-flow__resize-control.line.left{border-left-width:1px;left:0}.react-flow__resize-control.line.right{border-right-width:1px;left:100%}.react-flow__resize-control.line.bottom,.react-flow__resize-control.line.top{height:1px;left:0;transform:translateY(-50%);width:100%}.react-flow__resize-control.line.top{border-top-width:1px;top:0}.react-flow__resize-control.line.bottom{border-bottom-width:1px;top:100%}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">Generating cooking recipes using TensorFlow and LSTM Recurrent Neural Network: A step-by-step guide | Trekhleb</title><style type="text/css">
    .gatsby-remark-autolink-header-anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .gatsby-remark-autolink-header-anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .gatsby-remark-autolink-header-anchor svg,
    h2 .gatsby-remark-autolink-header-anchor svg,
    h3 .gatsby-remark-autolink-header-anchor svg,
    h4 .gatsby-remark-autolink-header-anchor svg,
    h5 .gatsby-remark-autolink-header-anchor svg,
    h6 .gatsby-remark-autolink-header-anchor svg {
      visibility: hidden;
    }
    h1:hover .gatsby-remark-autolink-header-anchor svg,
    h2:hover .gatsby-remark-autolink-header-anchor svg,
    h3:hover .gatsby-remark-autolink-header-anchor svg,
    h4:hover .gatsby-remark-autolink-header-anchor svg,
    h5:hover .gatsby-remark-autolink-header-anchor svg,
    h6:hover .gatsby-remark-autolink-header-anchor svg,
    h1 .gatsby-remark-autolink-header-anchor:focus svg,
    h2 .gatsby-remark-autolink-header-anchor:focus svg,
    h3 .gatsby-remark-autolink-header-anchor:focus svg,
    h4 .gatsby-remark-autolink-header-anchor:focus svg,
    h5 .gatsby-remark-autolink-header-anchor:focus svg,
    h6 .gatsby-remark-autolink-header-anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link rel="alternate" type="application/rss+xml" title="Trekhleb.dev RSS Feed" href="/rss.xml"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><main class="flex flex-col items-center"><div class="max-w-screen-xl self-stretch m-auto w-full"><header class="flex flex-row items-center px-6 sm:px-12 py-6"><div class="mr-6"><div><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 font-extrabold text-sm tracking-widest uppercase" href="/">Trekhleb</a></div></div><nav><ul class="flex flex-row"><li class="ml-5"><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 uppercase text-xs" href="/">About</a></li><li class="ml-5"><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 uppercase text-xs" href="/projects/">Projects</a></li><li class="ml-5"><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 uppercase text-xs" href="/blog/">Blog</a></li></ul></nav></header><article class="px-6 sm:px-12 py-6"><div class="flex flex-col items-center"><article class="w-full prose prose-sm sm:prose overflow-hidden prose-red" style="max-width:860px"><h1 class="text-3xl mb-6 uppercase font-extrabold ">Generating cooking recipes using TensorFlow and LSTM Recurrent Neural Network: A step-by-step guide</h1><div class="flex flex-row items-center "><div class="flex flex-row items-center mr-6 mb-6 text-gray-500 text-sm"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>18 June, 2020</div></div><h2 id="tldr" style="position:relative">TL;DR<a href="#tldr" aria-label="tldr permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>I&#x27;ve trained a character-level LSTM <em>(Long short-term memory)</em> RNN <em>(Recurrent Neural Network)</em> on <em>~100k</em> recipes dataset using TensorFlow, and it suggested me to cook <em>&quot;Cream Soda with Onions&quot;</em>, <em>&quot;Puff Pastry Strawberry Soup&quot;</em>, <em>&quot;Zucchini flavor Tea&quot;</em> and <em>&quot;Salmon Mousse of Beef and Stilton Salad with Jalapenos&quot;</em> .</p>
<p>Here you may find more examples of what I ended up with:</p>
<ul>
<li> <a href="https://trekhleb.dev/machine-learning-experiments/#/experiments/RecipeGenerationRNN">Cooking recipes generator demo</a> - to try the model interactively right in your browser.</li>
<li> <a href="https://github.com/trekhleb/machine-learning-experiments/blob/master/experiments/recipe_generation_rnn/recipe_generation_rnn.ipynb">LSTM model training process</a> - to see how the model was trained.</li>
<li><a href="https://github.com/trekhleb/machine-learning-experiments"> Interactive Machine Learning Experiments</a> repository - to see more experiments with &quot;Objects detection&quot;, &quot;Sketch Recognition&quot;, &quot;Image Classification&quot; etc.</li>
</ul>
<p>This article contains details of how the LSTM model was actually trained on Python using <a href="https://www.tensorflow.org/">TensorFlow 2</a> with <a href="https://www.tensorflow.org/guide/keras">Keras API</a>.</p>
<img src="/posts-assets/4cdea1757c71da83958f357939b859e2/02-demo.gif" alt="Cooking recipes generator demo"/>
<h2 id="what-our-model-will-eventually-learn" style="position:relative">What our model will eventually learn<a href="#what-our-model-will-eventually-learn" aria-label="what our model will eventually learn permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>For a couple of hours of training our character-level RNN model will learn basic concepts of English grammar and punctuation (I wish I could learn English that fast!). It will also learn how to generate different parts of recipes such as <em> [RECIPE NAME]</em>, <em> [RECIPE INGREDIENTS]</em> and <em> [RECIPE INSTRUCTIONS]</em>. Sometimes recipe name, ingredients and instructions will be pretty interesting, sometimes stupid, sometimes fun.</p>
<p>Here is a couple of generated recipes examples:</p>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"> [NAME]

Orange Club Tea Sandwich Cookies

 [INGREDIENTS]

 1 cup (2 sticks) unsalted butter, softened
 1 cup confectioners' sugar
 1/2 cup flaxseed meal
 1/2 cup shelled pumpkin seeds (pecans, blanched and sliced)
 2 teaspoons vanilla extract

 [INSTRUCTIONS]

 Preheat oven to 350 degrees F.
 Combine cake mix, milk, egg and sugar in a large bowl. Stir until combined and smooth but not sticky. Using a spatula, sprinkle the dough biscuits over the bottom of the pan. Sprinkle with sugar, and spread evenly. Bake for 20 minutes. Remove from the oven and cool on a rack. To serve, add the chocolate.</code></pre></div></span>
<p>Or another one:</p>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"> [NAME]

Mushrooms with Lentil Stewed Shallots and Tomatoes

 [INGREDIENTS]

 1 tablespoon olive oil
 3 cloves garlic, smashed
 Kosher salt
 1 1/2 pounds lean ground turkey
 1 cup coarsely peeled tart apples
 2 tablespoons chopped garlic
 1 teaspoon ground cumin
 1/2 teaspoon cayenne pepper
 1 teaspoon chopped fresh thyme
 3/4 cup chopped fresh basil
 1/2 small carrot, halved lengthwise and cut into 1/2-inch pieces
 1 roasted red pepper, halved and sliced vertically diced and separated into rough chops
 3 tablespoons unsalted butter
 2 cups shredded mozzarella
 1/4 cup grated parmesan cheese
 1/4 cup prepared basil pesto

 [INSTRUCTIONS]

 Stir the olive oil, garlic, thyme and 1 teaspoon salt in a saucepan; bring to a simmer over medium heat. Remove from the heat. Add the basil and toast the soup for 2 minutes.
 Meanwhile, heat 4 to 4 inches vegetable oil in the skillet over medium-high heat. Add the olive oil, garlic, 1/2 teaspoon salt and 1/2 teaspoon pepper and cook, stirring often, until cooked through, a</code></pre></div></span>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 946px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMCAf/EABcBAAMBAAAAAAAAAAAAAAAAAAABAwL/2gAMAwEAAhADEAAAAa5WlaLIXbjMDD//xAAaEAEBAAMBAQAAAAAAAAAAAAABAgASITJB/9oACAEBAAEFAo4EClM49dTX0RzNSc+//8QAFREBAQAAAAAAAAAAAAAAAAAAEAH/2gAIAQMBAT8BKf/EABYRAQEBAAAAAAAAAAAAAAAAABACMf/aAAgBAgEBPwEnD//EAB8QAAIBAgcAAAAAAAAAAAAAAAARAQISECEiMTJBUf/aAAgBAQAGPwJScmuiRU1NFVumfSJtNjLD/8QAHBABAAIDAQEBAAAAAAAAAAAAAQARITFBYVFx/9oACAEBAAE/Ib/U3ZLQACmEB71lQsQKduB4CFoYNwtSjsD+8jnDK99jtP/aAAwDAQACAAMAAAAQ8z8A/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARMf/aAAgBAwEBPxCiVbX/xAAYEQEAAwEAAAAAAAAAAAAAAAABABARMf/aAAgBAgEBPxBMcmJQ9n//xAAcEAEBAAIDAQEAAAAAAAAAAAABEQAhMVFhQXH/2gAIAQEAAT8QbSBM2L3d4TQhDVHue5FLts4PMAUiJ+idkeMr7myD3zDFCgd2+5DZTUXl8wE7oVT6L1kwhBnBn//Z'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Cook real recipes, not with generated ones"
        title=""
        src="/static/bd0d3256b5e96aafe4d1ee2392dd3b59/56d85/09.jpg"
        srcset="/static/bd0d3256b5e96aafe4d1ee2392dd3b59/0479a/09.jpg 250w,
/static/bd0d3256b5e96aafe4d1ee2392dd3b59/41099/09.jpg 500w,
/static/bd0d3256b5e96aafe4d1ee2392dd3b59/56d85/09.jpg 946w"
        sizes="(max-width: 946px) 100vw, 946px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<p> The recipes in this article are generated just for fun and for learning purposes. The recipes are <strong>not</strong> for actual cooking! If you want some real recipes you may check  <a href="https://www.instagram.com/home_full_of_recipes/">home_full_of_recipes</a> Instagram channel.</p>
<h2 id="prior-knowledge" style="position:relative">Prior knowledge<a href="#prior-knowledge" aria-label="prior knowledge permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>It is assumed that you&#x27;re already familiar with concepts of <a href="https://en.wikipedia.org/wiki/Recurrent_neural_network">Recurrent Neural Networks (RNNs)</a> and with <a href="https://en.wikipedia.org/wiki/Long_short-term_memory">Long short-term memory (LSTM)</a> architecture in particular.</p>
<p> In case if these concepts are new to you I would highly recommend taking a <a href="https://www.coursera.org/specializations/deep-learning">Deep Learning Specialization</a> on Coursera by <em>Andrew Ng</em>. It also might be beneficial to go through the <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">Unreasonable Effectiveness of Recurrent Neural Networks</a> article by <em>Andrej Karpathy</em>.</p>
<p>On a high level, <strong>Recurrent Neural Network (RNN)</strong> is a class of deep neural networks, most commonly applied to sequence-based data like speech, voice, text or music. They are used for machine translation, speech recognition, voice synthesis etc. The key feature of RNNs is that they are stateful, and they have an internal memory in which some context for the sequence may be stored. For example if the first word of the sequence was <span><code class="language-text">He</code></span> the RNN might suggest the next word to <span><code class="language-text">speaks</code></span> instead of just <span><code class="language-text">speak</code></span> (to form a <span><code class="language-text">He speaks</code></span> phrase) because the prior knowledge about the first word <span><code class="language-text">He</code></span> is already inside the internal memory.</p>
<img src="/posts-assets/79e174934c03239fc046bf55357ce7bd/0.svg" alt="Recurrent Neural Network"/>
<blockquote>
<p><em>Image source: <a href="https://en.wikipedia.org/wiki/Recurrent_neural_network">Wikipedia</a></em></p>
</blockquote>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 63.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACN0lEQVR42m2Ra08TQRSG92fKH5HPGBM10SgELWljihQLSmuBUqEBtGgvLNhSsbdtzDY2Vrbd7nV2p3uZmaPb5RIJ59s5Oc+Zd96XAwAGDAAQQmKvxwDYtOCukiRJ0zSY7gAAB5QxRWOSzLBDKQ3Gqs5Gyi2MjlUqjajrBjvTYoxxlFFJV/4oo/HEGrtYxmiItIEq+5RckwSY5zqWaVAAQqnPqA/B05ysjl8dbi983onWCs92kq9blchJMXJc6P4SgQbafEJWa8VYeT/ZPl3If4iW96Ol/GI535UGnOrYSf5TJptKbKfnUpt7lYPHW/svv51K5qVyCrD8vfQg/SbBH0Z20/N76Yc7mRenhd+2zsm+kzw+yMWjG5nUk6/VbHrteTa51Cj2zRtjVhqVp7n3G8uxzcy7XCn/iP+x2KxLrskpFlr6sptonyQalbV2JfmztjXorDZ5cXRxDb89rywefYzXi7HqUfy8vNI6Xu3VpQniAMC2MbiuZ5jgeh6yiI3h/6gsjC1nMnEcQ5YNeWxjPPE9yhh36TuymKwyzQBVA0UFQu9I2Seg6qDo4HnhIICpiSjGYa+7zCEsFKxpGiFBYBhjXdfDYTi5gY35KIqvhdbOZUdbdSO4Ypgz92ZEUQSA9fX12fuzQeCEdAUBIXQDXzRaUlsI+2ZvOJDNqRF2tVoNH+z3+81mMzRvOBzatn0FM2ZayLqS7UywP/2SKIo8zwtCcFQQhFqt5nmeqqpnZ2edTsd13X/wX8/yvZTbDBJkAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Basic architectures of GRU and LSTM cells"
        title=""
        src="/static/11ecf20ea5599f22b8bf1c392290aefe/00d43/1.png"
        srcset="/static/11ecf20ea5599f22b8bf1c392290aefe/63868/1.png 250w,
/static/11ecf20ea5599f22b8bf1c392290aefe/0b533/1.png 500w,
/static/11ecf20ea5599f22b8bf1c392290aefe/00d43/1.png 1000w,
/static/11ecf20ea5599f22b8bf1c392290aefe/2cefc/1.png 1400w"
        sizes="(max-width: 1000px) 100vw, 1000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<blockquote>
<p><em>Image source: <a href="https://towardsdatascience.com/illustrated-guide-to-lstms-and-gru-s-a-step-by-step-explanation-44e9eb85bf21">Towards Data Science</a></em></p>
</blockquote>
<p>Exciting part is that RNN (and LSTM in particular) could memorize not only <em>word-to-word</em> dependencies but also <em>character-to-character</em> dependencies! It doesn&#x27;t really matter what sequence consists of: it might be words it might be characters. What is important is that they form a time-distributed sequence. For example, we have a sequence of characters <span><code class="language-text">['H', 'e']</code></span>. If we ask LSTM what may go next it may suggest a <span><code class="language-text">&lt;stop_word></code></span> (meaning, that the sequence that forms word <span><code class="language-text">He</code></span> is already complete, and we may stop), or it may also suggest a character <span><code class="language-text">l</code></span> (meaning, that it tries to build a <span><code class="language-text">Hello</code></span> sequence for us). This type of RNNs are called <strong>character-level RNNs</strong> (as opposed to <strong>word-level RNNs</strong>).</p>
<p>In this tutorial we will rely on this memorization feature of RNN networks, and we will use a character-level version of LSTM to generate cooking recipes.</p>
<h2 id="exploring-the-datasets" style="position:relative">Exploring the datasets<a href="#exploring-the-datasets" aria-label="exploring the datasets permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>Let&#x27;s go through several available datasets and explore their pros and cons. One of the requirements I want the dataset to meet is that it should have not only a list of ingredients but also a cooking instruction. I also want it to have a measures and quantities for each ingredient.</p>
<p>Here are several cooking recipes datasets I&#x27;ve found:</p>
<ul>
<li> <a href="https://www.kaggle.com/kaggle/recipe-ingredients-dataset/home">Recipe Ingredients Dataset</a> <em>(doesn&#x27;t have ingredients proportions)</em></li>
<li> <a href="http://pic2recipe.csail.mit.edu/">Recipe1M+</a> <em>(a lot of recipes but requires registration to download)</em></li>
<li> <a href="https://www.kaggle.com/hugodarwood/epirecipes?select=full_format_recipes.json">Epicurious - Recipes with Rating and Nutrition</a> <em>(~20k recipes only, it would be nice to find more)</em></li>
<li> <a href="https://eightportions.com/datasets/Recipes/">Recipe box</a> <em>(~125,000 recipes with ingredients proportions, good)</em></li>
</ul>
<p>Let&#x27;s try to use the &quot;Recipe box&quot; dataset. The number of recipes looks big enough, also it contains both ingredients and cooking instructions. It is interesting to see if RNN will be able to learn a connection between ingredients and instructions.</p>
<h2 id="setting-tensorflowpython-sandbox-for-training" style="position:relative">Setting TensorFlow/Python sandbox for training<a href="#setting-tensorflowpython-sandbox-for-training" aria-label="setting tensorflowpython sandbox for training permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>There are several options you may follow to experiment with the code in this tutorial:</p>
<ol>
<li>You may experiment by using <a href="https://colab.research.google.com/github/trekhleb/machine-learning-experiments/blob/master/experiments/recipe_generation_rnn/recipe_generation_rnn.ipynb">GoogleColab right in your browser</a> <em>(no local setup is needed)</em>.</li>
<li>You may experiment by using <a href="https://mybinder.org/v2/gh/trekhleb/machine-learning-experiments/master?filepath=experiments/recipe_generation_rnn/recipe_generation_rnn.ipynb">Jupyter notebook in Binder right in your browser</a> <em>(no local setup is needed)</em>.</li>
<li>You may <a href="https://github.com/trekhleb/machine-learning-experiments#how-to-use-this-repository-locally">setup a Jupyter notebook locally</a>.</li>
</ol>
<p>I would suggest going with GoogleColab option since it doesn&#x27;t require any local setup for you (you may experiment right in your browser), and it also provides a powerful GPU support for training that will make the model to train faster. You will be able to experiment with training parameters as well.</p>
<h2 id="importing-dependencies" style="position:relative">Importing dependencies<a href="#importing-dependencies" aria-label="importing dependencies permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>Let&#x27;s start with importing some packages that we will use afterwards.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Packages for training the model and working with the dataset.</span>
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json

<span class="token comment"># Utility/helper packages.</span>
<span class="token keyword">import</span> platform
<span class="token keyword">import</span> time
<span class="token keyword">import</span> pathlib
<span class="token keyword">import</span> os</code></pre></div></span>
<p>First, let&#x27;s make sure our environment is properly set up and that we&#x27;re using a <em>2nd</em> version of Tensorflow.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Python version:'</span><span class="token punctuation">,</span> platform<span class="token punctuation">.</span>python_version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Tensorflow version:'</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Keras version:'</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Python version: 3.7.6
Tensorflow version: 2.1.0
Keras version: 2.2.4-tf</code></pre></div></span>
</blockquote>
<h2 id="loading-the-dataset" style="position:relative">Loading the dataset<a href="#loading-the-dataset" aria-label="loading the dataset permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>Let&#x27;s load the dataset using <a href="https://www.tensorflow.org/api_docs/python/tf/keras/utils/get_file">tf.keras.utils.get_file</a>. Using <span><code class="language-text">get_file()</code></span> utility is convenient because it handles caching for you out of the box. It means that you will download the dataset files only once and then even if you launch the same code block in the notebook once again it will use cache, and the code block will be executed faster.</p>
<p>Create cache folder if it not exists:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">CACHE_DIR <span class="token operator">=</span> <span class="token string">'./tmp'</span>
pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span>CACHE_DIR<span class="token punctuation">)</span><span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre></div></span>
<p>Download and unpack the dataset:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">dataset_file_name <span class="token operator">=</span> <span class="token string">'recipes_raw.zip'</span>
dataset_file_origin <span class="token operator">=</span> <span class="token string">'https://storage.googleapis.com/recipe-box/recipes_raw.zip'</span>

dataset_file_path <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>get_file<span class="token punctuation">(</span>
    fname<span class="token operator">=</span>dataset_file_name<span class="token punctuation">,</span>
    origin<span class="token operator">=</span>dataset_file_origin<span class="token punctuation">,</span>
    cache_dir<span class="token operator">=</span>CACHE_DIR<span class="token punctuation">,</span>
    extract<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    archive_format<span class="token operator">=</span><span class="token string">'zip'</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>dataset_file_path<span class="token punctuation">)</span></code></pre></div></span>
<p>Here is a path to dataset file after it has been downloaded:</p>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">./tmp/datasets/recipes_raw.zip</code></pre></div></span>
</blockquote>
<p>Let&#x27;s print the cache folder and see what exactly has been downloaded:</p>
<span><div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token operator">!</span>ls <span class="token parameter variable">-la</span> ./tmp/datasets/</code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">total 521128
drwxr-xr-x  7        224 May 13 18:10 .
drwxr-xr-x  4        128 May 18 18:00 ..
-rw-r--r--  1      20437 May 20 06:46 LICENSE
-rw-r--r--  1   53355492 May 13 18:10 recipes_raw.zip
-rw-r--r--  1   49784325 May 20 06:46 recipes_raw_nosource_ar.json
-rw-r--r--  1   61133971 May 20 06:46 recipes_raw_nosource_epi.json
-rw-r--r--  1   93702755 May 20 06:46 recipes_raw_nosource_fn.json</code></pre></div></span>
</blockquote>
<p>As you may see, the dataset consists of <em>3</em> files. We need to merge information from those <em>3</em> files into one dataset later.</p>
<p>Let&#x27;s load datasets data from <span><code class="language-text">json</code></span> files and preview examples from them.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">load_dataset</span><span class="token punctuation">(</span>silent<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># List of dataset files we want to merge.</span>
    dataset_file_names <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'recipes_raw_nosource_ar.json'</span><span class="token punctuation">,</span>
        <span class="token string">'recipes_raw_nosource_epi.json'</span><span class="token punctuation">,</span>
        <span class="token string">'recipes_raw_nosource_fn.json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>

    dataset <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> dataset_file_name <span class="token keyword">in</span> dataset_file_names<span class="token punctuation">:</span>
        dataset_file_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>CACHE_DIR<span class="token punctuation">}</span></span><span class="token string">/datasets/</span><span class="token interpolation"><span class="token punctuation">{</span>dataset_file_name<span class="token punctuation">}</span></span><span class="token string">'</span></span>

        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>dataset_file_path<span class="token punctuation">)</span> <span class="token keyword">as</span> dataset_file<span class="token punctuation">:</span>
            json_data_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>dataset_file<span class="token punctuation">)</span>
            json_data_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>json_data_dict<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            dict_keys <span class="token operator">=</span> <span class="token punctuation">[</span>key <span class="token keyword">for</span> key <span class="token keyword">in</span> json_data_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
            dict_keys<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
            dataset <span class="token operator">+=</span> json_data_list

            <span class="token comment"># This code block outputs the summary for each dataset.</span>
            <span class="token keyword">if</span> silent <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>dataset_file_path<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'==========================================='</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Number of examples: '</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>json_data_list<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Example object keys:\n'</span><span class="token punctuation">,</span> dict_keys<span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Example object:\n'</span><span class="token punctuation">,</span> json_data_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Required keys:\n'</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  title: '</span><span class="token punctuation">,</span> json_data_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  ingredients: '</span><span class="token punctuation">,</span> json_data_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'ingredients'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  instructions: '</span><span class="token punctuation">,</span> json_data_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'instructions'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> dataset

dataset_raw <span class="token operator">=</span> load_dataset<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">./tmp/datasets/recipes_raw_nosource_ar.json
===========================================
Number of examples:  39802

Example object keys:
 ['ingredients', 'instructions', 'picture_link', 'title']

Example object:
 {'title': 'Slow Cooker Chicken and Dumplings', 'ingredients': ['4 skinless, boneless chicken breast halves ADVERTISEMENT', '2 tablespoons butter ADVERTISEMENT', '2 (10.75 ounce) cans condensed cream of chicken soup ADVERTISEMENT', '1 onion, finely diced ADVERTISEMENT', '2 (10 ounce) packages refrigerated biscuit dough, torn into pieces ADVERTISEMENT', 'ADVERTISEMENT'], 'instructions': 'Place the chicken, butter, soup, and onion in a slow cooker, and fill with enough water to cover.\nCover, and cook for 5 to 6 hours on High. About 30 minutes before serving, place the torn biscuit dough in the slow cooker. Cook until the dough is no longer raw in the center.\n', 'picture_link': '55lznCYBbs2mT8BTx6BTkLhynGHzM.S'}

Required keys:

  title:  Slow Cooker Chicken and Dumplings

  ingredients:  ['4 skinless, boneless chicken breast halves ADVERTISEMENT', '2 tablespoons butter ADVERTISEMENT', '2 (10.75 ounce) cans condensed cream of chicken soup ADVERTISEMENT', '1 onion, finely diced ADVERTISEMENT', '2 (10 ounce) packages refrigerated biscuit dough, torn into pieces ADVERTISEMENT', 'ADVERTISEMENT']

  instructions:  Place the chicken, butter, soup, and onion in a slow cooker, and fill with enough water to cover.
Cover, and cook for 5 to 6 hours on High. About 30 minutes before serving, place the torn biscuit dough in the slow cooker. Cook until the dough is no longer raw in the center.




./tmp/datasets/recipes_raw_nosource_epi.json
===========================================
Number of examples:  25323

Example object keys:
 ['ingredients', 'instructions', 'picture_link', 'title']

Example object:
 {'ingredients': ['12 egg whites', '12 egg yolks', '1 1/2 cups sugar', '3/4 cup rye whiskey', '12 egg whites', '3/4 cup brandy', '1/2 cup rum', '1 to 2 cups heavy cream, lightly whipped', 'Garnish: ground nutmeg'], 'picture_link': None, 'instructions': 'Beat the egg whites until stiff, gradually adding in 3/4 cup sugar. Set aside. Beat the egg yolks until they are thick and pale and add the other 3/4 cup sugar and stir in rye whiskey. Blend well. Fold the egg white mixture into the yolk mixture and add the brandy and the rum. Beat the mixture well. To serve, fold the lightly whipped heavy cream into the eggnog. (If a thinner mixture is desired, add the heavy cream unwhipped.) Sprinkle the top of the eggnog with the nutmeg to taste.\nBeat the egg whites until stiff, gradually adding in 3/4 cup sugar. Set aside. Beat the egg yolks until they are thick and pale and add the other 3/4 cup sugar and stir in rye whiskey. Blend well. Fold the egg white mixture into the yolk mixture and add the brandy and the rum. Beat the mixture well. To serve, fold the lightly whipped heavy cream into the eggnog. (If a thinner mixture is desired, add the heavy cream unwhipped.) Sprinkle the top of the eggnog with the nutmeg to taste.', 'title': 'Christmas Eggnog '}

Required keys:

  title:  Christmas Eggnog

  ingredients:  ['12 egg whites', '12 egg yolks', '1 1/2 cups sugar', '3/4 cup rye whiskey', '12 egg whites', '3/4 cup brandy', '1/2 cup rum', '1 to 2 cups heavy cream, lightly whipped', 'Garnish: ground nutmeg']

  instructions:  Beat the egg whites until stiff, gradually adding in 3/4 cup sugar. Set aside. Beat the egg yolks until they are thick and pale and add the other 3/4 cup sugar and stir in rye whiskey. Blend well. Fold the egg white mixture into the yolk mixture and add the brandy and the rum. Beat the mixture well. To serve, fold the lightly whipped heavy cream into the eggnog. (If a thinner mixture is desired, add the heavy cream unwhipped.) Sprinkle the top of the eggnog with the nutmeg to taste.
Beat the egg whites until stiff, gradually adding in 3/4 cup sugar. Set aside. Beat the egg yolks until they are thick and pale and add the other 3/4 cup sugar and stir in rye whiskey. Blend well. Fold the egg white mixture into the yolk mixture and add the brandy and the rum. Beat the mixture well. To serve, fold the lightly whipped heavy cream into the eggnog. (If a thinner mixture is desired, add the heavy cream unwhipped.) Sprinkle the top of the eggnog with the nutmeg to taste.



./tmp/datasets/recipes_raw_nosource_fn.json
===========================================
Number of examples:  60039

Example object keys:
 ['ingredients', 'instructions', 'picture_link', 'title']

Example object:
 {'instructions': 'Toss ingredients lightly and spoon into a buttered baking dish. Top with additional crushed cracker crumbs, and brush with melted butter. Bake in a preheated at 350 degrees oven for 25 to 30 minutes or until delicately browned.', 'ingredients': ['1/2 cup celery, finely chopped', '1 small green pepper finely chopped', '1/2 cup finely sliced green onions', '1/4 cup chopped parsley', '1 pound crabmeat', '1 1/4 cups coarsely crushed cracker crumbs', '1/2 teaspoon salt', '3/4 teaspoons dry mustard', 'Dash hot sauce', '1/4 cup heavy cream', '1/2 cup melted butter'], 'title': "Grammie Hamblet's Deviled Crab", 'picture_link': None}

Required keys:

  title:  Grammie Hamblet's Deviled Crab

  ingredients:  ['1/2 cup celery, finely chopped', '1 small green pepper finely chopped', '1/2 cup finely sliced green onions', '1/4 cup chopped parsley', '1 pound crabmeat', '1 1/4 cups coarsely crushed cracker crumbs', '1/2 teaspoon salt', '3/4 teaspoons dry mustard', 'Dash hot sauce', '1/4 cup heavy cream', '1/2 cup melted butter']

  instructions:  Toss ingredients lightly and spoon into a buttered baking dish. Top with additional crushed cracker crumbs, and brush with melted butter. Bake in a preheated at 350 degrees oven for 25 to 30 minutes or until delicately browned.</code></pre></div></span>
</blockquote>
<p>Let&#x27;s count the total number of examples after we merged the files:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Total number of raw examples: '</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_raw<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Total number of raw examples:  125164</code></pre></div></span>
</blockquote>
<h2 id="preprocessing-the-dataset" style="position:relative">Preprocessing the dataset<a href="#preprocessing-the-dataset" aria-label="preprocessing the dataset permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<h3 id="filtering-out-incomplete-examples" style="position:relative">Filtering out incomplete examples<a href="#filtering-out-incomplete-examples" aria-label="filtering out incomplete examples permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>It is possible that some recipes don&#x27;t have some required fields (<em>name</em>, <em>ingredients</em> or <em>instructions</em>). We need to clean our dataset from those incomplete examples.</p>
<p>The following function will help us filter out recipes which don&#x27;t have either title or ingredients or instructions:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">recipe_validate_required_fields</span><span class="token punctuation">(</span>recipe<span class="token punctuation">)</span><span class="token punctuation">:</span>
    required_keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'ingredients'</span><span class="token punctuation">,</span> <span class="token string">'instructions'</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> recipe<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">for</span> required_key <span class="token keyword">in</span> required_keys<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> recipe<span class="token punctuation">[</span>required_key<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>

        <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>recipe<span class="token punctuation">[</span>required_key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>recipe<span class="token punctuation">[</span>required_key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">return</span> <span class="token boolean">True</span></code></pre></div></span>
<p>Let&#x27;s do the filtering now using <span><code class="language-text">recipe_validate_required_fields()</code></span> function:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">dataset_validated <span class="token operator">=</span> <span class="token punctuation">[</span>recipe <span class="token keyword">for</span> recipe <span class="token keyword">in</span> dataset_raw <span class="token keyword">if</span> recipe_validate_required_fields<span class="token punctuation">(</span>recipe<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Dataset size BEFORE validation'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_raw<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Dataset size AFTER validation'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_validated<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Number of incomplete recipes'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_raw<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_validated<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Dataset size BEFORE validation 125164
Dataset size AFTER validation 122938
Number of incomplete recipes 2226</code></pre></div></span>
</blockquote>
<p>As you may see among <span><code class="language-text">125164</code></span> recipes we had <span><code class="language-text">2226</code></span> somehow incomplete.</p>
<h3 id="converting-recipes-objects-into-strings" style="position:relative">Converting recipes objects into strings<a href="#converting-recipes-objects-into-strings" aria-label="converting recipes objects into strings permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>RNN doesn&#x27;t understand objects. Therefore, we need to convert recipes objects to string and then to numbers (indices). Let&#x27;s start with converting recipes objects to strings.</p>
<p>To help our RNN learn the structure of the text faster let&#x27;s add 3 &quot;landmarks&quot; to it. We will use these unique &quot;title&quot;, &quot;ingredients&quot; and &quot;instruction&quot; landmarks to separate the logic sections of each recipe.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">STOP_WORD_TITLE <span class="token operator">=</span> <span class="token string">' '</span>
STOP_WORD_INGREDIENTS <span class="token operator">=</span> <span class="token string">'\n\n\n'</span>
STOP_WORD_INSTRUCTIONS <span class="token operator">=</span> <span class="token string">'\n\n\n'</span></code></pre></div></span>
<p>The following function converts the recipe object to a string (sequence of characters) for later usage in RNN input.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">recipe_to_string</span><span class="token punctuation">(</span>recipe<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># This string is presented as a part of recipes so we need to clean it up.</span>
    noize_string <span class="token operator">=</span> <span class="token string">'ADVERTISEMENT'</span>

    title <span class="token operator">=</span> recipe<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>
    ingredients <span class="token operator">=</span> recipe<span class="token punctuation">[</span><span class="token string">'ingredients'</span><span class="token punctuation">]</span>
    instructions <span class="token operator">=</span> recipe<span class="token punctuation">[</span><span class="token string">'instructions'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>

    ingredients_string <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> ingredient <span class="token keyword">in</span> ingredients<span class="token punctuation">:</span>
        ingredient <span class="token operator">=</span> ingredient<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>noize_string<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> ingredient<span class="token punctuation">:</span>
            ingredients_string <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f' </span><span class="token interpolation"><span class="token punctuation">{</span>ingredient<span class="token punctuation">}</span></span><span class="token string">\n'</span></span>

    instructions_string <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> instruction <span class="token keyword">in</span> instructions<span class="token punctuation">:</span>
        instruction <span class="token operator">=</span> instruction<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>noize_string<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> instruction<span class="token punctuation">:</span>
            instructions_string <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f' </span><span class="token interpolation"><span class="token punctuation">{</span>instruction<span class="token punctuation">}</span></span><span class="token string">\n'</span></span>

    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>STOP_WORD_TITLE<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token punctuation">{</span>STOP_WORD_INGREDIENTS<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>ingredients_string<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>STOP_WORD_INSTRUCTIONS<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>instructions_string<span class="token punctuation">}</span></span><span class="token string">'</span></span></code></pre></div></span>
<p>Let&#x27;s apply <span><code class="language-text">recipe_to_string()</code></span> function to <span><code class="language-text">dataset_validated</code></span>:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">dataset_stringified <span class="token operator">=</span> <span class="token punctuation">[</span>recipe_to_string<span class="token punctuation">(</span>recipe<span class="token punctuation">)</span> <span class="token keyword">for</span> recipe <span class="token keyword">in</span> dataset_validated<span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Stringified dataset size: '</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_stringified<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Stringified dataset size:  122938</code></pre></div></span>
</blockquote>
<p>Let&#x27;s preview first several recipes:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> recipe_index<span class="token punctuation">,</span> recipe_string <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>dataset_stringified<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recipe #{}\n---------'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>recipe_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>recipe_string<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Recipe #1
---------
 Slow Cooker Chicken and Dumplings



 4 skinless, boneless chicken breast halves
 2 tablespoons butter
 2 (10.75 ounce) cans condensed cream of chicken soup
 1 onion, finely diced
 2 (10 ounce) packages refrigerated biscuit dough, torn into pieces



 Place the chicken, butter, soup, and onion in a slow cooker, and fill with enough water to cover.
 Cover, and cook for 5 to 6 hours on High. About 30 minutes before serving, place the torn biscuit dough in the slow cooker. Cook until the dough is no longer raw in the center.



Recipe #2
---------
 Awesome Slow Cooker Pot Roast



 2 (10.75 ounce) cans condensed cream of mushroom soup
 1 (1 ounce) package dry onion soup mix
 1 1/4 cups water
 5 1/2 pounds pot roast



 In a slow cooker, mix cream of mushroom soup, dry onion soup mix and water. Place pot roast in slow cooker and coat with soup mixture.
 Cook on High setting for 3 to 4 hours, or on Low setting for 8 to 9 hours.



Recipe #3
---------
 Brown Sugar Meatloaf



 1/2 cup packed brown sugar
 1/2 cup ketchup
 1 1/2 pounds lean ground beef
 3/4 cup milk
 2 eggs
 1 1/2 teaspoons salt
 1/4 teaspoon ground black pepper
 1 small onion, chopped
 1/4 teaspoon ground ginger
 3/4 cup finely crushed saltine cracker crumbs



 Preheat oven to 350 degrees F (175 degrees C). Lightly grease a 5x9 inch loaf pan.
 Press the brown sugar in the bottom of the prepared loaf pan and spread the ketchup over the sugar.
 In a mixing bowl, mix thoroughly all remaining ingredients and shape into a loaf. Place on top of the ketchup.
 Bake in preheated oven for 1 hour or until juices are clear.</code></pre></div></span>
</blockquote>
<p>Just out of curiosity let&#x27;s preview the recipe somewhere from the middle of the dataset to see that it has expected data structure:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>dataset_stringified<span class="token punctuation">[</span><span class="token number">50000</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"> Herbed Bean Ragot



 6 ounces haricots verts (French thin green beans), trimmed and halved crosswise
 1 (1-pound) bag frozen edamame (soybeans in the pod) or 1 1/4 cups frozen shelled edamame, not thawed
 2/3 cup finely chopped onion
 2 garlic cloves, minced
 1 Turkish bay leaf or 1/2 California bay leaf
 2 (3-inch) fresh rosemary sprigs
 1/2 teaspoon salt
 1/4 teaspoon black pepper
 1 tablespoon olive oil
 1 medium carrot, cut into 1/8-inch dice
 1 medium celery rib, cut into 1/8-inch dice
 1 (15- to 16-ounces) can small white beans, rinsed and drained
 1 1/2 cups chicken stock or low-sodium broth
 2 tablespoons unsalted butter
 2 tablespoons finely chopped fresh flat-leaf parsley
 1 tablespoon finely chopped fresh chervil (optional)
 Garnish: fresh chervil sprigs



 Cook haricots verts in a large pot of boiling salted water until just tender, 3 to 4 minutes. Transfer with a slotted spoon to a bowl of ice and cold water, then drain. Add edamame to boiling water and cook 4 minutes. Drain in a colander, then rinse under cold water. If using edamame in pods, shell them and discard pods. Cook onion, garlic, bay leaf, rosemary, salt, and pepper in oil in a 2- to 4-quart heavy saucepan over moderately low heat, stirring, until softened, about 3 minutes. Add carrot and celery and cook, stirring, until softened, about 3 minutes. Add white beans and stock and simmer, covered, stirring occasionally, 10 minutes. Add haricots verts and edamame and simmer, uncovered, until heated through, 2 to 3 minutes. Add butter, parsley, and chervil (if using) and stir gently until butter is melted. Discard bay leaf and rosemary sprigs.
 Cook haricots verts in a large pot of boiling salted water until just tender, 3 to 4 minutes. Transfer with a slotted spoon to a bowl of ice and cold water, then drain.
 Add edamame to boiling water and cook 4 minutes. Drain in a colander, then rinse under cold water. If using edamame in pods, shell them and discard pods.
 Cook onion, garlic, bay leaf, rosemary, salt, and pepper in oil in a 2- to 4-quart heavy saucepan over moderately low heat, stirring, until softened, about 3 minutes. Add carrot and celery and cook, stirring, until softened, about 3 minutes.
 Add white beans and stock and simmer, covered, stirring occasionally, 10 minutes. Add haricots verts and edamame and simmer, uncovered, until heated through, 2 to 3 minutes. Add butter, parsley, and chervil (if using) and stir gently until butter is melted. Discard bay leaf and rosemary sprigs.</code></pre></div></span>
</blockquote>
<h3 id="filtering-out-large-recipes" style="position:relative">Filtering out large recipes<a href="#filtering-out-large-recipes" aria-label="filtering out large recipes permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>Recipes have different lengths. We need to have one <em>hard-coded sequence length</em> limit before feeding recipe sequences to RNN. We need to find out what recipe length will cover most of the recipe use-cases and at the same time we want to keep it as small as possible to speed up the training process.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">recipes_lengths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> recipe_text <span class="token keyword">in</span> dataset_stringified<span class="token punctuation">:</span>
    recipes_lengths<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>recipe_text<span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>recipes_lengths<span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 388px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 64%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABgElEQVR42q1Tu0oDQRS9KmIwWCxigvj6gzRpgt9ga+tHWAsiiEUqS8VCEKuFIKiQRpMlSsQ8lMRC1CJZEzb7yr7VyG72ysQJaOcmDhxm7txzz5wZ7gAijgAA1Ouv201ZTRuGkTIM4yQgUpZlpQVB2AGWZceIoNzWsveSi77vexhw9Gts274ChmEWAWBGlNVMvm6T/U9CCAJSQwodx+EAEUeJQ1Fpc4XG+1AOHcfJQTQajQDA1L8JxuPxSeLQNg3usNBC2frwvkkDCsZisTARfLNNLnnJI686wwmG6ZWfeJFbO6qiZA7pcJW2zXNTyq7slbDa0HvJbgDFX4IhhlkAAIYX1IvlZA5PK0IHEV3X67pk/iM6VDALm7Rt+JbCJXbLuHH+0jvN6/qDNXb/65Wrj/uJrbO7pXU2d5ypFHlBziuqlpckqWia5rUsywVFUW7JWhTFkqZpN7qu9/M5VVUfarXaAdBBXE4AwDiNZ2kcAoA5ACDvPE1BuPMAEKacn/nIFzu7Rboe0y3eAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Recipes lengths 1"
        title=""
        src="/static/42704f5abc08216d5d26d0c9347b62e2/96c67/2.png"
        srcset="/static/42704f5abc08216d5d26d0c9347b62e2/63868/2.png 250w,
/static/42704f5abc08216d5d26d0c9347b62e2/96c67/2.png 388w"
        sizes="(max-width: 388px) 100vw, 388px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<p>Most of the recipes have length less than <span><code class="language-text">5000</code></span> characters. Let&#x27;s zoom in to see more detailed picture:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>recipes_lengths<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 387px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 64.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACGElEQVR42pVSS2gTURQ9VkVsa7VpamrBCFKCBCpIIItsssrKbLN14Sork1qkKNV+xIW4ETcuBBctE1HBTlE0Eq1QpTZTddNUqUHSGmPTzEwyM1DSOp8rbzpSspHkwuG9e7nvvHMvBx6P5zgAdz6fj0mSdOdHaXNCFOWbstwSJqvV6u1CoXARwWCwCwAqlQpHRPRg4ZdeUrbZlSyLmgrLsgx2KoryDn6/3wXgoCTJU6x44WF2m8v+1IlIN0yyzyZgK9A0LQOfz+dmhJpSm2bFwfG0PjqzbP9smlZLClVVnUMgEDgKYF+tKtkjn514rZ+/936vuVVCZ4cdWk1KMd2DY2nDO/KcVsvarsomFtlAGI1G25lCc0tN5USdepO83nd5llKL63azYbZIGIlEOgC0UV3jcuIf8gzN6j1Jni49+tL0HhsIQ6HQEQDtjHBF1Mmd5HXvyAs6c/0VfdvQmlLZQBiLxQ4zH1p1bTrzXSFXYmZn4NpLw5XgjfjUJ9bowDLYQwbT3MW/nIh2HMI3CIfDnQAOUV3l7n7YpGPDaX1gbI5O33hL/VczNMyvUnnL+K/RG4xNRG1Mofh77db4s8/LXfHUwqmhJ0snk0+z3sTjpe44J5wb5YUrqY8CN/9VmM+tCSuFcnZ9QxJKFdlGRa4uKoqaKxaL9+HEfgBs9AMAmC/7AHQD8JwA3J1AL/bgdsB6XE6tB0A/y/8CWscS/XtvSEsAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Recipes lengths 2"
        title=""
        src="/static/3cc69385b2215b463ccdb324f0724a68/691c3/3.png"
        srcset="/static/3cc69385b2215b463ccdb324f0724a68/63868/3.png 250w,
/static/3cc69385b2215b463ccdb324f0724a68/691c3/3.png 387w"
        sizes="(max-width: 387px) 100vw, 387px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<p>Looks like a limit of <span><code class="language-text">2000</code></span> characters for the recipes will cover most of the cases. We may try to train RNN with this maximum recipe length limit.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">MAX_RECIPE_LENGTH <span class="token operator">=</span> <span class="token number">2000</span></code></pre></div></span>
<p>Therefore, let&#x27;s filter out all the recipes that are longer than <span><code class="language-text">MAX_RECIPE_LENGTH</code></span>:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">filter_recipes_by_length</span><span class="token punctuation">(</span>recipe_test<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>recipe_test<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> MAX_RECIPE_LENGTH

dataset_filtered <span class="token operator">=</span> <span class="token punctuation">[</span>recipe_text <span class="token keyword">for</span> recipe_text <span class="token keyword">in</span> dataset_stringified <span class="token keyword">if</span> filter_recipes_by_length<span class="token punctuation">(</span>recipe_text<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Dataset size BEFORE filtering: '</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_stringified<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Dataset size AFTER filtering: '</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_filtered<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Number of eliminated recipes: '</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_stringified<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_filtered<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Dataset size BEFORE filtering:  122938
Dataset size AFTER filtering:  100212
Number of eliminated recipes:  22726</code></pre></div></span>
</blockquote>
<p>We lost <span><code class="language-text">22726</code></span> recipes during this filtering but now recipes&#x27; data is more dense.</p>
<h3 id="summarizing-dataset-parameters" style="position:relative">Summarizing dataset parameters<a href="#summarizing-dataset-parameters" aria-label="summarizing dataset parameters permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">TOTAL_RECIPES_NUM <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_filtered<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'MAX_RECIPE_LENGTH: '</span><span class="token punctuation">,</span> MAX_RECIPE_LENGTH<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'TOTAL_RECIPES_NUM: '</span><span class="token punctuation">,</span> TOTAL_RECIPES_NUM<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">MAX_RECIPE_LENGTH:  2000
TOTAL_RECIPES_NUM:  100212</code></pre></div></span>
</blockquote>
<p>Finally, we ended up with <span><code class="language-text">~100k</code></span> recipes. Each recipe has <span><code class="language-text">2000</code></span> characters length.</p>
<h2 id="creating-vocabulary" style="position:relative">Creating vocabulary<a href="#creating-vocabulary" aria-label="creating vocabulary permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>Recurrent neural network doesn&#x27;t understand characters or words. It understands numbers instead. Therefore, we need to convert recipe texts to numbers.</p>
<p>In this experiment we&#x27;re going to use a <strong>character-level</strong> language model based on multi-layer LSTM (Long Short-Term Memory) network (as opposed to <strong>word-level</strong> language model). It means that instead of creating unique indices for words we will create unique indices for characters. By doing that we let the network predict the next <em>character</em> instead of the next <em>word</em> in a sequence.</p>
<p> You may find more details about character-level RNNs explanation in the <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">Unreasonable Effectiveness of Recurrent Neural Networks</a> article by <em>Andrej Karpathy</em>:</p>
<p>To create a vocabulary out of recipes texts we will use <a href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/text/Tokenizer">tf.keras.preprocessing.text.Tokenizer</a>.</p>
<p>We also need to come with some unique character that will be treated as a <em>stop-character</em> and will indicate the end of a recipe. We need it for recipe generation afterwards since without this stop-character we won&#x27;t know where the end of a recipe that we&#x27;re generating is.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">STOP_SIGN <span class="token operator">=</span> <span class="token string">''</span>

tokenizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>preprocessing<span class="token punctuation">.</span>text<span class="token punctuation">.</span>Tokenizer<span class="token punctuation">(</span>
    char_level<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    filters<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    lower<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
    split<span class="token operator">=</span><span class="token string">''</span>
<span class="token punctuation">)</span>

<span class="token comment"># Stop word is not a part of recipes, but tokenizer must know about it as well.</span>
tokenizer<span class="token punctuation">.</span>fit_on_texts<span class="token punctuation">(</span><span class="token punctuation">[</span>STOP_SIGN<span class="token punctuation">]</span><span class="token punctuation">)</span>

tokenizer<span class="token punctuation">.</span>fit_on_texts<span class="token punctuation">(</span>dataset_filtered<span class="token punctuation">)</span>

tokenizer<span class="token punctuation">.</span>get_config<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">{'num_words': None,
 'filters': '',
 'lower': False,
 'split': '',
 'char_level': True,
 'oov_token': None,
 'document_count': 100213,

 'word_counts': '{"\\u2423": 1, "\\ud83d\\udcd7": 100212, " ": 17527888, "S": 270259, "l": 3815150, "o": 5987496, "w": 964459, "C": 222831, "k": 890982, "e": 9296022, "r": 4760887, "h": 2922100, "i": 4911812, "c": 2883507, "n": 5304396, "a": 6067157, "d": 3099679, "D": 63999, "u": 2717050, "m": 1794411, "p": 2679164, "g": 1698670, "s": 4704222, "\\n": 1955281, "\\ud83e\\udd55": 100212, "\\u2022": 922813, "4": 232607, ",": 1130487, "b": 1394803, "t": 5997722, "v": 746785, "2": 493933, "(": 144985, "1": 853931, "0": 145119, ".": 1052548, "7": 31098, "5": 154071, ")": 144977, "f": 1042981, "y": 666553, "\\ud83d\\udcdd": 100212, "\\u25aa": 331058, "\\ufe0e": 331058, "P": 200597, "6": 51398, "H": 43936, "A": 134274, "3": 213519, "R": 101253, "x": 201286, "/": 345257, "I": 81591, "L": 46138, "8": 55352, "9": 17697, "B": 123813, "M": 78684, "F": 104359, "j": 110008, "-": 219160, "W": 61616, "\\u00ae": 10159, "N": 12808, "q": 69654, "T": 101371, ";": 72045, "\'": 26831, "Z": 2428, "z": 115883, "G": 52043, ":": 31318, "E": 18582, "K": 18421, "X": 385, "\\"": 6445, "O": 28971, "Y": 6064, "\\u2122": 538, "Q": 3904, "J": 10269, "!": 3014, "U": 14132, "V": 12172, "&amp;": 1039, "+": 87, "=": 113, "%": 993, "*": 3243, "\\u00a9": 99, "[": 30, "]": 31, "\\u00e9": 6727, "&lt;": 76, ">": 86, "\\u00bd": 166, "#": 168, "\\u00f1": 891, "?": 327, "\\u2019": 111, "\\u00b0": 6808, "\\u201d": 6, "$": 84, "@": 5, "{": 8, "}": 9, "\\u2013": 1228, "\\u0096": 7, "\\u00e0": 26, "\\u00e2": 106, "\\u00e8": 846, "\\u00e1": 74, "\\u2014": 215, "\\u2044": 16, "\\u00ee": 415, "\\u00e7": 171, "_": 26, "\\u00fa": 48, "\\u00ef": 43, "\\u201a": 20, "\\u00fb": 36, "\\u00f3": 74, "\\u00ed": 130, "\\u25ca": 4, "\\u00f9": 12, "\\u00d7": 6, "\\u00ec": 8, "\\u00fc": 29, "\\u2031": 4, "\\u00ba": 19, "\\u201c": 4, "\\u00ad": 25, "\\u00ea": 27, "\\u00f6": 9, "\\u0301": 11, "\\u00f4": 8, "\\u00c1": 2, "\\u00be": 23, "\\u00bc": 95, "\\u00eb": 2, "\\u0097": 2, "\\u215b": 3, "\\u2027": 4, "\\u00e4": 15, "\\u001a": 2, "\\u00f8": 2, "\\ufffd": 20, "\\u02da": 6, "\\u00bf": 264, "\\u2153": 2, "|": 2, "\\u00e5": 3, "\\u00a4": 1, "\\u201f": 1, "\\u00a7": 5, "\\ufb02": 3, "\\u00a0": 1, "\\u01b0": 2, "\\u01a1": 1, "\\u0103": 1, "\\u0300": 1, "\\u00bb": 6, "`": 3, "\\u0092": 2, "\\u215e": 1, "\\u202d": 4, "\\u00b4": 2, "\\u2012": 2, "\\u00c9": 40, "\\u00da": 14, "\\u20ac": 1, "\\\\": 5, "~": 1, "\\u0095": 1, "\\u00c2": 2}',

 'word_docs': '{"\\u2423": 1, "k": 97316, "0": 61954, "o": 100205, "r": 100207, "d": 100194, "u": 100161, "S": 89250, "\\u25aa": 100212, "D": 40870, "1": 99320, "g": 99975, "n": 100198, "b": 99702, "t": 100202, ".": 100163, " ": 100212, "7": 24377, "3": 79135, "\\ud83d\\udcd7": 100212, "i": 100207, "5": 65486, "f": 98331, "c": 100190, "4": 82453, "a": 100205, "2": 96743, "v": 97848, "C": 83328, "s": 100204, "\\n": 100212, "6": 35206, "\\ud83d\\udcdd": 100212, ",": 98524, "\\ufe0e": 100212, "l": 100206, "e": 100212, "y": 96387, ")": 67614, "p": 100046, "H": 31908, "\\ud83e\\udd55": 100212, "m": 99988, "w": 99227, "(": 67627, "A": 60900, "h": 100161, "\\u2022": 100212, "P": 79364, "R": 54040, "9": 14114, "8": 37000, "L": 32101, "x": 72133, "I": 46675, "/": 89051, "j": 47438, "F": 57940, "B": 64278, "M": 48332, "-": 74711, "T": 53758, "\\u00ae": 5819, "N": 9981, "W": 38981, "q": 36538, ";": 33863, "G": 35355, "\'": 18120, "z": 42430, "Z": 2184, ":": 18214, "E": 12161, "K": 14834, "X": 321, "\\"": 2617, "O": 20103, "Y": 5148, "\\u2122": 448, "Q": 3142, "J": 8225, "!": 2428, "U": 10621, "V": 9710, "&amp;": 749, "+": 32, "=": 48, "%": 717, "*": 1780, "\\u00a9": 91, "]": 26, "[": 25, "\\u00e9": 2462, ">": 33, "&lt;": 27, "\\u00bd": 81, "#": 139, "\\u00f1": 423, "?": 207, "\\u2019": 64, "\\u00b0": 3062, "\\u201d": 3, "@": 4, "$": 49, "{": 7, "}": 8, "\\u2013": 491, "\\u0096": 7, "\\u00e0": 22, "\\u00e2": 45, "\\u00e8": 335, "\\u00e1": 38, "\\u2014": 95, "\\u2044": 9, "\\u00ee": 122, "\\u00e7": 120, "_": 8, "\\u00fa": 25, "\\u00ef": 24, "\\u201a": 10, "\\u00fb": 29, "\\u00f3": 40, "\\u00ed": 52, "\\u25ca": 2, "\\u00f9": 6, "\\u00d7": 4, "\\u00ec": 4, "\\u00fc": 19, "\\u2031": 2, "\\u00ba": 9, "\\u201c": 2, "\\u00ad": 11, "\\u00ea": 4, "\\u00f6": 4, "\\u0301": 6, "\\u00f4": 5, "\\u00c1": 2, "\\u00be": 18, "\\u00bc": 55, "\\u00eb": 2, "\\u0097": 1, "\\u215b": 2, "\\u2027": 3, "\\u00e4": 8, "\\u001a": 1, "\\u00f8": 1, "\\ufffd": 4, "\\u02da": 3, "\\u00bf": 191, "\\u2153": 1, "|": 2, "\\u00e5": 1, "\\u00a4": 1, "\\u201f": 1, "\\u00a7": 3, "\\ufb02": 1, "\\u0300": 1, "\\u01a1": 1, "\\u00a0": 1, "\\u01b0": 1, "\\u0103": 1, "\\u00bb": 2, "`": 3, "\\u0092": 2, "\\u215e": 1, "\\u202d": 1, "\\u00b4": 1, "\\u2012": 1, "\\u00c9": 15, "\\u00da": 5, "\\u20ac": 1, "\\\\": 5, "~": 1, "\\u0095": 1, "\\u00c2": 1}',

 'index_docs': '{"1": 100212, "165": 1, "25": 97316, "41": 61954, "5": 100205, "8": 100207, "11": 100194, "14": 100161, "33": 89250, "31": 100212, "58": 40870, "26": 99320, "18": 99975, "6": 100198, "19": 99702, "4": 100202, "21": 100163, "66": 24377, "37": 79135, "51": 100212, "7": 100207, "40": 65486, "22": 98331, "13": 100190, "34": 82453, "3": 100205, "29": 96743, "27": 97848, "35": 83328, "9": 100204, "16": 100212, "62": 35206, "53": 100212, "20": 98524, "32": 100212, "10": 100206, "2": 100212, "28": 96387, "43": 67614, "15": 100046, "64": 31908, "52": 100212, "17": 99988, "23": 99227, "42": 67627, "44": 60900, "12": 100161, "24": 100212, "39": 79364, "50": 54040, "71": 14114, "60": 37000, "63": 32101, "38": 72133, "54": 46675, "30": 89051, "47": 47438, "48": 57940, "45": 64278, "55": 48332, "36": 74711, "49": 53758, "76": 5819, "73": 9981, "59": 38981, "57": 36538, "56": 33863, "61": 35355, "68": 18120, "46": 42430, "84": 2184, "65": 18214, "69": 12161, "70": 14834, "92": 321, "79": 2617, "67": 20103, "80": 5148, "90": 448, "81": 3142, "75": 8225, "83": 2428, "72": 10621, "74": 9710, "86": 749, "105": 32, "100": 48, "87": 717, "82": 1780, "103": 91, "115": 26, "116": 25, "78": 2462, "106": 33, "108": 27, "98": 81, "97": 139, "88": 423, "93": 207, "101": 64, "77": 3062, "137": 3, "141": 4, "107": 49, "133": 7, "131": 8, "85": 491, "136": 7, "119": 22, "102": 45, "89": 335, "109": 38, "95": 95, "126": 9, "91": 122, "96": 120, "120": 8, "111": 25, "112": 24, "123": 10, "114": 29, "110": 40, "99": 52, "144": 2, "129": 6, "138": 4, "134": 4, "117": 19, "145": 2, "125": 9, "146": 2, "121": 11, "118": 4, "132": 4, "130": 6, "135": 5, "153": 2, "122": 18, "104": 55, "154": 2, "155": 1, "149": 2, "147": 3, "127": 8, "156": 1, "157": 1, "124": 4, "139": 3, "94": 191, "158": 1, "159": 2, "150": 1, "166": 1, "167": 1, "142": 3, "151": 1, "171": 1, "169": 1, "168": 1, "160": 1, "170": 1, "140": 2, "152": 3, "161": 2, "172": 1, "148": 1, "162": 1, "163": 1, "113": 15, "128": 5, "173": 1, "143": 5, "174": 1, "175": 1, "164": 1}',

 'index_word': '{"1": " ", "2": "e", "3": "a", "4": "t", "5": "o", "6": "n", "7": "i", "8": "r", "9": "s", "10": "l", "11": "d", "12": "h", "13": "c", "14": "u", "15": "p", "16": "\\n", "17": "m", "18": "g", "19": "b", "20": ",", "21": ".", "22": "f", "23": "w", "24": "\\u2022", "25": "k", "26": "1", "27": "v", "28": "y", "29": "2", "30": "/", "31": "\\u25aa", "32": "\\ufe0e", "33": "S", "34": "4", "35": "C", "36": "-", "37": "3", "38": "x", "39": "P", "40": "5", "41": "0", "42": "(", "43": ")", "44": "A", "45": "B", "46": "z", "47": "j", "48": "F", "49": "T", "50": "R", "51": "\\ud83d\\udcd7", "52": "\\ud83e\\udd55", "53": "\\ud83d\\udcdd", "54": "I", "55": "M", "56": ";", "57": "q", "58": "D", "59": "W", "60": "8", "61": "G", "62": "6", "63": "L", "64": "H", "65": ":", "66": "7", "67": "O", "68": "\'", "69": "E", "70": "K", "71": "9", "72": "U", "73": "N", "74": "V", "75": "J", "76": "\\u00ae", "77": "\\u00b0", "78": "\\u00e9", "79": "\\"", "80": "Y", "81": "Q", "82": "*", "83": "!", "84": "Z", "85": "\\u2013", "86": "&amp;", "87": "%", "88": "\\u00f1", "89": "\\u00e8", "90": "\\u2122", "91": "\\u00ee", "92": "X", "93": "?", "94": "\\u00bf", "95": "\\u2014", "96": "\\u00e7", "97": "#", "98": "\\u00bd", "99": "\\u00ed", "100": "=", "101": "\\u2019", "102": "\\u00e2", "103": "\\u00a9", "104": "\\u00bc", "105": "+", "106": ">", "107": "$", "108": "&lt;", "109": "\\u00e1", "110": "\\u00f3", "111": "\\u00fa", "112": "\\u00ef", "113": "\\u00c9", "114": "\\u00fb", "115": "]", "116": "[", "117": "\\u00fc", "118": "\\u00ea", "119": "\\u00e0", "120": "_", "121": "\\u00ad", "122": "\\u00be", "123": "\\u201a", "124": "\\ufffd", "125": "\\u00ba", "126": "\\u2044", "127": "\\u00e4", "128": "\\u00da", "129": "\\u00f9", "130": "\\u0301", "131": "}", "132": "\\u00f6", "133": "{", "134": "\\u00ec", "135": "\\u00f4", "136": "\\u0096", "137": "\\u201d", "138": "\\u00d7", "139": "\\u02da", "140": "\\u00bb", "141": "@", "142": "\\u00a7", "143": "\\\\", "144": "\\u25ca", "145": "\\u2031", "146": "\\u201c", "147": "\\u2027", "148": "\\u202d", "149": "\\u215b", "150": "\\u00e5", "151": "\\ufb02", "152": "`", "153": "\\u00c1", "154": "\\u00eb", "155": "\\u0097", "156": "\\u001a", "157": "\\u00f8", "158": "\\u2153", "159": "|", "160": "\\u01b0", "161": "\\u0092", "162": "\\u00b4", "163": "\\u2012", "164": "\\u00c2", "165": "\\u2423", "166": "\\u00a4", "167": "\\u201f", "168": "\\u00a0", "169": "\\u01a1", "170": "\\u0103", "171": "\\u0300", "172": "\\u215e", "173": "\\u20ac", "174": "~", "175": "\\u0095"}',

 'word_index': '{" ": 1, "e": 2, "a": 3, "t": 4, "o": 5, "n": 6, "i": 7, "r": 8, "s": 9, "l": 10, "d": 11, "h": 12, "c": 13, "u": 14, "p": 15, "\\n": 16, "m": 17, "g": 18, "b": 19, ",": 20, ".": 21, "f": 22, "w": 23, "\\u2022": 24, "k": 25, "1": 26, "v": 27, "y": 28, "2": 29, "/": 30, "\\u25aa": 31, "\\ufe0e": 32, "S": 33, "4": 34, "C": 35, "-": 36, "3": 37, "x": 38, "P": 39, "5": 40, "0": 41, "(": 42, ")": 43, "A": 44, "B": 45, "z": 46, "j": 47, "F": 48, "T": 49, "R": 50, "\\ud83d\\udcd7": 51, "\\ud83e\\udd55": 52, "\\ud83d\\udcdd": 53, "I": 54, "M": 55, ";": 56, "q": 57, "D": 58, "W": 59, "8": 60, "G": 61, "6": 62, "L": 63, "H": 64, ":": 65, "7": 66, "O": 67, "\'": 68, "E": 69, "K": 70, "9": 71, "U": 72, "N": 73, "V": 74, "J": 75, "\\u00ae": 76, "\\u00b0": 77, "\\u00e9": 78, "\\"": 79, "Y": 80, "Q": 81, "*": 82, "!": 83, "Z": 84, "\\u2013": 85, "&amp;": 86, "%": 87, "\\u00f1": 88, "\\u00e8": 89, "\\u2122": 90, "\\u00ee": 91, "X": 92, "?": 93, "\\u00bf": 94, "\\u2014": 95, "\\u00e7": 96, "#": 97, "\\u00bd": 98, "\\u00ed": 99, "=": 100, "\\u2019": 101, "\\u00e2": 102, "\\u00a9": 103, "\\u00bc": 104, "+": 105, ">": 106, "$": 107, "&lt;": 108, "\\u00e1": 109, "\\u00f3": 110, "\\u00fa": 111, "\\u00ef": 112, "\\u00c9": 113, "\\u00fb": 114, "]": 115, "[": 116, "\\u00fc": 117, "\\u00ea": 118, "\\u00e0": 119, "_": 120, "\\u00ad": 121, "\\u00be": 122, "\\u201a": 123, "\\ufffd": 124, "\\u00ba": 125, "\\u2044": 126, "\\u00e4": 127, "\\u00da": 128, "\\u00f9": 129, "\\u0301": 130, "}": 131, "\\u00f6": 132, "{": 133, "\\u00ec": 134, "\\u00f4": 135, "\\u0096": 136, "\\u201d": 137, "\\u00d7": 138, "\\u02da": 139, "\\u00bb": 140, "@": 141, "\\u00a7": 142, "\\\\": 143, "\\u25ca": 144, "\\u2031": 145, "\\u201c": 146, "\\u2027": 147, "\\u202d": 148, "\\u215b": 149, "\\u00e5": 150, "\\ufb02": 151, "`": 152, "\\u00c1": 153, "\\u00eb": 154, "\\u0097": 155, "\\u001a": 156, "\\u00f8": 157, "\\u2153": 158, "|": 159, "\\u01b0": 160, "\\u0092": 161, "\\u00b4": 162, "\\u2012": 163, "\\u00c2": 164, "\\u2423": 165, "\\u00a4": 166, "\\u201f": 167, "\\u00a0": 168, "\\u01a1": 169, "\\u0103": 170, "\\u0300": 171, "\\u215e": 172, "\\u20ac": 173, "~": 174, "\\u0095": 175}'}</code></pre></div></span>
</blockquote>
<p>To get a full size of a vocabulary we need to add <span><code class="language-text">+1</code></span> to the number of already registered characters because <a href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/text/Tokenizer">index <span><code class="language-text">0</code></span> is a reserved index that won&#x27;t be assigned to any word</a>.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">VOCABULARY_SIZE <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>word_counts<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'VOCABULARY_SIZE: '</span><span class="token punctuation">,</span> VOCABULARY_SIZE<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">VOCABULARY_SIZE:  176</code></pre></div></span>
</blockquote>
<p>Let&#x27;s play around with tokenizer dictionaries to see how we may convert characters to indices and vice-versa:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>index_word<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>index_word<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">o
,</code></pre></div></span>
</blockquote>
<p>Let&#x27;s try to convert character to index:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">tokenizer<span class="token punctuation">.</span>word_index<span class="token punctuation">[</span><span class="token string">'r'</span><span class="token punctuation">]</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">8</code></pre></div></span>
</blockquote>
<p>To illustrate what kind of characters form all the recipes in our dataset we may print all of them as an array:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">array_vocabulary <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>word_index<span class="token punctuation">]</span> <span class="token keyword">for</span> word_index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>VOCABULARY_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>char <span class="token keyword">for</span> char <span class="token keyword">in</span> array_vocabulary<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">['', ' ', 'e', 'a', 't', 'o', 'n', 'i', 'r', 's', 'l', 'd', 'h', 'c', 'u', 'p', '\n', 'm', 'g', 'b', ',', '.', 'f', 'w', '', 'k', '1', 'v', 'y', '2', '/', '', '', 'S', '4', 'C', '-', '3', 'x', 'P', '5', '0', '(', ')', 'A', 'B', 'z', 'j', 'F', 'T', 'R', '', '', '', 'I', 'M', ';', 'q', 'D', 'W', '8', 'G', '6', 'L', 'H', ':', '7', 'O', "'", 'E', 'K', '9', 'U', 'N', 'V', 'J', '', '', '', '"', 'Y', 'Q', '*', '!', 'Z', '', '&amp;', '%', '', '', '', '', 'X', '?', '', '', '', '#', '', '', '=', '', '', '', '', '+', '>', '$', '&lt;', '', '', '', '', '', '', ']', '[', '', '', '', '_', '\xad', '', '', '', '', '', '', '', '', '', '}', '', '{', '', '', '\x96', '', '', '', '', '@', '', '\\', '', '', '', '', '\u202d', '', '', '', '`', '', '', '\x97', '\x1a', '', '', '|', '', '\x92', '', '', '', '', '', '', '\xa0', '', '', '', '', '', '~', '\x95']</code></pre></div></span>
</blockquote>
<p>These are all the characters our RNN model will work with. It will try to learn how to assemble these characters into sequences that will look like recipes.</p>
<p>Let&#x27;s see how we may use <span><code class="language-text">tokenizer</code></span> functions to convert text to indices:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">tokenizer<span class="token punctuation">.</span>texts_to_sequences<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">' yes'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">[[51, 1, 28, 2, 9]]</code></pre></div></span>
</blockquote>
<h2 id="vectorizing-the-dataset" style="position:relative">Vectorizing the dataset<a href="#vectorizing-the-dataset" aria-label="vectorizing the dataset permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>Now, once we have a vocabulary (<span><code class="language-text">character --> code</code></span> and <span><code class="language-text">code --> character</code></span> relations) we may convert the set of recipes from text to numbers (RNN works with numbers as an input and not with the texts).</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">dataset_vectorized <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>texts_to_sequences<span class="token punctuation">(</span>dataset_filtered<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Vectorized dataset size'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataset_vectorized<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Vectorized dataset size 100212</code></pre></div></span>
</blockquote>
<p>This is how the beginning of the first vectorized recipe looks like:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>dataset_vectorized<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'...'</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">[51, 1, 33, 10, 5, 23, 1, 35, 5, 5] ...</code></pre></div></span>
</blockquote>
<p>Let&#x27;s see how can we convert vectorized recipe back to text representation:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">recipe_sequence_to_string</span><span class="token punctuation">(</span>recipe_sequence<span class="token punctuation">)</span><span class="token punctuation">:</span>
    recipe_stringified <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span><span class="token punctuation">[</span>recipe_sequence<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>recipe_stringified<span class="token punctuation">)</span>

recipe_sequence_to_string<span class="token punctuation">(</span>dataset_vectorized<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"> Slow Cooker Chicken and Dumplings



 4 skinless, boneless chicken breast halves
 2 tablespoons butter
 2 (10.75 ounce) cans condensed cream of chicken soup
 1 onion, finely diced
 2 (10 ounce) packages refrigerated biscuit dough, torn into pieces



 Place the chicken, butter, soup, and onion in a slow cooker, and fill with enough water to cover.
 Cover, and cook for 5 to 6 hours on High. About 30 minutes before serving, place the torn biscuit dough in the slow cooker. Cook until the dough is no longer raw in the center.</code></pre></div></span>
</blockquote>
<h3 id="add-padding-to-sequences" style="position:relative">Add padding to sequences<a href="#add-padding-to-sequences" aria-label="add padding to sequences permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>We need all recipes to have the same length for training. To do that we&#x27;ll use <a href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/sequence/pad_sequences">tf.keras.preprocessing.sequence.pad_sequences</a> utility to add a stop word to the end of each recipe and to make them have the same length.</p>
<p>Let&#x27;s check the recipes lengths:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> recipe_index<span class="token punctuation">,</span> recipe <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>dataset_vectorized<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recipe #{} length: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>recipe_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>recipe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Recipe #1 length: 546
Recipe #2 length: 401
Recipe #3 length: 671
Recipe #4 length: 736
Recipe #5 length: 1518
Recipe #6 length: 740
Recipe #7 length: 839
Recipe #8 length: 667
Recipe #9 length: 1264
Recipe #10 length: 854</code></pre></div></span>
</blockquote>
<p>Let&#x27;s pad all recipes with a <span><code class="language-text">STOP_SIGN</code></span>:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">dataset_vectorized_padded_without_stops <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>preprocessing<span class="token punctuation">.</span>sequence<span class="token punctuation">.</span>pad_sequences<span class="token punctuation">(</span>
    dataset_vectorized<span class="token punctuation">,</span>
    padding<span class="token operator">=</span><span class="token string">'post'</span><span class="token punctuation">,</span>
    truncating<span class="token operator">=</span><span class="token string">'post'</span><span class="token punctuation">,</span>
    <span class="token comment"># We use -1 here and +1 in the next step to make sure</span>
    <span class="token comment"># that all recipes will have at least 1 stops sign at the end,</span>
    <span class="token comment"># since each sequence will be shifted and truncated afterwards</span>
    <span class="token comment"># (to generate X and Y sequences).</span>
    maxlen<span class="token operator">=</span>MAX_RECIPE_LENGTH<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    value<span class="token operator">=</span>tokenizer<span class="token punctuation">.</span>texts_to_sequences<span class="token punctuation">(</span><span class="token punctuation">[</span>STOP_SIGN<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>

dataset_vectorized_padded <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>preprocessing<span class="token punctuation">.</span>sequence<span class="token punctuation">.</span>pad_sequences<span class="token punctuation">(</span>
    dataset_vectorized_padded_without_stops<span class="token punctuation">,</span>
    padding<span class="token operator">=</span><span class="token string">'post'</span><span class="token punctuation">,</span>
    truncating<span class="token operator">=</span><span class="token string">'post'</span><span class="token punctuation">,</span>
    maxlen<span class="token operator">=</span>MAX_RECIPE_LENGTH<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
    value<span class="token operator">=</span>tokenizer<span class="token punctuation">.</span>texts_to_sequences<span class="token punctuation">(</span><span class="token punctuation">[</span>STOP_SIGN<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token keyword">for</span> recipe_index<span class="token punctuation">,</span> recipe <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>dataset_vectorized_padded<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Recipe #{} length: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>recipe_index<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>recipe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Recipe #0 length: 2001
Recipe #1 length: 2001
Recipe #2 length: 2001
Recipe #3 length: 2001
Recipe #4 length: 2001
Recipe #5 length: 2001
Recipe #6 length: 2001
Recipe #7 length: 2001
Recipe #8 length: 2001
Recipe #9 length: 2001</code></pre></div></span>
</blockquote>
<p>After the padding all recipes in the dataset now have the same length and RNN will also be able to learn where each recipe stops (by observing the presence of a <span><code class="language-text">STOP_SIGN</code></span>).</p>
<p>Here is an example of how a first recipe looks like after the padding.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">recipe_sequence_to_string<span class="token punctuation">(</span>dataset_vectorized_padded<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"> Slow Cooker Chicken and Dumplings



 4 skinless, boneless chicken breast halves
 2 tablespoons butter
 2 (10.75 ounce) cans condensed cream of chicken soup
 1 onion, finely diced
 2 (10 ounce) packages refrigerated biscuit dough, torn into pieces



 Place the chicken, butter, soup, and onion in a slow cooker, and fill with enough water to cover.
 Cover, and cook for 5 to 6 hours on High. About 30 minutes before serving, place the torn biscuit dough in the slow cooker. Cook until the dough is no longer raw in the center.
</code></pre></div></span>
</blockquote>
<p>All recipes now end with one or many <span><code class="language-text"></code></span> signs. We expect our LSTM model to learn that whenever it sees the <span><code class="language-text"></code></span> stop-character it means that the recipe is ended. Once the network will learn this concept it will put stop-character at the end of every newly generated recipe.</p>
<h3 id="create-tensorflow-dataset" style="position:relative">Create TensorFlow dataset<a href="#create-tensorflow-dataset" aria-label="create tensorflow dataset permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>Up until now we were working with the dataset as with the NumPy array. It will be more convenient during the training process if we will convert a dataset NumPy array to a <a href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset">TensorFlow dataset</a>. It will give us an ability to use such helpers functions as <span><code class="language-text">batch()</code></span>, <span><code class="language-text">shuffle()</code></span>, <span><code class="language-text">repeat()</code></span>, <span><code class="language-text">prefecth()</code></span> etc.:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">dataset <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span>dataset_vectorized_padded<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&lt;TensorSliceDataset shapes: (2001,), types: tf.int32></code></pre></div></span>
</blockquote>
<p>Let&#x27;s see what the first recipe in the dataset looks like by using a TensorFlow dataset API this time:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> recipe <span class="token keyword">in</span> dataset<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Raw recipe:\n'</span><span class="token punctuation">,</span> recipe<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'\n\n\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Stringified recipe:\n'</span><span class="token punctuation">)</span>
    recipe_sequence_to_string<span class="token punctuation">(</span>recipe<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Raw recipe:
 [ 51   1  33 ... 165 165 165]

Stringified recipe:

 Slow Cooker Chicken and Dumplings



 4 skinless, boneless chicken breast halves
 2 tablespoons butter
 2 (10.75 ounce) cans condensed cream of chicken soup
 1 onion, finely diced
 2 (10 ounce) packages refrigerated biscuit dough, torn into pieces



 Place the chicken, butter, soup, and onion in a slow cooker, and fill with enough water to cover.
 Cover, and cook for 5 to 6 hours on High. About 30 minutes before serving, place the torn biscuit dough in the slow cooker. Cook until the dough is no longer raw in the center.
</code></pre></div></span>
</blockquote>
<h3 id="split-examples-on-input-and-target-texts" style="position:relative">Split examples on <span><code class="language-text">input</code></span> and <span><code class="language-text">target</code></span> texts<a href="#split-examples-on-input-and-target-texts" aria-label="split examples on input and target texts permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>For each sequence we need to duplicate and shift it to form the <span><code class="language-text">input</code></span> and <span><code class="language-text">target</code></span> texts. For example, say the <span><code class="language-text">sequence_length</code></span> is <span><code class="language-text">4</code></span> and our text is <span><code class="language-text">Hello</code></span>. The input sequence would be <span><code class="language-text">Hell</code></span>, and the target sequence <span><code class="language-text">ello</code></span>.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">split_input_target</span><span class="token punctuation">(</span>recipe<span class="token punctuation">)</span><span class="token punctuation">:</span>
    input_text <span class="token operator">=</span> recipe<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    target_text <span class="token operator">=</span> recipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> input_text<span class="token punctuation">,</span> target_text

dataset_targeted <span class="token operator">=</span> dataset<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>split_input_target<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>dataset_targeted<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&lt;MapDataset shapes: ((2000,), (2000,)), types: (tf.int32, tf.int32)></code></pre></div></span>
</blockquote>
<p>You may notice from the line above, that now each example in the dataset consists of two tuples: input and target. Let&#x27;s print an example:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> input_example<span class="token punctuation">,</span> target_example <span class="token keyword">in</span> dataset_targeted<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Input sequence size:'</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>input_example<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Target sequence size:'</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>target_example<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    input_stringified <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span><span class="token punctuation">[</span>input_example<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    target_stringified <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span><span class="token punctuation">[</span>target_example<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Input:  '</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>input_stringified<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Target: '</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>target_stringified<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Input sequence size: 2000
Target sequence size: 2000

Input:   '   S l o w   C o o k e r   C h i c k e n   a n d   D u m p l i n g s \n \n  \n \n    4   s k i n l e'
Target:  '  S l o w   C o o k e r   C h i c k e n   a n d   D u m p l i n g s \n \n  \n \n    4   s k i n l e s'</code></pre></div></span>
</blockquote>
<p>Each index of these vectors is processed as one time step by RNN. For the input at time step <span><code class="language-text">0</code></span>, the model receives the index for <span><code class="language-text"></code></span> and tries to predict the index for <span><code class="language-text"> </code></span> (a space character) as the next character. At the next time-step, it does the same thing, but the RNN considers the previous step context in addition to the current input character.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>input_idx<span class="token punctuation">,</span> target_idx<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>input_example<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> target_example<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Step {:2d}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  input: {} ({:s})'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>input_idx<span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>input_idx<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  expected output: {} ({:s})'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>target_idx<span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>target_idx<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Step  1
  input: 51 ('')
  expected output: 1 (' ')
Step  2
  input: 1 (' ')
  expected output: 33 ('S')
Step  3
  input: 33 ('S')
  expected output: 10 ('l')
Step  4
  input: 10 ('l')
  expected output: 5 ('o')
Step  5
  input: 5 ('o')
  expected output: 23 ('w')
Step  6
  input: 23 ('w')
  expected output: 1 (' ')
Step  7
  input: 1 (' ')
  expected output: 35 ('C')
Step  8
  input: 35 ('C')
  expected output: 5 ('o')
Step  9
  input: 5 ('o')
  expected output: 5 ('o')
Step 10
  input: 5 ('o')
  expected output: 25 ('k')</code></pre></div></span>
</blockquote>
<h3 id="split-up-the-dataset-into-batches" style="position:relative">Split up the dataset into batches<a href="#split-up-the-dataset-into-batches" aria-label="split up the dataset into batches permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>We have <span><code class="language-text">~100k</code></span> recipes in the dataset, and each recipe has two tuples of <span><code class="language-text">2000</code></span> characters.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>dataset_targeted<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&lt;MapDataset shapes: ((2000,), (2000,)), types: (tf.int32, tf.int32)></code></pre></div></span>
</blockquote>
<p>Let&#x27;s print constants values:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'TOTAL_RECIPES_NUM: '</span><span class="token punctuation">,</span> TOTAL_RECIPES_NUM<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'MAX_RECIPE_LENGTH: '</span><span class="token punctuation">,</span> MAX_RECIPE_LENGTH<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'VOCABULARY_SIZE: '</span><span class="token punctuation">,</span> VOCABULARY_SIZE<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">TOTAL_RECIPES_NUM:  100212
MAX_RECIPE_LENGTH:  2000
VOCABULARY_SIZE:  176</code></pre></div></span>
</blockquote>
<p>If we will feed the complete dataset during the training process to the model and then will try to do a back-propagation for all examples at once we might run out of memory and each training epoch may take too long to execute. To avoid the situation like this we need to split our dataset into batches.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Batch size.</span>
BATCH_SIZE <span class="token operator">=</span> <span class="token number">64</span>

<span class="token comment"># Buffer size to shuffle the dataset (TF data is designed to work</span>
<span class="token comment"># with possibly infinite sequences, so it doesn't attempt to shuffle</span>
<span class="token comment"># the entire sequence in memory. Instead, it maintains a buffer in</span>
<span class="token comment"># which it shuffles elements).</span>
SHUFFLE_BUFFER_SIZE <span class="token operator">=</span> <span class="token number">1000</span>

dataset_train <span class="token operator">=</span> dataset_targeted \
  <span class="token comment"># Shuffling examples first.</span>
  <span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>SHUFFLE_BUFFER_SIZE<span class="token punctuation">)</span> \
  <span class="token comment"># Splitting examples on batches.</span>
  <span class="token punctuation">.</span>batch<span class="token punctuation">(</span>BATCH_SIZE<span class="token punctuation">,</span> drop_remainder<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> \
  <span class="token comment"># Making a dataset to be repeatable (it will never ends).</span>
  <span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>dataset_train<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&lt;RepeatDataset shapes: ((64, 2000), (64, 2000)), types: (tf.int32, tf.int32)></code></pre></div></span>
</blockquote>
<p>From the line above you may notice that our dataset now consists of the same two tuples of <span><code class="language-text">2000</code></span> characters but now they are grouped in the batches by <span><code class="language-text">64</code></span>.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> input_text<span class="token punctuation">,</span> target_text <span class="token keyword">in</span> dataset_train<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1st batch: input_text:'</span><span class="token punctuation">,</span> input_text<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1st batch: target_text:'</span><span class="token punctuation">,</span> target_text<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">1st batch: input_text: tf.Tensor(
[[ 51   1  54 ... 165 165 165]
 [ 51   1  64 ... 165 165 165]
 [ 51   1  44 ... 165 165 165]
 ...
 [ 51   1  69 ... 165 165 165]
 [ 51   1  55 ... 165 165 165]
 [ 51   1  70 ... 165 165 165]], shape=(64, 2000), dtype=int32)

1st batch: target_text: tf.Tensor(
[[  1  54   4 ... 165 165 165]
 [  1  64   5 ... 165 165 165]
 [  1  44   6 ... 165 165 165]
 ...
 [  1  69   3 ... 165 165 165]
 [  1  55   3 ... 165 165 165]
 [  1  70   2 ... 165 165 165]], shape=(64, 2000), dtype=int32)</code></pre></div></span>
</blockquote>
<h2 id="build-the-model" style="position:relative">Build the model<a href="#build-the-model" aria-label="build the model permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>We will use <a href="https://www.tensorflow.org/api_docs/python/tf/keras/Sequential">tf.keras.Sequential</a> to define the model. For this experiment we will use the following layer types:</p>
<ul>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/Embedding">tf.keras.layers.Embedding</a> - the input layer (a trainable lookup table that will map the numbers of each character to a vector with <span><code class="language-text">embedding_dim</code></span> dimensions),</li>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/LSTM">tf.keras.layers.LSTM</a> - a type of RNN with size <span><code class="language-text">units=rnn_units</code></span> (you can also use a <a href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/GRU">GRU</a> layer here),</li>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/Dense">tf.keras.layers.Dense</a> - the output layer, with <span><code class="language-text">VOCABULARY_SIZE</code></span> outputs.</li>
</ul>
<h3 id="figuring-out-how-the-embedding-layer-works" style="position:relative">Figuring out how the Embedding Layer works<a href="#figuring-out-how-the-embedding-layer-works" aria-label="figuring out how the embedding layer works permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>Let&#x27;s do a quick detour and see how Embedding Layer works. It takes several char indices sequences (batch) as an input. It encodes every character of every sequence to a vector of <span><code class="language-text">tmp_embedding_size</code></span> length.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">tmp_vocab_size <span class="token operator">=</span> <span class="token number">10</span>
tmp_embedding_size <span class="token operator">=</span> <span class="token number">5</span>
tmp_input_length <span class="token operator">=</span> <span class="token number">8</span>
tmp_batch_size <span class="token operator">=</span> <span class="token number">2</span>

tmp_model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>
tmp_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>
  input_dim<span class="token operator">=</span>tmp_vocab_size<span class="token punctuation">,</span>
  output_dim<span class="token operator">=</span>tmp_embedding_size<span class="token punctuation">,</span>
  input_length<span class="token operator">=</span>tmp_input_length
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># The model will take as input an integer matrix of size (batch, input_length).</span>
<span class="token comment"># The largest integer (i.e. word index) in the input should be no larger than 9 (tmp_vocab_size).</span>
<span class="token comment"># Now model.output_shape == (None, 10, 64), where None is the batch dimension.</span>
tmp_input_array <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>
  low<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
  high<span class="token operator">=</span>tmp_vocab_size<span class="token punctuation">,</span>
  size<span class="token operator">=</span><span class="token punctuation">(</span>tmp_batch_size<span class="token punctuation">,</span> tmp_input_length<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
tmp_model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'rmsprop'</span><span class="token punctuation">,</span> <span class="token string">'mse'</span><span class="token punctuation">)</span>
tmp_output_array <span class="token operator">=</span> tmp_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>tmp_input_array<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'tmp_input_array shape:'</span><span class="token punctuation">,</span> tmp_input_array<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'tmp_input_array:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tmp_input_array<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'tmp_output_array shape:'</span><span class="token punctuation">,</span> tmp_output_array<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'tmp_output_array:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tmp_output_array<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">tmp_input_array shape: (2, 8)
tmp_input_array:
[[2 4 7 5 1 6 9 7]
 [3 6 8 1 4 0 1 2]]

tmp_output_array shape: (2, 8, 5)
tmp_output_array:
[[[-0.02229502 -0.02800617 -0.0120693  -0.01681594 -0.00650246]
  [-0.03046973 -0.03920818  0.04956308  0.04417323 -0.00446874]
  [-0.0215276   0.01532575 -0.02229529  0.02834387  0.02725342]
  [ 0.04567988  0.0141306   0.00877035 -0.02601192  0.00380837]
  [ 0.02969306  0.02994296 -0.00233263  0.00716375 -0.00847433]
  [ 0.04598364 -0.00704358 -0.01386416  0.01195388 -0.00309662]
  [-0.00137572  0.01275543 -0.02348721 -0.04825885  0.00527108]
  [-0.0215276   0.01532575 -0.02229529  0.02834387  0.02725342]]

 [[ 0.01082945  0.03824175 -0.00450991 -0.02865709  0.02502238]
  [ 0.04598364 -0.00704358 -0.01386416  0.01195388 -0.00309662]
  [ 0.02275398  0.03806095 -0.03491788  0.04705564  0.00167596]
  [ 0.02969306  0.02994296 -0.00233263  0.00716375 -0.00847433]
  [-0.03046973 -0.03920818  0.04956308  0.04417323 -0.00446874]
  [-0.02909902  0.04426369  0.00150937  0.04579213  0.02559013]
  [ 0.02969306  0.02994296 -0.00233263  0.00716375 -0.00847433]
  [-0.02229502 -0.02800617 -0.0120693  -0.01681594 -0.00650246]]]</code></pre></div></span>
</blockquote>
<h3 id="lstm-model" style="position:relative">LSTM Model<a href="#lstm-model" aria-label="lstm model permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>Let&#x27;s assemble the model.</p>
<p> You may check <a href="https://www.tensorflow.org/tutorials/text/text_generation">Text generation with an RNN</a> notebook from TensorFlow documentation for more details on model components.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">build_model</span><span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">,</span> rnn_units<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>
        input_dim<span class="token operator">=</span>vocab_size<span class="token punctuation">,</span>
        output_dim<span class="token operator">=</span>embedding_dim<span class="token punctuation">,</span>
        batch_input_shape<span class="token operator">=</span><span class="token punctuation">[</span>batch_size<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>
        units<span class="token operator">=</span>rnn_units<span class="token punctuation">,</span>
        return_sequences<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        stateful<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        recurrent_initializer<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>initializers<span class="token punctuation">.</span>GlorotNormal<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span>vocab_size<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> model

model <span class="token operator">=</span> build_model<span class="token punctuation">(</span>
  vocab_size<span class="token operator">=</span>VOCABULARY_SIZE<span class="token punctuation">,</span>
  embedding_dim<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
  rnn_units<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>
  batch_size<span class="token operator">=</span>BATCH_SIZE
<span class="token punctuation">)</span>

model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Model: "sequential_13"
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
embedding_13 (Embedding)     (64, None, 256)           45056
_________________________________________________________________
lstm_9 (LSTM)                (64, None, 1024)          5246976
_________________________________________________________________
dense_8 (Dense)              (64, None, 176)           180400
=================================================================
Total params: 5,472,432
Trainable params: 5,472,432
Non-trainable params: 0
_________________________________________________________________</code></pre></div></span>
</blockquote>
<p>Let&#x27;s visualize the model:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>plot_model<span class="token punctuation">(</span>
    model<span class="token punctuation">,</span>
    show_shapes<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    show_layer_names<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    to_file<span class="token operator">=</span><span class="token string">'model.png'</span>
<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 439px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKklEQVR42m2UCa+qQAyF+f9/y0SNS9yBqIj7FdxY3FH78jVvCPfqJM1sndP2nIIVBEGWpmkWx3GWJIlaFEUfa3O/Xq8zz/My27azMAwz13Uzx3Ey3/fVrJ+fH/E8TxzHkX6/L5vNRvb7vfi+r+fz+Vxs287XQRDovlaryXa7lcFgIO12W6bTqQyHQ7HW67VeAMSaAAAyc8bdYrGQ1WqlYMvlUnq9nlSrVT0nEQBJYDwei3W/3+XxeEiWZbmxN/Z8PiVJEjmfz3p3uVyEN9jtdlPDz5xZ7/f7FxgGCIYjg+iz2UzX+L9er9yvuGe2jsejRFEkaZrmcxzHcjgcdGZv6KDEbrerfEFFGIbKITSAgyngZDJRR8x1XeUQESDfkM4jsiyXy0o+AXjHmgow3ikg2ZAdGRGVvckUw5EseYy6CAE4gThn32q19J0FD9fr9YPg4p6gABuhindmNgJa8n9ArhEDco0x6D/ahgH5RggzGz+GqszY7XZ56ZRoSKckGr7RaGhvUmqn01GB6Edo4J3ByTOkJATBEVAjCJlxDiB3o9EoP4c3/AieZ2gWgNDA2Ol0UqOJcUb9er2u2ZERXwTZkjmAcPwBWBSnOH8T5ZsYXwH/fimsGTQyfWhEQYSigF8BKQ1yKZmMEIY155RVKpXykpvNpgagD+lLE+wXIIoWf1PMiMEXAUilUtEzHhuV8Udp/kJfMyQrjEyNQT7AiAIwe74MAAnMGS1nAP8B5+BJ/rz2DBMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Model architecture"
        title=""
        src="/static/69dd454b38a2cb834ff2399587d6cd92/e3b18/4.png"
        srcset="/static/69dd454b38a2cb834ff2399587d6cd92/63868/4.png 250w,
/static/69dd454b38a2cb834ff2399587d6cd92/e3b18/4.png 439w"
        sizes="(max-width: 439px) 100vw, 439px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<p>For each character the model looks up the embedding, runs the LSTM one time-step with the embedding as input, and applies the dense layer to generate logits predicting the log-likelihood of the next character:</p>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 842px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 86.80000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEM0lEQVR42nVUa0yTZxQ+tEKlg5GhbDBrshggs5Ets7BbjHViTN1cEKUQlWlkrFzKgMJqkUs+hI1aoKW1lVp7oRR7+3qBll6ovYi0g1lQBwZNLCz7Z7L9WbZsZvPHt3ylMDTsSc6P95z3XJ7znvMChmFJAABLc0blvYj+l0dRy5LDKP7y8YL1/kL45tOlu6gKt+fm5pIeRVH3/J2xpys/Tjw4ceLIXgDIIpPJOQCASzYAxGPF4XcqiuTirgarXnxKPYzscVlFX4zd6OaG/eoDAEAAgOSgT3tQJmxvsBuHTnI4zNSEKyEh/wXDsTLbq75taVpdCnT8sOC91L7k71gOok2/xiKXLbgdQY6TY9/3eKYM7CdPwt3zk/rGvDU9QoCtsBK4eGxMWNHtG/2qftHNLvCpz5Xxvzn6dSzY8jEAbGPk5pJiwTamqq8MiZjrav0KVkbC9cXKMAwhnEfOb58Iu68OaWQ+w5TVZr5l6TP4LCbZmGLKEfFeAwAiIpOlWaedRqFS6rEGJyY6BpBDAJBBpVKz09LSsgAgbSMojUZL9s6M8yUjAwazR6cc95m7UbdOKxsdtE/NOMQAQOLxeBmukE0u0QhG7X6TTqmX0DZRxvtJigeTqEUsrU3Jqb1Uu6/f0qUS6NtZuL5b1XJWYOqUtQzW7QYmEHFdm6SRNoh2mft0bQygQorSOFx306njiJXiN9bYYknQL/vOIdUMRVoENaeVHtFv0nG+Ge+Z2PatQeWVPOdeZxWvZ+/VXbwwckuKDaG9nXAEMoQ3BLMiRX+s7XLrB/gdCoWSuqmXWFJOTs7btPz8nfiZXlSUXVj4znsIgmzbuIQAIT0lPT8zM/PVhCY5kSwdADLj1DHsdtwhhDoNAZPjn/D41M9asbwhYvf+5Dc6/p62uEy4ncFgkGbs3lDA5Ph93h2KlZeW7geAnZQ8yq7U1NRdAIDTzthIjiq17/Mam5tEPVfK1aLhPZKeK+VcdnOTRaHD6RCpVGqKUaE6yq1v4l7jCyuR+vr1VyVuGm7CBl0Bq31/c0V1SW9162Epu6ego7LhMK+ipkTEbi/EZ43JZBJ5lTXvso5XFHNKqz8UVHHTt5xDHEwqNWVB4358b9SDRTWu53fklrn7Ou+zea0bu6txreK9UiLCzAc6358LWg+2bAxhjv4RRpwZihK3WhTCeKe0oLa45NTAWfYhY+fQXuEFDp31yecn3Z3CAjwgnU7fbuLxD56jf1opqmr9TN/Gf+1/K8Rx3Tn9kUTvYMknAmU9ck2ewuk/I7W42QpniL72wghh2Bk4dtXkrJc7gqcPMBjr20F+afXWvi+bf043GV585o48XJWp0brJmcUVV+ThXzZ/1IBXQaPRyPZgNDQZXvzDO7u8WllVuw8AXtk0Qi8AD0pJ/GmvA8COxAjsBoA3E6uF67IS8tbGqr2EfwHChb8B9l7cXAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Model architecture"
        title=""
        src="/static/c47fb3afb041ecd74a969c20df71db1c/99072/5.png"
        srcset="/static/c47fb3afb041ecd74a969c20df71db1c/63868/5.png 250w,
/static/c47fb3afb041ecd74a969c20df71db1c/0b533/5.png 500w,
/static/c47fb3afb041ecd74a969c20df71db1c/99072/5.png 842w"
        sizes="(max-width: 842px) 100vw, 842px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<blockquote>
<p>Image source: <a href="https://www.tensorflow.org/tutorials/text/text_generation">Text generation with an RNN</a> notebook.</p>
</blockquote>
<p>The picture above illustrates GRU network, but you may easily replace GRU with LSTM.</p>
<h2 id="trying-the-model-before-training" style="position:relative">Trying the model before training<a href="#trying-the-model-before-training" aria-label="trying the model before training permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>Let&#x27;s play around with un-trained model to see its interface (what input do we need and what output will we have) and let&#x27;s see what model predicts before the training:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> input_example_batch<span class="token punctuation">,</span> target_example_batch <span class="token keyword">in</span> dataset_train<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    example_batch_predictions <span class="token operator">=</span> model<span class="token punctuation">(</span>input_example_batch<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>example_batch_predictions<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token string">"# (batch_size, sequence_length, vocab_size)"</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">(64, 2000, 176) # (batch_size, sequence_length, vocab_size)</code></pre></div></span>
</blockquote>
<p>To get actual predictions from the model we need to sample from the output distribution, to get actual character indices. This distribution is defined by the logits over the character vocabulary.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Prediction for the 1st letter of the batch 1st sequense:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>example_batch_predictions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Prediction for the 1st letter of the batch 1st sequense:
tf.Tensor(
[-9.0643829e-03 -1.9503604e-03  9.3381782e-04  3.7442446e-03
 -2.0541784e-03 -7.4054599e-03 -7.1884273e-03  2.6014952e-03
  4.8721582e-03  3.0045470e-04  2.6016519e-04 -4.1374690e-03
  5.3856964e-03  2.6284808e-03 -5.6002503e-03  2.6019611e-03
 -1.9491187e-03 -3.1097094e-04  6.3465843e-03  1.4640498e-03
  2.4560774e-03 -3.1256995e-03  1.4104056e-03  2.5478401e-04
  5.4266443e-03 -4.1188141e-03  3.6904984e-03 -5.8337618e-03
  3.6372752e-03 -3.1899021e-05  3.2178329e-03  1.5033322e-04
  5.2770867e-04 -8.1920059e-04 -2.2364906e-03 -2.3271297e-03
  4.4109682e-03  4.2381673e-04  1.0532180e-03 -1.4208974e-03
 -3.2446394e-03 -4.5869066e-03  4.3250201e-04 -4.3490473e-03
  3.7889536e-03 -9.2122913e-04  7.8936084e-04 -9.7079907e-04
  1.7070504e-03 -2.5260956e-03  6.7904620e-03  1.5470090e-03
 -9.4337866e-04 -1.5072266e-03  6.8939931e-04 -1.0795534e-03
 -3.1912089e-03  2.3665284e-03  1.7737487e-03 -2.3504677e-03
 -6.8649277e-04  9.6421910e-04 -4.1204207e-03 -3.8750230e-03
  1.9077851e-03  4.7145790e-05 -2.9846188e-03  5.8050319e-03
 -5.6210475e-04 -2.5910907e-04  5.2890396e-03 -5.8653783e-03
 -6.0040038e-06  2.3905798e-03 -2.9405006e-03  2.0132761e-03
 -3.5594390e-03  4.0282350e-04  4.7719614e-03 -2.4438011e-03
 -1.1028582e-03  2.0007135e-03 -1.6961874e-03 -4.2196750e-03
 -3.5689408e-03 -4.1934610e-03 -8.5307617e-04  1.5773368e-04
 -1.4612130e-03  9.5826073e-04  4.0543079e-04 -2.3562380e-04
 -1.5394683e-03  3.6650903e-03  3.5997448e-03  2.2390878e-03
 -6.8982318e-04  1.4068574e-03 -2.0531749e-03 -1.5443334e-03
 -1.8235333e-03 -3.2099178e-03  1.6660831e-03  1.2230751e-03
  3.8084832e-03  6.9559496e-03  5.7684043e-03  3.1751506e-03
  7.4234616e-04  1.1971325e-04 -2.7798198e-03  2.1485630e-03
  4.0362971e-03  6.4410735e-05  1.7432809e-03  3.2334479e-03
 -6.1469898e-03 -2.2205685e-03 -1.0864032e-03 -2.0876178e-07
  2.3065242e-03 -1.5816523e-03 -2.1492387e-03 -4.4033155e-03
  1.1003019e-03 -9.7132073e-04 -6.3941808e-04  3.0277157e-03
  2.9096641e-03 -2.4778468e-03 -2.9532036e-03  7.7463314e-04
  2.7473709e-03 -7.6333171e-04 -8.1811845e-03 -1.3959130e-03
  3.2840301e-03  6.0461317e-03 -1.3022404e-04 -9.4000692e-04
 -2.0096730e-04  3.3895797e-03  2.9710699e-03  1.9046264e-03
  2.5092331e-03 -2.0799250e-04 -2.2211851e-04 -3.4621451e-05
  1.9962704e-03 -2.3159904e-03  2.9832027e-03  3.3852295e-03
  3.4411502e-04 -1.9019389e-03 -3.6734296e-04 -1.4232489e-03
  2.6938838e-03 -2.8015859e-03 -5.7366290e-03  8.0239226e-04
 -6.2909431e-04  1.1508183e-03 -1.5899434e-04 -5.9326587e-04
 -4.1618512e-04  5.2454891e-03  1.2823739e-03 -1.7550631e-03
 -3.0120560e-03 -3.8433261e-03 -9.6873334e-04  1.9963509e-03
  1.8154597e-03  4.7434499e-03  1.7146189e-03  1.1544267e-03], shape=(176,), dtype=float32)</code></pre></div></span>
</blockquote>
<p>For each input character the <span><code class="language-text">example_batch_predictions</code></span> array contains a vector of probabilities of what the next character might be. If probability at position <span><code class="language-text">15</code></span> in that vector is, lets say, <span><code class="language-text">0.3</code></span> and the probability at position <span><code class="language-text">25</code></span> is <span><code class="language-text">1.1</code></span> it means that we should better pick the character with the index <span><code class="language-text">25</code></span> as next following character.</p>
<p>Since we want our network to generate different recipes (even for the same input), we can&#x27;t just pick the maximum probability value. In this case we will end up with the same recipe being predicted by the network over and over again. What we will do instead is drawing <strong>samples</strong> from predictions (like the one printed above) by using <a href="https://www.tensorflow.org/api_docs/python/tf/random/categorical">tf.random.categorical()</a> function. It will bring some fuzziness to the network. For example, let&#x27;s say we have character <span><code class="language-text">H</code></span> as an input, then, by sampling from categorical distribution, our network may predict not only the word <span><code class="language-text">He</code></span>, but also words <span><code class="language-text">Hello</code></span>, and <span><code class="language-text">Hi</code></span> etc.</p>
<h3 id="understanding-how-tfrandomcategorical-works" style="position:relative">Understanding how <span><code class="language-text">tf.random.categorical</code></span> works<a href="#understanding-how-tfrandomcategorical-works" aria-label="understanding how tfrandomcategorical works permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># logits is 2-D Tensor with shape [batch_size, num_classes].</span>
<span class="token comment"># Each slice [i, :] represents the unnormalized log-probabilities for all classes.</span>
<span class="token comment"># In the example below we say that the probability for class "0"</span>
<span class="token comment"># (element with index 0) is low but the probability for class "2" is much higher.</span>
tmp_logits <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.95</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment"># Let's generate 5 samples. Each sample is a class index. Class probabilities</span>
<span class="token comment"># are being taken into account (we expect to see more samples of class "2").</span>
tmp_samples <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>categorical<span class="token punctuation">(</span>
    logits<span class="token operator">=</span>tmp_logits<span class="token punctuation">,</span>
    num_samples<span class="token operator">=</span><span class="token number">5</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>tmp_samples<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">tf.Tensor([[2 1 2 2 1]], shape=(1, 5), dtype=int64)</code></pre></div></span>
</blockquote>
<h3 id="sampling-from-lstm-predictions" style="position:relative">Sampling from LSTM predictions<a href="#sampling-from-lstm-predictions" aria-label="sampling from lstm predictions permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">sampled_indices <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>categorical<span class="token punctuation">(</span>
    logits<span class="token operator">=</span>example_batch_predictions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    num_samples<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span>

sampled_indices <span class="token operator">=</span> tf<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>
    <span class="token builtin">input</span><span class="token operator">=</span>sampled_indices<span class="token punctuation">,</span>
    axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>

sampled_indices<span class="token punctuation">.</span>shape</code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">(2000,)</code></pre></div></span>
</blockquote>
<p>Let&#x27;s see some sampled predictions for the first <span><code class="language-text">100</code></span> chars of the recipe:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">sampled_indices<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">array([ 64,  21,  91, 126, 170,  42, 146,  54, 125, 164,  60, 171,   9,
        87, 129,  28, 146, 103,  41, 101, 147,   3, 134, 171,   8, 170,
       105,   5,  44, 173,   5, 105,  17, 138, 165,  32,  88,  96, 145,
        83,  33,  65, 172, 162,   8,  29, 147,  58,  81, 153, 150,  56,
       156,  38, 144, 134,  13,  40,  17,  50,  27,  35,  39, 112,  63,
       139, 151, 133,  68,  29,  91,   2,  70, 112, 135,  31,  26, 156,
       118,  71,  49, 104,  75,  27, 164,  41, 117, 124,  18, 137,  59,
       160, 158, 119, 173,  50,  78,  45, 121, 118])</code></pre></div></span>
</blockquote>
<p>We may see now what our untrained model actually predicts:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Input:\n'</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span><span class="token punctuation">[</span>input_example_batch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Next char prediction:\n'</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span><span class="token punctuation">[</span>sampled_indices<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Input:
 '   R e s t a u r a n t - S t y l e   C o l e s l a w   I \n \n  \n \n    1   ( 1 6   o u n c e )   p'

Next char prediction:
 'H .    (  I   8  s %  y   0   a   r  + o A  o + m       ! S :   r 2  D Q '</code></pre></div></span>
</blockquote>
<p>As you may see, the model suggests some meaningless predictions, but this is because it wasn&#x27;t trained yet.</p>
<h2 id="training-the-model" style="position:relative">Training the model<a href="#training-the-model" aria-label="training the model permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>We want to train our model to generate recipes as similar to the real ones as possible. We will use all data from dataset for training. There is not need to extract test or validation sub-sets in this case.</p>
<h3 id="attach-an-optimizer-and-a-loss-function" style="position:relative">Attach an optimizer, and a loss function<a href="#attach-an-optimizer-and-a-loss-function" aria-label="attach an optimizer and a loss function permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>We&#x27;re going to use <a href="https://www.tensorflow.org/api_docs/python/tf/keras/optimizers/Adam">tf.keras.optimizers.Adam</a> optimizer with <a href="https://www.tensorflow.org/api_docs/python/tf/keras/losses/sparse_categorical_crossentropy">tf.keras.losses.sparse_categorical_crossentropy()</a> loss function to train the model:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># An objective function.</span>
<span class="token comment"># The function is any callable with the signature scalar_loss = fn(y_true, y_pred).</span>
<span class="token keyword">def</span> <span class="token function">loss</span><span class="token punctuation">(</span>labels<span class="token punctuation">,</span> logits<span class="token punctuation">)</span><span class="token punctuation">:</span>
    entropy <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>sparse_categorical_crossentropy<span class="token punctuation">(</span>
      y_true<span class="token operator">=</span>labels<span class="token punctuation">,</span>
      y_pred<span class="token operator">=</span>logits<span class="token punctuation">,</span>
      from_logits<span class="token operator">=</span><span class="token boolean">True</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">return</span> entropy

example_batch_loss <span class="token operator">=</span> loss<span class="token punctuation">(</span>target_example_batch<span class="token punctuation">,</span> example_batch_predictions<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Prediction shape: "</span><span class="token punctuation">,</span> example_batch_predictions<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token string">" # (batch_size, sequence_length, vocab_size)"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"scalar_loss.shape:      "</span><span class="token punctuation">,</span> example_batch_loss<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"scalar_loss:      "</span><span class="token punctuation">,</span> example_batch_loss<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Prediction shape:    (64, 2000, 176)  # (batch_size, sequence_length, vocab_size)
scalar_loss.shape:   (64, 2000)
scalar_loss:         5.1618285</code></pre></div></span>
</blockquote>
<p>Let&#x27;s finally compile the model:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">adam_optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>

model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>
    optimizer<span class="token operator">=</span>adam_optimizer<span class="token punctuation">,</span>
    loss<span class="token operator">=</span>loss
<span class="token punctuation">)</span></code></pre></div></span>
<h3 id="configuring-callbacks" style="position:relative">Configuring callbacks<a href="#configuring-callbacks" aria-label="configuring callbacks permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<h4 id="early-stopping-callback" style="position:relative">Early stopping callback<a href="#early-stopping-callback" aria-label="early stopping callback permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h4>
<p>For model training process we may configure a <a href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/EarlyStopping">tf.keras.callbacks.EarlyStopping</a> callback. It will stop the training automatically in case if model is not improving for several epochs anymore:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">early_stopping_callback <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span>EarlyStopping<span class="token punctuation">(</span>
    patience<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    monitor<span class="token operator">=</span><span class="token string">'loss'</span><span class="token punctuation">,</span>
    restore_best_weights<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    verbose<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span></code></pre></div></span>
<h4 id="model-checkpoints-callback" style="position:relative">Model checkpoints callback<a href="#model-checkpoints-callback" aria-label="model checkpoints callback permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h4>
<p>Let&#x27;s also configure a <a href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/ModelCheckpoint">tf.keras.callbacks.ModelCheckpoint</a> checkpoint that will allow us to periodically save trained weights to the file so that we could restore the model from weights afterwards.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Create a checkpoints directory.</span>
checkpoint_dir <span class="token operator">=</span> <span class="token string">'tmp/checkpoints'</span>
os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>checkpoint_dir<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

checkpoint_prefix <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>checkpoint_dir<span class="token punctuation">,</span> <span class="token string">'ckpt_{epoch}'</span><span class="token punctuation">)</span>
checkpoint_callback<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span>ModelCheckpoint<span class="token punctuation">(</span>
    filepath<span class="token operator">=</span>checkpoint_prefix<span class="token punctuation">,</span>
    save_weights_only<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span></code></pre></div></span>
<h3 id="execute-the-training" style="position:relative">Execute the training<a href="#execute-the-training" aria-label="execute the training permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>Let&#x27;s train our model for <span><code class="language-text">500</code></span> epochs with <span><code class="language-text">1500</code></span> steps per each epoch. For each epoch step the batch of <span><code class="language-text">64</code></span> recipes will be fetched and gradient descent will be executed for those <span><code class="language-text">64</code></span> recipes of length <span><code class="language-text">2000</code></span> step by step.</p>
<p>If you&#x27;re experimenting with training parameters it might make sense to reduce the number of epochs to, let&#x27;s say <span><code class="language-text">20</code></span> along with the number of steps per epoch and then see how the model performs under that conditions. If the model improves its performance you may add more data (steps and epochs) to the training process. It might save you some time while you adjust parameters.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">EPOCHS <span class="token operator">=</span> <span class="token number">500</span>
INITIAL_EPOCH <span class="token operator">=</span> <span class="token number">1</span>
STEPS_PER_EPOCH <span class="token operator">=</span> <span class="token number">1500</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'EPOCHS:          '</span><span class="token punctuation">,</span> EPOCHS<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'INITIAL_EPOCH:   '</span><span class="token punctuation">,</span> INITIAL_EPOCH<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'STEPS_PER_EPOCH: '</span><span class="token punctuation">,</span> STEPS_PER_EPOCH<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">EPOCHS:           500
INITIAL_EPOCH:    1
STEPS_PER_EPOCH:  1500</code></pre></div></span>
</blockquote>
<p>Let&#x27;s launch the training:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">history <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>
    x<span class="token operator">=</span>dataset_train<span class="token punctuation">,</span>
    epochs<span class="token operator">=</span>EPOCHS<span class="token punctuation">,</span>
    steps_per_epoch<span class="token operator">=</span>STEPS_PER_EPOCH<span class="token punctuation">,</span>
    initial_epoch<span class="token operator">=</span>INITIAL_EPOCH<span class="token punctuation">,</span>
    callbacks<span class="token operator">=</span><span class="token punctuation">[</span>
        checkpoint_callback<span class="token punctuation">,</span>
        early_stopping_callback
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token comment"># Saving the trained model to file (to be able to re-use it later).</span>
model_name <span class="token operator">=</span> <span class="token string">'recipe_generation_rnn_raw.h5'</span>
model<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model_name<span class="token punctuation">,</span> save_format<span class="token operator">=</span><span class="token string">'h5'</span><span class="token punctuation">)</span></code></pre></div></span>
<h3 id="visualizing-training-progress" style="position:relative">Visualizing training progress<a href="#visualizing-training-progress" aria-label="visualizing training progress permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">render_training_history</span><span class="token punctuation">(</span>training_history<span class="token punctuation">)</span><span class="token punctuation">:</span>
    loss <span class="token operator">=</span> training_history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'loss'</span><span class="token punctuation">]</span>

    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Loss'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Epoch'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Loss'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>loss<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Training set'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

render_training_history<span class="token punctuation">(</span>history<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 392px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACXElEQVR42pVS3WoTURCe/nghooLaXgjFK8Err6xiRKUgPkOfII9g7VWfI9A3qM1VoSVYGgopIZS9aCF0t7vpGjDFpJuf/T97fkbmNFtiSxUHhpkz53zf+ebMARjbwcHB3VqtNr+/vz933ZvN5uNisfhieXn55eHh4ZO8bhjkxpxlWXPn5+fz9Xr9ASDiDBGapl3sDYKLNI6dMAxd8iiK3DwPgqDt+347DCM3iSLXG47cn72Be3Z25lqW5di27VmWVYK9vb1ZAJg9PT1dVYjIpRKIiErR6jJO5rnleZZlGMexxnieV84J4UfLXpGI6McsQykk51ySCSG0T+a0pIhSEoS2MiIcDoffrgjbrvuFij0/1bdJ+XeFxJWvOeca0+/3y1Aqle4AwLRlWV8vCRMRM05oDSBgDs4juRDiKv+DcGFh4SkATLVaLa0wE0L8GiUYJroLDfwvwkKhcJ8U2ra9Mm5LULvdUUIDogrKCbX/JBy/4Yxpmqvjt6GTSG1fBCkNCbPL8zcI6SJ5CyHkCqWkAQslhVBhmqlhlKruKFZcCJWwTEkplZRCCcEVotQuBedjws0rhflQ9FfUoHG/iCpmXHX9VPX8RA0ipiSiChKm+iFTXpgqX09Rf5vNSYV6KIwxwRijqD8tRa5jhoJnOAhi7PQD9PxIJSlD8r4f6Z67vV4Z1tbWpgHg3vr6+rPt7e1PjuMsNhqNQqVS+djpdF7t7u5+qFar7zvt9uLW1s7S8bFRMB3ndfX7zlKzefS21TLflDc2PtsnJ+8Mw3gO12wKblpeewgAj245O51nvwEOHWiR+d7RJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Model training progress (first 10 epochs)"
        title=""
        src="/static/ea6a650f1d217420032f640487956e78/0acb4/6.png"
        srcset="/static/ea6a650f1d217420032f640487956e78/63868/6.png 250w,
/static/ea6a650f1d217420032f640487956e78/0acb4/6.png 392w"
        sizes="(max-width: 392px) 100vw, 392px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<p> <em>On the chart above only first 10 epochs are presented.</em></p>
<p>We can see from the chart that model performance is getting better during the training. It means that the model learns to predict next characters in a way that the final sequence looks similar to some real recipe texts.</p>
<h2 id="generating-recipes" style="position:relative">Generating recipes<a href="#generating-recipes" aria-label="generating recipes permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<h3 id="restore-the-model-from-the-latest-checkpoint" style="position:relative">Restore the model from the latest checkpoint<a href="#restore-the-model-from-the-latest-checkpoint" aria-label="restore the model from the latest checkpoint permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>To keep this prediction step simple, we will restore the saved model and rebuild it with a batch size of 1. Because of the way the RNN state is passed from time-step to time-step, the model only accepts a fixed batch size once built. To run the model with a different <span><code class="language-text">batch_size</code></span>, we need to rebuild the model and restore the weights from the checkpoint.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>latest_checkpoint<span class="token punctuation">(</span>checkpoint_dir<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">'tmp/checkpoints/ckpt_1'</code></pre></div></span>
</blockquote>
<p>Let&#x27;s rebuild the model with batch size of <span><code class="language-text">1</code></span> and load trained weights to it:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">simplified_batch_size <span class="token operator">=</span> <span class="token number">1</span>

model_simplified <span class="token operator">=</span> build_model<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">,</span> rnn_units<span class="token punctuation">,</span> simplified_batch_size<span class="token punctuation">)</span>
model_simplified<span class="token punctuation">.</span>load_weights<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>latest_checkpoint<span class="token punctuation">(</span>checkpoint_dir<span class="token punctuation">)</span><span class="token punctuation">)</span>
model_simplified<span class="token punctuation">.</span>build<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>TensorShape<span class="token punctuation">(</span><span class="token punctuation">[</span>simplified_batch_size<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

model_simplified<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Model: "sequential_6"
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
embedding_6 (Embedding)      (1, None, 256)            45056
_________________________________________________________________
lstm_5 (LSTM)                (1, None, 1024)           5246976
_________________________________________________________________
dense_5 (Dense)              (1, None, 176)            180400
=================================================================
Total params: 5,472,432
Trainable params: 5,472,432
Non-trainable params: 0
_________________________________________________________________</code></pre></div></span>
</blockquote>
<p>Let&#x27;s double check that input shape is simplified:</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">model_simplified<span class="token punctuation">.</span>input_shape</code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">(1, None)</code></pre></div></span>
</blockquote>
<h3 id="the-prediction-loop" style="position:relative">The prediction loop<a href="#the-prediction-loop" aria-label="the prediction loop permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>To use our trained model for recipe generation we need to implement a so-called prediction loop. The following code block generates the text using the loop:</p>
<ul>
<li>It starts by choosing a start string, initializing the RNN state and setting the number of characters to generate.</li>
<li>It gets the prediction distribution of the next character using the start string, and the RNN state.</li>
<li>Then, it uses a categorical distribution to calculate the index of the predicted character. It uses this predicted character as the next input to the model.</li>
<li>The RNN state returned by the model is fed back into the model so that it now has more context, instead of only one character. After predicting the next character, the modified RNN states are again fed back into the model, which is how it learns as it gets more context from the previously predicted characters.</li>
</ul>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 866px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9klEQVR42m2STWsTURSGT5w21ERNg0q7ELrza+HCbEIFswpSWxAXF0SrRZErSVHBIsaNF0yNSecrTWYmnaaZIBgjN1aTmWlpkib5A93ZHyK4dDHlTjNBxLO48HBe7vl6AQAgMV8LE0JOwDBWFttBvGAGPKaUchjR0DE5Pva+vFOdxFgfh//Fi3utqaUYmUAIcYxfP2meTsxrYQBwi7BiSUSnARCHEHU1bx/vno/H+SAZakahSzaV0l87JcGyM6n6RV20VvKZRl/NtQYaby0Vc+b1YnZ7fz3zrbPB25U1Yk+rfHNDXm10SrzV1rLWLa+o+2El374rSNVlLd9CmdT3s4bQmy3ItWfrUh1rud4lJd2b0SXzoSRVl8vCXlxL2eFyrnNbFD8lS9L2A5Yn5NA/6rBgf1g0evKfrS6fdEfRyeVyV/hp9OX+tfhUMLKAA9rOR77al38rzfRNppEbq3OVnvirsi+KjJ+S5xciGNg+fVBord1QfwiNQiM7x5K8sjWzaRa1yp76DgA4BA6nUCVhtNXP2fr7K0wjGOqssat92dyRH7lry3ZDr7Bwju3Ya/SMdwDHcXzo6qE/Agfj3lVJbDAWg8GEJ2YaxgSc46PFBmM6ORi5AqLR6Mm/bUOwGUgm6SmPEaVc6n4tPETXNm+wHiKE+v+1zBHE+8hHOHzUdwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Prediction loop"
        title=""
        src="/static/47e18cbb8b1bcf3590ff8231b4978b36/c1328/7.png"
        srcset="/static/47e18cbb8b1bcf3590ff8231b4978b36/63868/7.png 250w,
/static/47e18cbb8b1bcf3590ff8231b4978b36/0b533/7.png 500w,
/static/47e18cbb8b1bcf3590ff8231b4978b36/c1328/7.png 866w"
        sizes="(max-width: 866px) 100vw, 866px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<blockquote>
<p>Image source: <a href="https://www.tensorflow.org/tutorials/text/text_generation">Text generation with an RNN</a> notebook.</p>
</blockquote>
<p>The <span><code class="language-text">temperature</code></span> parameter here defines how fuzzy or how unexpected the generated recipe is going to be. Low temperatures results in more predictable text. Higher temperatures result in more surprising text. You need to experiment to find the best setting. We will do some experimentation with different temperatures below.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate_text</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> start_string<span class="token punctuation">,</span> num_generate <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> temperature<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Evaluation step (generating text using the learned model)</span>

    padded_start_string <span class="token operator">=</span> STOP_WORD_TITLE <span class="token operator">+</span> start_string

    <span class="token comment"># Converting our start string to numbers (vectorizing).</span>
    input_indices <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>texts_to_sequences<span class="token punctuation">(</span><span class="token punctuation">[</span>padded_start_string<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Empty string to store our results.</span>
    text_generated <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment"># Here batch size == 1.</span>
    model<span class="token punctuation">.</span>reset_states<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> char_index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_generate<span class="token punctuation">)</span><span class="token punctuation">:</span>
        predictions <span class="token operator">=</span> model<span class="token punctuation">(</span>input_indices<span class="token punctuation">)</span>
        <span class="token comment"># remove the batch dimension</span>
        predictions <span class="token operator">=</span> tf<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>predictions<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token comment"># Using a categorical distribution to predict the character returned by the model.</span>
        predictions <span class="token operator">=</span> predictions <span class="token operator">/</span> temperature
        predicted_id <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>categorical<span class="token punctuation">(</span>
            predictions<span class="token punctuation">,</span>
            num_samples<span class="token operator">=</span><span class="token number">1</span>
        <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># We pass the predicted character as the next input to the model</span>
        <span class="token comment"># along with the previous hidden state.</span>
        input_indices <span class="token operator">=</span> tf<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span><span class="token punctuation">[</span>predicted_id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

        next_character <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>sequences_to_texts<span class="token punctuation">(</span>input_indices<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

        text_generated<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_character<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>padded_start_string <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>text_generated<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div></span>
<h3 id="figuring-out-proper-temperature-for-prediction-loop" style="position:relative">Figuring out proper temperature for prediction loop<a href="#figuring-out-proper-temperature-for-prediction-loop" aria-label="figuring out proper temperature for prediction loop permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h3>
<p>Now, let&#x27;s use <span><code class="language-text">generate_text()</code></span> to actually generate some new recipes. The <span><code class="language-text">generate_combinations()</code></span> function goes through all possible combinations of the first recipe letters and temperatures. It generates <span><code class="language-text">56</code></span> different combinations to help us figure out how the model performs and what temperature is better to use.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate_combinations</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    recipe_length <span class="token operator">=</span> <span class="token number">1000</span>
    try_letters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'L'</span><span class="token punctuation">,</span> <span class="token string">'Mushroom'</span><span class="token punctuation">,</span> <span class="token string">'Apple'</span><span class="token punctuation">,</span> <span class="token string">'Slow'</span><span class="token punctuation">,</span> <span class="token string">'Christmass'</span><span class="token punctuation">,</span> <span class="token string">'The'</span><span class="token punctuation">,</span> <span class="token string">'Banana'</span><span class="token punctuation">,</span> <span class="token string">'Homemade'</span><span class="token punctuation">]</span>
    try_temperature <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> letter <span class="token keyword">in</span> try_letters<span class="token punctuation">:</span>
        <span class="token keyword">for</span> temperature <span class="token keyword">in</span> try_temperature<span class="token punctuation">:</span>
            generated_text <span class="token operator">=</span> generate_text<span class="token punctuation">(</span>
                model<span class="token punctuation">,</span>
                start_string<span class="token operator">=</span>letter<span class="token punctuation">,</span>
                num_generate <span class="token operator">=</span> recipe_length<span class="token punctuation">,</span>
                temperature<span class="token operator">=</span>temperature
            <span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Attempt: "</span><span class="token interpolation"><span class="token punctuation">{</span>letter<span class="token punctuation">}</span></span><span class="token string">" + </span><span class="token interpolation"><span class="token punctuation">{</span>temperature<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-----------------------------------'</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>generated_text<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span>
</code></pre></div></span>
<p>To avoid making this article too long only some of those <span><code class="language-text">56</code></span> combinations will be printed below.</p>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">generate_combinations<span class="token punctuation">(</span>model_simplified<span class="token punctuation">)</span></code></pre></div></span>
<p><em><small> output:</small></em></p>
<blockquote>
<span><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Attempt: "A" + 1.0
-----------------------------------
 Azzeric Sweet Potato Puree



 24 large baking potatoes, such as Carn or Marinara or 1 (14-ounce) can pot wine
 1/4 pound unsalted butter, cut into small pieces
 1/2 cup coarsely chopped scallions



 Bring a large pot of water to a boil, place a large nonstick skillet over medium-high heat, add All Naucocal Volves. Reduce heat to medium and cook the potatoes until just cooked through, bubbles before adding the next layer, about 10 to 12 minutes. Remove ground beans and reserve. Reserve the crumb mixture for about 6 greased. Let cool 2 minutes. Strain soak into a glass pitcher. Let cool in ice. Add short-goodfish to the batter and stir to dissolve. Pour in the cheese mixture and whisk until smooth. Set aside for 20 seconds more. Remove dumplings and cheese curds. Spread 1/3 cup of the mixture on each circle for seal ballo. Transfer mixture into a greased 9-by-11-inch baking dish and chill for 20 minutes.
 Bake, covered, for 30 minutes. Serve warm.




Attempt: "A" + 0.4
-----------------------------------
 Apricot "Cookie" Cakes



 1 cup all-purpose flour
 1 cup corn flour
 1 cup sugar
 1 tablespoon baking powder
 1 teaspoon salt
 1 teaspoon ground cinnamon
 1 cup grated Parmesan
 1 cup pecans, chopped
 1/2 cup chopped pecans
 1/2 cup raisins



 Preheat oven to 350 degrees F.
 Butter and flour a 9 by 13-inch baking dish. In a medium bowl, whisk together the flour, sugar, baking powder, baking soda and salt. In a small bowl, whisk together the eggs, sugar, and eggs. Add the flour mixture to the butter mixture and mix until just combined. Stir in the raisins and pecans and transfer to the prepared pan. Spread the batter over the top of the crust. Bake for 15 minutes. Reduce the oven temperature to 350 degrees F, and bake until the cupcakes are set and the top is golden brown, about 20 minutes more. Transfer the cake to a wire rack to cool to room temperature. Refrigerate until ready to serve.




Attempt: "A" + 0.2
-----------------------------------
 Alternative to the Fondant



 1 cup sugar
 1 cup water
 1 cup heavy cream
 1 teaspoon vanilla extract
 1/2 cup heavy cream
 1/2 cup heavy cream
 1 teaspoon vanilla extract
 1/2 cup chopped pecans



 In a saucepan over medium heat, combine the sugar, sugar, and corn syrup. Cook over medium heat until the sugar is dissolved. Remove from the heat and stir in the vanilla. Refrigerate until cold. Stir in the chocolate chips and the chocolate chips. Serve immediately.




Attempt: "B" + 0.4
-----------------------------------
 Battered French Toast with Bacon, Bacon, and Caramelized Onions and Pecorino



 1/2 pound squid (shredded carrots)
 1 small onion, diced
 1 small green pepper, seeded and cut into strips
 1 red bell pepper, stemmed, seeded and cut into 1/4-inch dice
 1 small onion, chopped
 1 green bell pepper, chopped
 1 cup chicken stock
 1 cup heavy cream
 1/2 cup shredded sharp Cheddar
 1 teaspoon ground cumin
 1 teaspoon salt
 1 teaspoon freshly ground black pepper



 Preheat the oven to 350 degrees F.
 For the bacon mixture: In a large bowl, combine the cheese, sour cream, mustard, salt, pepper, and hot sauce. Stir together and mix well. Fold in the milk and set aside.
 For the filling: In a large bowl, mix the flour and salt and pepper, to taste. Add the beaten eggs and mix to combine. Set aside.
 For the topping: Mix the cream cheese with the mayonnaise, salt and pepper in a medium bowl. Add the chicken and toss to coat the other side. Transfer the mixture to the prepared





Attempt: "C" + 1.0
-----------------------------------
 Crema battered Salmon



 1 cup fresh cranberries (from 4 tablespoons left of 4 egg whites)
 3 teaspoons sugar
 1 tablespoon unsalted butter
 2 tablespoons truffle oil
 Coarse salt
 Freshly ground black pepper



 Place cornmeal in a small serving bowl, and combine it. Drizzle milk over the plums and season with salt and pepper. Let stand for about 5 minutes, until firm. Serve immediately.




Attempt: "C" + 0.8
-----------------------------------
 Classic Iseasteroles



 3 cups milk
 3/4 cup coconut milk
 1/2 cup malted maple syrup
 1/2 teaspoon salt
 3 cups sugar
 4 1-inch strawberries, sliced into 1/4-inch pieces
 1/2 teaspoon ground cinnamon



 Place the cherries in a small saucepan; sprinkle with the sugar. Bring to a simmer over medium-low heat, then remove from the heat. Let stand until the coconut fluffy, about 15 to 20 minutes. Drain the coconut oil in a stream, whisking until combined. Add the cream, espresso and cocoa powder and stir to combine. Cover and refrigerate until ready to serve. Makes 10 to 12 small springs in the same fat from the surface of the bowl, which using paper colors, and freeze overnight.
 Meanwhile, combine the cream, sugar, vanilla and salt in a medium saucepan. Cook over medium heat until the sugar dissolves and the sugar melts and begins to boil, about 5 minutes. Remove from the heat and stir in the vanilla.
 To serve, carefully remove the pops from the casserole and put them in



Attempt: "C" + 0.4
-----------------------------------
 Cinnamon Corn Cakes with Coconut Flour and Saffron Sauce



 3 cups shredded sharp Cheddar
 1 cup grated Parmesan
 2 cups shredded sharp Cheddar
 1 cup grated Parmesan
 1 cup shredded part-skim mozzarella cheese
 1 cup grated Parmesan
 1 cup grated Parmesan
 1 cup grated Parmesan
 1 teaspoon kosher salt
 1/2 teaspoon freshly ground black pepper



 Preheat the oven to 400 degrees F. Line a baking sheet with a silpat and preheat the oven to 350 degrees F.
 In a large bowl, combine the masa harina, cumin, cayenne, and salt and pepper. Dredge the pasta in the flour and then dip in the egg mixture, then dip in the eggs, then dip in the egg mixture and then dredge in the breadcrumbs. Place the breaded cheese on a sheet tray. Bake until the crust is golden brown and the filling is bubbling, about 25 to 30 minutes. Remove from the oven and serve hot.





Attempt: "L" + 0.4
-----------------------------------
 Lighted Flan with Chocolate and Pecans



 2 cups milk
 1 cup sugar
 1 teaspoon vanilla extract
 1 cup heavy cream
 1/2 cup heavy cream
 1 tablespoon powdered sugar
 1 teaspoon vanilla extract
 1/2 cup heavy cream
 1/2 teaspoon ground cinnamon
 1/2 teaspoon ground nutmeg
 1/2 cup chopped pecans



 Watch how to make this recipe.
 In a small saucepan, combine the sugar, salt, and a pinch of salt. Cook over medium heat, stirring occasionally, until the sugar has dissolved. Remove from the heat and set aside to cool. Remove the cherries from the refrigerator and place in the freezer for 1 hour.
 In a blender, combine the milk, sugar, vanilla, salt and water. Blend until smooth. Pour the mixture into a 9-by-13-inch glass baking dish and set aside.
 In a small saucepan, combine the remaining 2 cups sugar, the vanilla, and 2 cups water. Bring the mixture to a boil, and then reduce the heat to low. Cook until the sugar is dissolved, about 5 minutes. Remove from the heat an



Attempt: "L" + 0.2
-----------------------------------
 Lighted Fondanta with Chocolate and Cream Cheese Frosting



 1 cup heavy cream
 1 tablespoon sugar
 1 tablespoon vanilla extract
 1 teaspoon vanilla extract
 1 cup heavy cream
 1 cup heavy cream
 1/2 cup sugar
 1 teaspoon vanilla extract
 1 teaspoon vanilla extract
 1/2 cup chopped pistachios



 Preheat the oven to 350 degrees F.
 In a large bowl, combine the cream cheese, sugar, eggs, vanilla, and salt. Stir until smooth. Pour the mixture into the prepared baking dish. Sprinkle with the remaining 1/2 cup sugar and bake for 15 minutes. Reduce the heat to 350 degrees F and bake until the crust is golden brown, about 15 minutes more. Remove from the oven and let cool completely. Spread the chocolate chips on the parchment paper and bake until the chocolate is melted and the top is golden brown, about 10 minutes. Set aside to cool.
 In a medium bowl, whisk together the egg yolks, sugar, and vanilla until smooth. Stir in the cream and continue to beat until the chocolate



Attempt: "Mushroom" + 1.0
-----------------------------------
 Mushroom and Bacon Soup with Jumbo Sugar Coating



 2 tablespoons vegetable oil
 1 2/3 pounds red cabbage, shredded, about 4 cups of excess pasted dark ends of fat, and pocked or firm
 2 red bell peppers, cored, seeded and diced
 1 poblano pepper, chopped
 3 medium carrots, finely chopped
 1/2 medium pinch saffron
 4 cups water
 2 cups mushrooms or 1/2 cup frozen Sojo Bean red
 Salt and freshly ground black pepper
 1 pound andouille sausage
 1 gallon vegetable broth
 Chopped fresh parsley, cilantro leaves, for garnish



 In a large Dutch oven for gas burner, heat oil over moderate heat. Add the leeks to the pot, scraping the bottom of the skillet. Add the beans and sausage and sprinkle the reserved potatoes with some orange juice cooked sausage (such as The Sauce.) Add roasted vegetables and pinto beans, mozzarella, basil and bamboo shoots. Simmer rice until soup is absorbed, 15 to 20 minutes.
 Bring another pan of water to a boil and cook shrimp for 5 minutes. While onions



Attempt: "Mushroom" + 0.8
-----------------------------------
 Mushrooms with Lentil Stewed Shallots and Tomatoes



 1 tablespoon olive oil
 3 cloves garlic, smashed
 Kosher salt
 1 1/2 pounds lean ground turkey
 1 cup coarsely peeled tart apples
 2 tablespoons chopped garlic
 1 teaspoon ground cumin
 1/2 teaspoon cayenne pepper
 1 teaspoon chopped fresh thyme
 3/4 cup chopped fresh basil
 1/2 small carrot, halved lengthwise and cut into 1/2-inch pieces
 1 roasted red pepper, halved and sliced vertically diced and separated into rough chops
 3 tablespoons unsalted butter
 2 cups shredded mozzarella
 1/4 cup grated parmesan cheese
 1/4 cup prepared basil pesto



 Stir the olive oil, garlic, thyme and 1 teaspoon salt in a saucepan; bring to a simmer over medium heat. Remove from the heat. Add the basil and toast the soup for 2 minutes.
 Meanwhile, heat 4 to 4 inches vegetable oil in the skillet over medium-high heat. Add the olive oil, garlic, 1/2 teaspoon salt and 1/2 teaspoon pepper and cook, stirring often, until cooked through, a



Attempt: "Mushroom" + 0.4
-----------------------------------
 Mushroom Ravioli with Chickpeas and Shiitake Mushrooms and Sun-Dried Tomatoes



 1 pound zucchini
 1 cup chicken broth
 1 cup fresh basil leaves
 1/2 cup chopped fresh basil leaves
 1/2 cup grated Parmesan
 1 teaspoon salt
 1/2 teaspoon freshly ground black pepper
 1 teaspoon chopped fresh thyme
 1 teaspoon fresh lemon juice
 2 cups chicken broth
 1/2 cup grated Parmesan
 1/2 cup grated Parmigiano-Reggiano



 Preheat oven to 450 degrees F.
 Place the bread cubes in a large bowl. Add the basil, parsley, olive oil, parsley, thyme, basil, salt and pepper and toss to coat. Spread the mixture out on a baking sheet and bake until the sausages are cooked through, about 20 minutes. Serve immediately.
 In a small saucepan, bring the chicken stock to a boil. Reduce the heat to low and cook the soup until the liquid is absorbed. Remove from the heat and stir in the parsley, shallots and season with salt and pepper. Serve immediately.




Attempt: "Mushroom" + 0.2
-----------------------------------
 Mushroom and Spicy Sausage Stuffing



 1 tablespoon olive oil
 1 medium onion, chopped
 2 cloves garlic, minced
 1 cup frozen peas
 1 cup frozen peas
 1/2 cup chopped fresh parsley
 1/2 cup grated Parmesan
 1/2 cup grated Parmesan
 1 teaspoon salt
 1/2 teaspoon freshly ground black pepper
 1 cup shredded mozzarella
 1/2 cup grated Parmesan
 1 cup shredded mozzarella
 1 cup shredded mozzarella cheese



 Preheat the oven to 350 degrees F.
 Bring a large pot of salted water to a boil. Add the pasta and cook until al dente, about 6 minutes. Drain and reserve.
 Meanwhile, heat the olive oil in a large skillet over medium-high heat. Add the shallots and saute until tender, about 3 minutes. Add the garlic and cook for 1 minute. Add the sausage and cook until the shallots are tender, about 3 minutes. Add the sausage and cook until tender, about 2 minutes. Add the garlic and cook, stirring, until the garlic is lightly browned, about 1 minute. Add the sausage and cook until the s</code></pre></div></span>
</blockquote>
<h2 id="interactive-model-demo" style="position:relative">Interactive model demo<a href="#interactive-model-demo" aria-label="interactive model demo permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>You may use  <a href="https://trekhleb.dev/machine-learning-experiments/#/experiments/RecipeGenerationRNN">Cooking recipes generator demo</a> to play around with this model, input text, and temperature parameters to generate some random recipes right in your browser.</p>
<img src="/posts-assets/4139990ec63f03c35fab15d60ea74eff/8.gif" alt="Recipe generator demo"/>
<h2 id="things-to-improve" style="position:relative">Things to improve<a href="#things-to-improve" aria-label="things to improve permalink" class="gatsby-remark-autolink-header-anchor after"><span><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></span></a></h2>
<p>This out of scope for this article but model still has the following issues that need to be addressed:</p>
<ul>
<li>We need to get rid of duplicates on the ingredients section.</li>
<li>Recipe sections (name, ingredients and cooking steps) are disconnected most of the time, meaning that we may see, let&#x27;s say, <span><code class="language-text">mushrooms</code></span> in the ingredients section, but they are not mentioned in the name of the recipe or in the cooking steps.</li>
</ul></article></div><div class="flex flex-row justify-center items-center mt-16"><div class="max-w-md"><div class="bg-white rounded-md shadow-md p-8"><h1 class="text-grey-darkest uppercase font-bold text-xl mb-3">Subscribe to the Newsletter</h1><p class="text-sm mb-3">Get my latest posts and project updates by email</p><form action="https://dev.us1.list-manage.com/subscribe/post?u=7714f14ff32085c685da2cfaa&amp;amp;id=53ffa81463" method="post" class="flex flex-col"><input placeholder="First Name" type="text" name="FNAME" class="border py-2 px-3 mb-3 rounded border-gray-300 border-solid appearance-none" required=""/><input placeholder="Email" type="email" name="EMAIL" class="border py-2 px-3 mb-3 rounded border-gray-300 border-solid appearance-none" required=""/><div class="hidden" aria-hidden="true"><input type="text" name="b_7714f14ff32085c685da2cfaa_53ffa81463" tabindex="-1"/></div><input type="submit" class="transition duration-200 ease-in-out bg-black text-white py-2 px-3 rounded shadow-sm cursor-pointer hover:bg-gray-800" value="Subscribe"/></form></div></div></div></article><footer class="px-6 sm:px-12 py-12"><div class="flex flex-col sm:flex-row items-center "><div style="flex:1" class="flex flex-row items-center mb-6 sm:mb-0"><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 text-xs mr-5" href="/subscribe/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg><span class="w-2"></span>Subscribe</a><a href="https://github.com/sponsors/trekhleb" class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 text-xs mr-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"></path></svg><span class="w-2"></span>Support</a><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 text-xs" href="/rss.xml"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg><span class="w-2"></span>RSS</a></div><div style="flex:1" class="flex flex-row items-center justify-center"><ul class="flex flex-row flex-wrap "><li class="flex flex-row items-center last:mr-0 mr-2 ml-2"><a href="https://www.linkedin.com/in/trekhleb/" class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 " title="Oleksii Trekhleb on LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="flex flex-row items-center last:mr-0 mr-2 ml-2"><a href="https://github.com/trekhleb" class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 " title="Oleksii Trekhleb on GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li><li class="flex flex-row items-center last:mr-0 mr-2 ml-2"><a href="https://twitter.com/Trekhleb" class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 " title="Oleksii Trekhleb on Twitter"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a></li></ul></div><div style="flex:1" class="hidden sm:flex"></div></div></footer></div></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-YJ73BX984Z"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YJ73BX984Z', {"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2020/recipes-generation/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-8a13c87f52d044968f71.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-4995f17a1d86df466697.js\"],\"component---src-pages-blog-tsx\":[\"/component---src-pages-blog-tsx-b38268eb8fe6de71930a.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-48355e8dcb136801adac.js\"],\"component---src-pages-projects-tsx\":[\"/component---src-pages-projects-tsx-44a7ffc3079a934d09f5.js\"],\"component---src-pages-subscribe-confirm-index-tsx\":[\"/component---src-pages-subscribe-confirm-index-tsx-f764f208294f29d2a9b8.js\"],\"component---src-pages-subscribe-index-tsx\":[\"/component---src-pages-subscribe-index-tsx-6a787eda872ebdd22992.js\"],\"component---src-pages-subscribe-thanks-index-tsx\":[\"/component---src-pages-subscribe-thanks-index-tsx-66c6188ca835b0cecc4e.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2017-dangerous-step-from-agile-to-fragile-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2017-dangerous-step-from-agile-to-fragile-index-md-04c390e95e5cb39fe5a4.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2017-docker-whale-in-digital-ocean-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2017-docker-whale-in-digital-ocean-index-md-faae5b9165294e67a435.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2017-how-to-create-aot-jit-compatible-angular-4-library-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2017-how-to-create-aot-jit-compatible-angular-4-library-index-md-2d3ff89f246c8ff4bc15.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2017-if-you-ever-used-subway-you-should-know-what-binary-search-tree-is-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2017-if-you-ever-used-subway-you-should-know-what-binary-search-tree-is-index-md-522c101a7090751a774b.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2017-solid-principles-around-you-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2017-solid-principles-around-you-index-md-8c8e74d893b08f6b5e08.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-aggregatus-service-is-live-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-aggregatus-service-is-live-index-md-9a54ceb39859e2ed9dd8.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-algorithms-and-data-structures-in-javascript-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-algorithms-and-data-structures-in-javascript-index-md-a3887cc7616a8620ebc5.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-dynamic-programming-vs-divide-and-conquer-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-dynamic-programming-vs-divide-and-conquer-index-md-8cee82b401ac5d0af9d1.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-extend-your-limits-rather-than-your-ambitions-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-extend-your-limits-rather-than-your-ambitions-index-md-816e3e47f9ac8caea899.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-gift-of-24-hours-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-gift-of-24-hours-index-md-5ebf65a550cdc7855566.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-homemade-machine-learning-in-python-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-homemade-machine-learning-in-python-index-md-e15de15206e5d02b51bf.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-links-to-promote-your-next-startup-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-links-to-promote-your-next-startup-index-md-18fd0971241d062b4c24.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-machine-learning-in-matlaboctave-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-machine-learning-in-matlaboctave-index-md-402f23af62ec031e99e1.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-permutations-combinations-cheat-sheet-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-permutations-combinations-cheat-sheet-index-md-8789b59f854967523bd4.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-playground-and-cheatsheet-for-learning-python-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-playground-and-cheatsheet-for-learning-python-index-md-25a083194b2acf96ab23.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-playing-with-discrete-fourier-transform-algorithm-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-playing-with-discrete-fourier-transform-algorithm-index-md-011a79dc8bbbc51d1c36.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2018-top-33-javascript-projects-on-github-august-2018-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2018-top-33-javascript-projects-on-github-august-2018-index-md-374c91876d254545999a.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2019-most-trending-jupyter-notebooks-of-december-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2019-most-trending-jupyter-notebooks-of-december-index-md-4d8ded6c0dc791e4a5a5.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2019-nano-neuron-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2019-nano-neuron-index-md-7dc42f2610eb68d4cbab.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2019-react-useposition-hook-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2019-react-useposition-hook-index-md-e6d86c86432813394656.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2019-technical-interview-preparation-checklist-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2019-technical-interview-preparation-checklist-index-md-161738903a4d60946f8d.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2020-coronavirus-covid-19-dashboard-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2020-coronavirus-covid-19-dashboard-index-md-8225f753bc830fbeb279.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2020-machine-learning-experiments-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2020-machine-learning-experiments-index-md-485b17cd2789438a90fe.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2020-printed-links-detection-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2020-printed-links-detection-index-md-0f8dd7a5283a47ea3ad1.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2020-recipes-generation-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2020-recipes-generation-index-md-d9f045fcbd1488aa31b9.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2020-state-of-the-art-shitcode-principles-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2020-state-of-the-art-shitcode-principles-index-md-bd935cb82087b9838297.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2020-this-is-how-social-media-could-ruin-your-happiness-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2020-this-is-how-social-media-could-ruin-your-happiness-index-md-69545d8c247cb71f46f5.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2020-top-33-javascript-projects-on-github-december-index-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2020-top-33-javascript-projects-on-github-december-index-md-09687a1593a0abfc630a.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-binary-floating-point-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-binary-floating-point-index-mdx-90a1d7fed3d76bf62001.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-content-aware-image-resizing-in-javascript-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-content-aware-image-resizing-in-javascript-index-mdx-3ef4f4ab0343d53e899f.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-gyro-web-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-gyro-web-index-mdx-7df6c01b62138703a73b.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-self-parking-car-evolution-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-self-parking-car-evolution-index-mdx-f27e9c59361f24e8dd4f.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-top-33-javascript-projects-on-github-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-top-33-javascript-projects-on-github-index-mdx-1611be1354edf4f84ae9.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2022-data-structure-sketches-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2022-data-structure-sketches-index-mdx-78fcb1fec689ce3a1bad.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2022-okso-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2022-okso-index-mdx-0999f7e9f7fed3fdb9b6.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2022-solid-principles-sketches-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2022-solid-principles-sketches-index-mdx-3fd3c54fa0d1ad70131d.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-micrograd-ts-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-micrograd-ts-index-mdx-47100eb1fd5d4593569c.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-observations-index-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-observations-index-mdx-52440d5b205646300e18.js\"],\"component---src-templates-project-tsx\":[\"/component---src-templates-project-tsx-8a5d9a0bb05fe0b7453b.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="2134dcfa9a4dd8feee1d";</script><script src="/webpack-runtime-17511008209f9362c4a5.js" async></script><script src="/framework-dffef80c3dd9823eec87.js" async></script><script src="/app-8a13c87f52d044968f71.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>