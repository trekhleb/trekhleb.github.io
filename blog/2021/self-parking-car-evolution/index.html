<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.a9734c063dcb1699d0b8.css" data-identity="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap);.post--2021--binary-floating-point--bit-button:hover{box-shadow:0 0 5px 1px rgba(0,0,0,.2);transition:box-shadow .2s ease-in-out}input:checked~.toggle__dot{transform:translateX(100%)}input:checked~.toggle__line{background-color:#48bb78}.post--2021--water-line--gyro-cube .gyro-cube-container{align-items:center;display:flex;height:400px;justify-content:center;perspective:800px;perspective-origin:50%}.post--2021--water-line--gyro-cube .gyro-cube{height:200px;position:relative;transform-style:preserve-3d;width:200px}.post--2021--water-line--gyro-cube .gyro-cube-side{align-items:center;border:2px solid #fff;color:#fff;display:flex;font-size:100px;font-weight:700;height:100%;justify-content:center;opacity:.8;position:absolute;width:100%}.post--2021--water-line--gyro-cube .gyro-cube-front{background-color:#d50000;transform:translateZ(100px)}.post--2021--water-line--gyro-cube .gyro-cube-back{background-color:#a0f;transform:translateZ(-100px)}.post--2021--water-line--gyro-cube .gyro-cube-left{background-color:#304ffe;transform:translateX(100px) rotateY(90deg)}.post--2021--water-line--gyro-cube .gyro-cube-right{background-color:#0091ea;transform:translateX(-100px) rotateY(90deg)}.post--2021--water-line--gyro-cube .gyro-cube-top{background-color:#00bfa5;transform:translateY(-100px) rotateX(90deg)}.post--2021--water-line--gyro-cube .gyro-cube-bottom{background-color:#64dd17;transform:translateY(100px) rotateX(90deg)}.custom-fade-in-opacity{-webkit-animation-duration:.8s;animation-duration:.8s;-webkit-animation-iteration-count:1;animation-iteration-count:1;-webkit-animation-name:customFadeInOpacity;animation-name:customFadeInOpacity;-webkit-animation-timing-function:ease-out;animation-timing-function:ease-out;opacity:1}@-webkit-keyframes customFadeInOpacity{0%{opacity:0}to{opacity:1}}@keyframes customFadeInOpacity{0%{opacity:0}to{opacity:1}}.prose blockquote p:first-of-type:before,.prose blockquote p:last-of-type:after,.prose code:after,.prose code:before{content:""!important}.prose blockquote{font-weight:400!important}.prose li code.language-text,.prose p code.language-text,.prose td code.language-text,.prose th code.language-text,.prose tr code.language-text{font-weight:400;padding:2px 5px 1px}.prose p>img{margin:auto}.prose h1>a.gatsby-remark-autolink-header-anchor,.prose h2>a.gatsby-remark-autolink-header-anchor,.prose h3>a.gatsby-remark-autolink-header-anchor,.prose h4>a.gatsby-remark-autolink-header-anchor,.prose h5>a.gatsby-remark-autolink-header-anchor{display:inline-block;margin-left:10px;visibility:hidden}.prose h1:hover>a.gatsby-remark-autolink-header-anchor,.prose h2:hover>a.gatsby-remark-autolink-header-anchor,.prose h3:hover>a.gatsby-remark-autolink-header-anchor,.prose h4:hover>a.gatsby-remark-autolink-header-anchor,.prose h5:hover>a.gatsby-remark-autolink-header-anchor{visibility:visible}

/* ! tailwindcss v2.2.19 | MIT License | https://tailwindcss.com */

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-webkit-text-size-adjust:100%;line-height:1.15;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;margin:0}hr{color:inherit;height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}::-moz-focus-inner{border-style:none;padding:0}legend{padding:0}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:Roboto,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{border:0 solid;box-sizing:border-box}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{color:inherit;line-height:inherit;padding:0}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{--tw-border-opacity:1;border-color:rgba(229,231,235,var(--tw-border-opacity))}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.prose{color:#374151;max-width:65ch}.prose [class~=lead]{color:#4b5563;font-size:1.25em;line-height:1.6;margin-bottom:1.2em;margin-top:1.2em}.prose a{color:#dc2626;font-weight:500;text-decoration:underline}.prose a:hover{color:#ef4444}.prose strong{color:#111827;font-weight:600}.prose ol[type=A]{--list-counter-style:upper-alpha}.prose ol[type=a]{--list-counter-style:lower-alpha}.prose ol[type=A s]{--list-counter-style:upper-alpha}.prose ol[type=a s]{--list-counter-style:lower-alpha}.prose ol[type=I]{--list-counter-style:upper-roman}.prose ol[type=i]{--list-counter-style:lower-roman}.prose ol[type=I s]{--list-counter-style:upper-roman}.prose ol[type=i s]{--list-counter-style:lower-roman}.prose ol[type="1"]{--list-counter-style:decimal}.prose ol>li{padding-left:1.75em;position:relative}.prose ol>li:before{color:#6b7280;content:counter(list-item,var(--list-counter-style,decimal)) ".";font-weight:400;left:0;position:absolute}.prose ul>li{padding-left:1.75em;position:relative}.prose ul>li:before{background-color:#d1d5db;border-radius:50%;content:"";height:.375em;left:.25em;position:absolute;top:.6875em;width:.375em}.prose hr{border-color:#e5e7eb;border-top-width:1px;margin-bottom:3em;margin-top:3em}.prose blockquote{border-left-color:#e5e7eb;border-left-width:.25rem;color:#111827;font-style:italic;font-weight:500;margin-bottom:1.6em;margin-top:1.6em;padding-left:1em;quotes:"\201C""\201D""\2018""\2019"}.prose blockquote p:first-of-type:before{content:open-quote}.prose blockquote p:last-of-type:after{content:close-quote}.prose h1{color:#111827;font-size:2.25em;font-weight:800;line-height:1.1111111;margin-bottom:.8888889em;margin-top:0}.prose h2{color:#111827;font-size:1.5em;font-weight:700;line-height:1.3333333;margin-bottom:1em;margin-top:2em}.prose h3{font-size:1.25em;line-height:1.6;margin-bottom:.6em;margin-top:1.6em}.prose h3,.prose h4{color:#111827;font-weight:600}.prose h4{line-height:1.5;margin-bottom:.5em;margin-top:1.5em}.prose figure figcaption{color:#6b7280;font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose code{color:#111827;font-size:.875em;font-weight:600}.prose code:after,.prose code:before{content:"`"}.prose a code{color:#111827}.prose pre{background-color:#1f2937;border-radius:.375rem;color:#e5e7eb;font-size:.875em;line-height:1.7142857;margin-bottom:1.7142857em;margin-top:1.7142857em;overflow-x:auto;padding:.8571429em 1.1428571em}.prose pre code{background-color:transparent;border-radius:0;border-width:0;color:inherit;font-family:inherit;font-size:inherit;font-weight:400;line-height:inherit;padding:0}.prose pre code:after,.prose pre code:before{content:none}.prose table{font-size:.875em;line-height:1.7142857;margin-bottom:2em;margin-top:2em;table-layout:auto;text-align:left;width:100%}.prose thead{border-bottom-color:#d1d5db;border-bottom-width:1px;color:#111827;font-weight:600}.prose thead th{padding-bottom:.5714286em;padding-left:.5714286em;padding-right:.5714286em;vertical-align:bottom}.prose tbody tr{border-bottom-color:#e5e7eb;border-bottom-width:1px}.prose tbody tr:last-child{border-bottom-width:0}.prose tbody td{padding:.5714286em;vertical-align:top}.prose{font-size:1rem;line-height:1.75}.prose p{margin-bottom:1.25em;margin-top:1.25em}.prose figure,.prose img,.prose video{margin-bottom:2em;margin-top:2em}.prose figure>*{margin-bottom:0;margin-top:0}.prose h2 code{font-size:.875em}.prose h3 code{font-size:.9em}.prose ol,.prose ul{margin-bottom:1.25em;margin-top:1.25em}.prose li{margin-bottom:.5em;margin-top:.5em}.prose>ul>li p{margin-bottom:.75em;margin-top:.75em}.prose>ul>li>:first-child{margin-top:1.25em}.prose>ul>li>:last-child{margin-bottom:1.25em}.prose>ol>li>:first-child{margin-top:1.25em}.prose>ol>li>:last-child{margin-bottom:1.25em}.prose ol ol,.prose ol ul,.prose ul ol,.prose ul ul{margin-bottom:.75em;margin-top:.75em}.prose h2+*,.prose h3+*,.prose h4+*,.prose hr+*{margin-top:0}.prose thead th:first-child{padding-left:0}.prose thead th:last-child{padding-right:0}.prose tbody td:first-child{padding-left:0}.prose tbody td:last-child{padding-right:0}.prose>:first-child{margin-top:0}.prose>:last-child{margin-bottom:0}.prose-sm{font-size:.875rem;line-height:1.7142857}.prose-sm p{margin-bottom:1.1428571em;margin-top:1.1428571em}.prose-sm [class~=lead]{font-size:1.2857143em;line-height:1.5555556;margin-bottom:.8888889em;margin-top:.8888889em}.prose-sm blockquote{margin-bottom:1.3333333em;margin-top:1.3333333em;padding-left:1.1111111em}.prose-sm h1{font-size:2.1428571em;line-height:1.2;margin-bottom:.8em;margin-top:0}.prose-sm h2{font-size:1.4285714em;line-height:1.4;margin-bottom:.8em;margin-top:1.6em}.prose-sm h3{font-size:1.2857143em;line-height:1.5555556;margin-bottom:.4444444em;margin-top:1.5555556em}.prose-sm h4{line-height:1.4285714;margin-bottom:.5714286em;margin-top:1.4285714em}.prose-sm figure,.prose-sm img,.prose-sm video{margin-bottom:1.7142857em;margin-top:1.7142857em}.prose-sm figure>*{margin-bottom:0;margin-top:0}.prose-sm figure figcaption{font-size:.8571429em;line-height:1.3333333;margin-top:.6666667em}.prose-sm code{font-size:.8571429em}.prose-sm h2 code{font-size:.9em}.prose-sm h3 code{font-size:.8888889em}.prose-sm pre{border-radius:.25rem;font-size:.8571429em;line-height:1.6666667;margin-bottom:1.6666667em;margin-top:1.6666667em;padding:.6666667em 1em}.prose-sm ol,.prose-sm ul{margin-bottom:1.1428571em;margin-top:1.1428571em}.prose-sm li{margin-bottom:.2857143em;margin-top:.2857143em}.prose-sm ol>li{padding-left:1.5714286em}.prose-sm ol>li:before{left:0}.prose-sm ul>li{padding-left:1.5714286em}.prose-sm ul>li:before{height:.3571429em;left:.2142857em;top:.67857em;width:.3571429em}.prose-sm>ul>li p{margin-bottom:.5714286em;margin-top:.5714286em}.prose-sm>ul>li>:first-child{margin-top:1.1428571em}.prose-sm>ul>li>:last-child{margin-bottom:1.1428571em}.prose-sm>ol>li>:first-child{margin-top:1.1428571em}.prose-sm>ol>li>:last-child{margin-bottom:1.1428571em}.prose-sm ol ol,.prose-sm ol ul,.prose-sm ul ol,.prose-sm ul ul{margin-bottom:.5714286em;margin-top:.5714286em}.prose-sm hr{margin-bottom:2.8571429em;margin-top:2.8571429em}.prose-sm h2+*,.prose-sm h3+*,.prose-sm h4+*,.prose-sm hr+*{margin-top:0}.prose-sm table{font-size:.8571429em;line-height:1.5}.prose-sm thead th{padding-bottom:.6666667em;padding-left:1em;padding-right:1em}.prose-sm thead th:first-child{padding-left:0}.prose-sm thead th:last-child{padding-right:0}.prose-sm tbody td{padding:.6666667em 1em}.prose-sm tbody td:first-child{padding-left:0}.prose-sm tbody td:last-child{padding-right:0}.prose-sm>:first-child{margin-top:0}.prose-sm>:last-child{margin-bottom:0}.prose-red a,.prose-red a code{color:#dc2626}.static{position:static}.absolute{position:absolute}.relative{position:relative}.inset-y-0{bottom:0;top:0}.left-0{left:0}.m-auto{margin:auto}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-6{margin-top:1.5rem}.mt-16{margin-top:4rem}.mr-0{margin-right:0}.mr-1{margin-right:.25rem}.mr-2{margin-right:.5rem}.mr-3{margin-right:.75rem}.mr-4{margin-right:1rem}.mr-5{margin-right:1.25rem}.mr-6{margin-right:1.5rem}.mb-0{margin-bottom:0}.mb-1{margin-bottom:.25rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-12{margin-bottom:3rem}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.ml-3{margin-left:.75rem}.ml-4{margin-left:1rem}.ml-5{margin-left:1.25rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.grid{display:grid}.hidden{display:none}.h-0{height:0}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-48{height:12rem}.h-64{height:16rem}.h-96{height:24rem}.h-0\.5{height:.125rem}.h-full{height:100%}.w-1{width:.25rem}.w-2{width:.5rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-10{width:2.5rem}.w-14{width:3.5rem}.w-16{width:4rem}.w-36{width:9rem}.w-64{width:16rem}.w-full{width:100%}.max-w-md{max-width:28rem}.max-w-screen-xl{max-width:1280px}.flex-1{flex:1 1 0%}.transform{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:-translate-y-1:hover{--tw-translate-y:-0.25rem}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{opacity:0;transform:scale(2)}}@keyframes ping{75%,to{opacity:0;transform:scale(2)}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}@keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}.cursor-pointer{cursor:pointer}.cursor-not-allowed{cursor:not-allowed}.resize{resize:both}.appearance-none{-webkit-appearance:none;-moz-appearance:none;appearance:none}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.items-stretch{align-items:stretch}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-12{gap:3rem}.self-start{align-self:flex-start}.self-stretch{align-self:stretch}.justify-self-end{justify-self:end}.overflow-hidden{overflow:hidden}.overflow-scroll{overflow:scroll}.whitespace-nowrap{white-space:nowrap}.rounded-sm{border-radius:.125rem}.rounded{border-radius:.25rem}.rounded-md{border-radius:.375rem}.rounded-full{border-radius:9999px}.border{border-width:1px}.border-solid{border-style:solid}.border-dashed{border-style:dashed}.border-black{--tw-border-opacity:1;border-color:rgba(0,0,0,var(--tw-border-opacity))}.border-white{--tw-border-opacity:1;border-color:rgba(255,255,255,var(--tw-border-opacity))}.border-gray-300{--tw-border-opacity:1;border-color:rgba(209,213,219,var(--tw-border-opacity))}.border-gray-400{--tw-border-opacity:1;border-color:rgba(156,163,175,var(--tw-border-opacity))}.border-red-500{--tw-border-opacity:1;border-color:rgba(239,68,68,var(--tw-border-opacity))}.hover\:border-white:hover{--tw-border-opacity:1;border-color:rgba(255,255,255,var(--tw-border-opacity))}.hover\:border-gray-400:hover{--tw-border-opacity:1;border-color:rgba(156,163,175,var(--tw-border-opacity))}.bg-black{--tw-bg-opacity:1;background-color:rgba(0,0,0,var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgba(243,244,246,var(--tw-bg-opacity))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgba(229,231,235,var(--tw-bg-opacity))}.bg-gray-400{--tw-bg-opacity:1;background-color:rgba(156,163,175,var(--tw-bg-opacity))}.bg-red-100{--tw-bg-opacity:1;background-color:rgba(254,226,226,var(--tw-bg-opacity))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgba(219,234,254,var(--tw-bg-opacity))}.hover\:bg-black:hover{--tw-bg-opacity:1;background-color:rgba(0,0,0,var(--tw-bg-opacity))}.hover\:bg-white:hover{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgba(31,41,55,var(--tw-bg-opacity))}.hover\:bg-red-500:hover{--tw-bg-opacity:1;background-color:rgba(239,68,68,var(--tw-bg-opacity))}.bg-cover{background-size:cover}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-bottom:.25rem;padding-top:.25rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-3{padding-bottom:.75rem;padding-top:.75rem}.py-6{padding-bottom:1.5rem;padding-top:1.5rem}.py-12{padding-bottom:3rem;padding-top:3rem}.pb-6{padding-bottom:1.5rem}.text-center{text-align:center}.text-xs{font-size:.75rem;line-height:1rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.font-light{font-weight:300}.font-normal{font-weight:400}.font-medium{font-weight:500}.font-semibold{font-weight:600}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.uppercase{text-transform:uppercase}.tracking-wider{letter-spacing:.05em}.tracking-widest{letter-spacing:.1em}.text-black{--tw-text-opacity:1;color:rgba(0,0,0,var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgba(156,163,175,var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgba(107,114,128,var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgba(55,65,81,var(--tw-text-opacity))}.text-red-500{--tw-text-opacity:1;color:rgba(239,68,68,var(--tw-text-opacity))}.text-red-600{--tw-text-opacity:1;color:rgba(220,38,38,var(--tw-text-opacity))}.text-blue-600{--tw-text-opacity:1;color:rgba(37,99,235,var(--tw-text-opacity))}.hover\:text-black:hover{--tw-text-opacity:1;color:rgba(0,0,0,var(--tw-text-opacity))}.hover\:text-white:hover{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.hover\:text-gray-500:hover{--tw-text-opacity:1;color:rgba(107,114,128,var(--tw-text-opacity))}.hover\:text-red-600:hover{--tw-text-opacity:1;color:rgba(220,38,38,var(--tw-text-opacity))}.underline{text-decoration:underline}*,:after,:before{--tw-shadow:0 0 #0000}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.shadow,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.shadow-inner,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-inner{--tw-shadow:inset 0 2px 4px 0 rgba(0,0,0,.06)}.shadow-card{--tw-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}*,:after,:before{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000}.filter{--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.grayscale{--tw-grayscale:grayscale(100%)}.transition{transition-duration:.15s;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-200{transition-duration:.2s}.duration-500{transition-duration:.5s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}@media (min-width:640px){.sm\:prose{color:#374151;max-width:65ch}.sm\:prose [class~=lead]{color:#4b5563;font-size:1.25em;line-height:1.6;margin-bottom:1.2em;margin-top:1.2em}.sm\:prose a{color:#dc2626;font-weight:500;text-decoration:underline}.sm\:prose a:hover{color:#ef4444}.sm\:prose strong{color:#111827;font-weight:600}.sm\:prose ol[type=A]{--list-counter-style:upper-alpha}.sm\:prose ol[type=a]{--list-counter-style:lower-alpha}.sm\:prose ol[type=A s]{--list-counter-style:upper-alpha}.sm\:prose ol[type=a s]{--list-counter-style:lower-alpha}.sm\:prose ol[type=I]{--list-counter-style:upper-roman}.sm\:prose ol[type=i]{--list-counter-style:lower-roman}.sm\:prose ol[type=I s]{--list-counter-style:upper-roman}.sm\:prose ol[type=i s]{--list-counter-style:lower-roman}.sm\:prose ol[type="1"]{--list-counter-style:decimal}.sm\:prose ol>li{padding-left:1.75em;position:relative}.sm\:prose ol>li:before{color:#6b7280;content:counter(list-item,var(--list-counter-style,decimal)) ".";font-weight:400;left:0;position:absolute}.sm\:prose ul>li{padding-left:1.75em;position:relative}.sm\:prose ul>li:before{background-color:#d1d5db;border-radius:50%;content:"";height:.375em;left:.25em;position:absolute;top:.6875em;width:.375em}.sm\:prose hr{border-color:#e5e7eb;border-top-width:1px;margin-bottom:3em;margin-top:3em}.sm\:prose blockquote{border-left-color:#e5e7eb;border-left-width:.25rem;color:#111827;font-style:italic;font-weight:500;margin-bottom:1.6em;margin-top:1.6em;padding-left:1em;quotes:"\201C""\201D""\2018""\2019"}.sm\:prose blockquote p:first-of-type:before{content:open-quote}.sm\:prose blockquote p:last-of-type:after{content:close-quote}.sm\:prose h1{color:#111827;font-size:2.25em;font-weight:800;line-height:1.1111111;margin-bottom:.8888889em;margin-top:0}.sm\:prose h2{color:#111827;font-size:1.5em;font-weight:700;line-height:1.3333333;margin-bottom:1em;margin-top:2em}.sm\:prose h3{font-size:1.25em;line-height:1.6;margin-bottom:.6em;margin-top:1.6em}.sm\:prose h3,.sm\:prose h4{color:#111827;font-weight:600}.sm\:prose h4{line-height:1.5;margin-bottom:.5em;margin-top:1.5em}.sm\:prose figure figcaption{color:#6b7280;font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.sm\:prose code{color:#111827;font-size:.875em;font-weight:600}.sm\:prose code:after,.sm\:prose code:before{content:"`"}.sm\:prose a code{color:#111827}.sm\:prose pre{background-color:#1f2937;border-radius:.375rem;color:#e5e7eb;font-size:.875em;line-height:1.7142857;margin-bottom:1.7142857em;margin-top:1.7142857em;overflow-x:auto;padding:.8571429em 1.1428571em}.sm\:prose pre code{background-color:transparent;border-radius:0;border-width:0;color:inherit;font-family:inherit;font-size:inherit;font-weight:400;line-height:inherit;padding:0}.sm\:prose pre code:after,.sm\:prose pre code:before{content:none}.sm\:prose table{font-size:.875em;line-height:1.7142857;margin-bottom:2em;margin-top:2em;table-layout:auto;text-align:left;width:100%}.sm\:prose thead{border-bottom-color:#d1d5db;border-bottom-width:1px;color:#111827;font-weight:600}.sm\:prose thead th{padding-bottom:.5714286em;padding-left:.5714286em;padding-right:.5714286em;vertical-align:bottom}.sm\:prose tbody tr{border-bottom-color:#e5e7eb;border-bottom-width:1px}.sm\:prose tbody tr:last-child{border-bottom-width:0}.sm\:prose tbody td{padding:.5714286em;vertical-align:top}.sm\:prose{font-size:1rem;line-height:1.75}.sm\:prose p{margin-bottom:1.25em;margin-top:1.25em}.sm\:prose figure,.sm\:prose img,.sm\:prose video{margin-bottom:2em;margin-top:2em}.sm\:prose figure>*{margin-bottom:0;margin-top:0}.sm\:prose h2 code{font-size:.875em}.sm\:prose h3 code{font-size:.9em}.sm\:prose ol,.sm\:prose ul{margin-bottom:1.25em;margin-top:1.25em}.sm\:prose li{margin-bottom:.5em;margin-top:.5em}.sm\:prose>ul>li p{margin-bottom:.75em;margin-top:.75em}.sm\:prose>ul>li>:first-child{margin-top:1.25em}.sm\:prose>ul>li>:last-child{margin-bottom:1.25em}.sm\:prose>ol>li>:first-child{margin-top:1.25em}.sm\:prose>ol>li>:last-child{margin-bottom:1.25em}.sm\:prose ol ol,.sm\:prose ol ul,.sm\:prose ul ol,.sm\:prose ul ul{margin-bottom:.75em;margin-top:.75em}.sm\:prose h2+*,.sm\:prose h3+*,.sm\:prose h4+*,.sm\:prose hr+*{margin-top:0}.sm\:prose thead th:first-child{padding-left:0}.sm\:prose thead th:last-child{padding-right:0}.sm\:prose tbody td:first-child{padding-left:0}.sm\:prose tbody td:last-child{padding-right:0}.sm\:prose>:first-child{margin-top:0}.sm\:prose>:last-child{margin-bottom:0}.sm\:mr-6{margin-right:1.5rem}.sm\:mb-0{margin-bottom:0}.sm\:flex{display:flex}.sm\:h-auto{height:auto}.sm\:w-2\/5{width:40%}.sm\:w-3\/5{width:60%}.sm\:flex-1{flex:1 1 0%}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\:flex-row{flex-direction:row}.sm\:items-start{align-items:flex-start}.sm\:items-center{align-items:center}.sm\:px-12{padding-left:3rem;padding-right:3rem}.sm\:text-left{text-align:left}}@media (min-width:1024px){.lg\:w-1\/4{width:25%}.lg\:w-3\/4{width:75%}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 3.14.6"/><title data-react-helmet="true">Self-Parking Car in 500 Lines of Code | Trekhleb</title><meta data-react-helmet="true" name="description" content="Training the car to do self-parking using a genetic algorithm"/><meta data-react-helmet="true" name="image" content="https://trekhleb.dev/static/14b49be9f15dfe3fccf2e51520529e6c/9aebb/01-cover-00.jpg"/><meta data-react-helmet="true" property="og:title" content="Self-Parking Car in 500 Lines of Code | Trekhleb"/><meta data-react-helmet="true" property="og:description" content="Training the car to do self-parking using a genetic algorithm"/><meta data-react-helmet="true" property="og:url" content="https://trekhleb.dev/blog/2021/self-parking-car-evolution/"/><meta data-react-helmet="true" property="og:image" content="https://trekhleb.dev/static/14b49be9f15dfe3fccf2e51520529e6c/9aebb/01-cover-00.jpg"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@Trekhleb"/><meta data-react-helmet="true" name="twitter:title" content="Self-Parking Car in 500 Lines of Code | Trekhleb"/><meta data-react-helmet="true" name="twitter:description" content="Training the car to do self-parking using a genetic algorithm"/><meta data-react-helmet="true" name="twitter:image" content="https://trekhleb.dev/static/14b49be9f15dfe3fccf2e51520529e6c/9aebb/01-cover-00.jpg"/><meta data-react-helmet="true" name="twitter:url" content="https://trekhleb.dev/blog/2021/self-parking-car-evolution/"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link rel="alternate" type="application/rss+xml" title="Trekhleb.dev RSS Feed" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-59f39c0b60ad4f4ae095.js"/><link as="script" rel="preload" href="/framework-71606407157990ae5149.js"/><link as="script" rel="preload" href="/app-fdc1157e733f6e22b946.js"/><link as="script" rel="preload" href="/commons-eaa46c7810bde7d7eddf.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-bb545a793b49d0c28aad.js"/><link as="fetch" rel="preload" href="/page-data/blog/2021/self-parking-car-evolution/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><main class="flex flex-col items-center"><div class="max-w-screen-xl self-stretch m-auto w-full"><header class="flex flex-row items-center px-6 sm:px-12 py-6"><div class="mr-6"><div><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 font-extrabold text-sm tracking-widest uppercase" href="/">Trekhleb</a></div></div><nav><ul class="flex flex-row"><li class="ml-5"><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 uppercase text-xs" href="/">About</a></li><li class="ml-5"><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 uppercase text-xs" href="/projects/">Projects</a></li><li class="ml-5"><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 uppercase text-xs" href="/blog/">Blog</a></li></ul></nav></header><article class="px-6 sm:px-12 py-6"><div class="flex flex-col items-center"><article class="w-full prose prose-sm sm:prose overflow-hidden prose-red" style="max-width:860px"><h1 class="text-3xl mb-6 uppercase font-extrabold ">Self-Parking Car in 500 Lines of Code</h1><div class="flex flex-row items-center "><div class="flex flex-row items-center mr-6"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>28 September, 2021</div><div class="flex flex-row items-center "><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>15<!-- --> min to read</div></div><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:42%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAHQF5UH/8QAFRABAQAAAAAAAAAAAAAAAAAAACH/2gAIAQEAAQUCqq//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAZEAADAQEBAAAAAAAAAAAAAAAAATFBYYH/2gAIAQEAAT8h93hW0T0mz//aAAwDAQACAAMAAAAQcC//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxCn/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Qh//EABoQAQADAAMAAAAAAAAAAAAAAAEAETEhQXH/2gAIAQEAAT8Qtc0bx0JZwjxkIIoO2Fz/2Q==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Self-Parking car evolution" title="Self-Parking car evolution" src="/static/d12ca71834fbd94cb291074778502a59/a2510/01-cover-01.jpg" srcSet="/static/d12ca71834fbd94cb291074778502a59/0479a/01-cover-01.jpg 250w,/static/d12ca71834fbd94cb291074778502a59/41099/01-cover-01.jpg 500w,/static/d12ca71834fbd94cb291074778502a59/a2510/01-cover-01.jpg 1000w,/static/d12ca71834fbd94cb291074778502a59/c58a3/01-cover-01.jpg 1500w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><h2 id="tldr" style="position:relative">TL;DR<a href="#tldr" aria-label="tldr permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>In this article, we&#x27;ll train the car to do self-parking using a <a href="https://en.wikipedia.org/wiki/Genetic_algorithm">genetic algorithm</a>.</p><p>We&#x27;ll create <strong>the 1st generation</strong> of cars with random genomes that will behave something like this:</p><p><img src="/posts-assets/f14ff147d0f8357d01cea24ca93d01b1/02-cars-before-01.gif" alt="The 1st generation of cars with random genomes"/></p><p><strong>On the ‚âà40th generation</strong> the cars start learning what the self-parking is and start getting closer to the parking spot:</p><p><img src="/posts-assets/a0fd3fcb4932b9c3c8719a74988d29e9/03-car-after-01.gif" alt="The 40th generation start learning how to park"/></p><p>Another example with a bit more challenging starting point:</p><p><img src="/posts-assets/cf87a6ec520ab03a37f1913c58349678/03-car-after-03.gif" alt="More challenging starting point for self-parking"/></p><blockquote><p>Yeah-yeah, the cars are hitting some other cars along the way, and also are not perfectly fitting the parking spot, but this is only the 40th generation since the creation of the world for them, so be merciful and give the cars some space to grow :D</p></blockquote><p>You may launch the üöï <a href="https://trekhleb.dev/self-parking-car-evolution">Self-parking Car Evolution Simulator</a> to see the evolution process directly in your browser. The simulator gives you the following opportunities:</p><ul><li>You may <a href="https://trekhleb.dev/self-parking-car-evolution?parking=evolution#/">train the cars from scratch</a> and adjust genetic parameters by yourself</li><li>You may <a href="https://trekhleb.dev/self-parking-car-evolution?parking=automatic#/">see the trained self-parking cars in action</a></li><li>You may also <a href="https://trekhleb.dev/self-parking-car-evolution?parking=manual#/">try to park the car manually</a></li></ul><p>The genetic algorithm for this project is implemented in TypeScript. The full genetic source code will be shown in this article, but you may also find the final code examples in the <a href="https://github.com/trekhleb/self-parking-car-evolution">Evolution Simulator repository</a>.</p><blockquote><p>We&#x27;re going to use a genetic algorithm for the particular task of evolving cars&#x27; genomes. However, this article only touches on the basics of the algorithm and is by no means a complete guide to the genetic algorithm topic.</p></blockquote><p>Having that said, let&#x27;s deep dive into more details...</p><h2 id="the-plan" style="position:relative">The Plan<a href="#the-plan" aria-label="the plan permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>Step-by-step we&#x27;re going to break down a high-level task of creating the self-parking car to the straightforward low-level optimization problem of finding the optimal combination of <code class="language-text">180</code> bits (finding the optimal car genome).</p><p>Here is what we&#x27;re going to do:</p><ol><li>üí™üèª Give the <strong>muscles</strong> (engine, steering wheel) to the car so that it could move towards the parking spot.</li><li>üëÄ Give the <strong>eyes</strong> (sensors) to the car so that it could see the obstacles around.</li><li>üß† Give the <strong>brain</strong> to the car that will control the muscles (movements) based on what the car sees (obstacles via sensors). The brain will be simply a pure function <code class="language-text">movements = f(sensors)</code>.</li><li>üß¨ <strong>Evolve the brain</strong> to do the right moves based on the sensors input. This is where we will apply a genetic algorithm. Generation after generation our brain function <code class="language-text">movements = f(sensors)</code> will learn how to move the car towards the parking spot.</li></ol><h2 id="giving-the-muscles-to-the-car" style="position:relative">Giving the muscles to the car<a href="#giving-the-muscles-to-the-car" aria-label="giving the muscles to the car permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>To be able to move, the car would need &quot;muscles&quot;. Let&#x27;s give the car two types of muscles:</p><ol><li><strong>Engine muscle</strong> - allows the car to move <em>‚Üì back</em>, <em>‚Üë forth</em>, or <em>‚óé stand steel</em> (neutral gear)</li><li><strong>Steering wheel muscle</strong> - allows the car to turn <em>‚Üê left</em>, <em>‚Üí right</em>, or <em>‚óé go straight</em> while moving</li></ol><p>With these two muscles the car can perform the following movements:</p><p><img src="/posts-assets/6c3cfbdf347d8fc8c84673dc3d24c2cc/03-car-muscles-01.gif" alt="Car movements achieved by car muscles"/></p><p>In our case, the muscles are receivers of the signals that come from the brain once every <code class="language-text">100ms</code> (milliseconds). Based on the value of the brain&#x27;s signal the muscles act differently. We&#x27;ll cover the &quot;brain&quot; part below, but for now, let&#x27;s say that our brain may send only 3 possible signals to each muscle: <code class="language-text">-1</code>, <code class="language-text">0</code>, or <code class="language-text">+1</code>.</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">MuscleSignal</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">;</span></code></pre></div><p>For example, the brain may send the signal with the value of <code class="language-text">+1</code> to the engine muscle and it will start moving the car forward. The signal <code class="language-text">-1</code> to the engine moves the car backward. At the same time, if the brain will send the signal of <code class="language-text">-1</code> to the steering wheel muscle, it will turn the car to the left, etc.</p><p>Here is how the brain signal values map to the muscle actions in our case:</p><table><thead><tr><th align="left">Muscle</th><th align="left"><code class="language-text">Signal = -1</code></th><th align="left"><code class="language-text">Signal = 0</code></th><th align="left"><code class="language-text">Signal = +1</code></th></tr></thead><tbody><tr><td align="left"><strong>Engine</strong></td><td align="left">‚Üì Backward</td><td align="left">‚óé Neutral</td><td align="left">‚Üë Forward</td></tr><tr><td align="left"><strong>Steering wheel</strong></td><td align="left">‚Üê Left</td><td align="left">‚óé Straight</td><td align="left">‚Üí Right</td></tr></tbody></table><blockquote><p>You may <a href="https://trekhleb.dev/self-parking-car-evolution?parking=manual#/">use the Evolution Simulator</a> and try to park the car manually to see how the car muscles work. Every time you press one of the <code class="language-text">WASD</code> keyboard keys (or use a touch-screen joystick) you send these <code class="language-text">-1</code>, <code class="language-text">0</code>, or <code class="language-text">+1</code> signals to the engine and steering wheel muscles.</p></blockquote><h2 id="giving-the-eyes-to-the-car" style="position:relative">Giving the eyes to the car<a href="#giving-the-eyes-to-the-car" aria-label="giving the eyes to the car permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>Before our car will learn how to do self-parking using its muscles, it needs to be able to &quot;see&quot; the surroundings. Let&#x27;s give it the <code class="language-text">8</code> eyes in a form of distance sensors:</p><ul><li>Each sensor can detect the obstacle in a distance range of <code class="language-text">0-4m</code> (meters).</li><li>Each sensor reports the latest information about the obstacles it &quot;sees&quot; to the car&#x27;s &quot;brain&quot; every <code class="language-text">100ms</code>.</li><li>Whenever the sensor doesn&#x27;t see any obstacles it reports the value of <code class="language-text">0</code>. On the contrary, if the value of the sensor is small but not zero (i.e. <code class="language-text">0.01m</code>) it would mean that the obstacle is close.</li></ul><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:32.4%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBP/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAAB3SOdhR//xAAaEAABBQEAAAAAAAAAAAAAAAABAAIREiEx/9oACAEBAAEFApFuJuj/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwFn/8QAFRABAQAAAAAAAAAAAAAAAAAAERD/2gAIAQEABj8CC//EABoQAQACAwEAAAAAAAAAAAAAAAEAETFBUZH/2gAIAQEAAT8hGeTsoKnkWip//9oADAMBAAIAAwAAABAML//EABgRAAIDAAAAAAAAAAAAAAAAAAABESEx/9oACAEDAQE/EE4oen//xAAWEQEBAQAAAAAAAAAAAAAAAAAAMQH/2gAIAQIBAT8Qlkf/xAAZEAEBAQEBAQAAAAAAAAAAAAABESEAMUH/2gAIAQEAAT8QGsmjBvO0hngDfnCKDUnf/9k=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Car sensors with distances" title="Car sensors with distances" src="/static/198b16f3c489034117947e8784844a99/a2510/04-sensors-01.jpg" srcSet="/static/198b16f3c489034117947e8784844a99/0479a/04-sensors-01.jpg 250w,/static/198b16f3c489034117947e8784844a99/41099/04-sensors-01.jpg 500w,/static/198b16f3c489034117947e8784844a99/a2510/04-sensors-01.jpg 1000w,/static/198b16f3c489034117947e8784844a99/c58a3/04-sensors-01.jpg 1500w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><blockquote><p>You may <a href="https://trekhleb.dev/self-parking-car-evolution?parking=manual#/">use the Evolution Simulator</a> and see how the color of each sensor changes based on how close the obstacle is.</p></blockquote><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Sensors</span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div><h2 id="giving-the-brain-to-the-car" style="position:relative">Giving the brain to the car<a href="#giving-the-brain-to-the-car" aria-label="giving the brain to the car permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>At this moment, our car can &quot;see&quot; and &quot;move&quot;, but there is no &quot;coordinator&quot;, that would transform the signals from the &quot;eyes&quot; to the proper movements of the &quot;muscles&quot;. We need to give the car a &quot;brain&quot;.</p><h3 id="brain-input" style="position:relative">Brain input<a href="#brain-input" aria-label="brain input permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>As an input from the sensors, every <code class="language-text">100ms</code> the brain will be getting <code class="language-text">8</code> float numbers, each one in range of <code class="language-text">[0...4]</code>. For example, the input might look like this:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> sensors<span class="token operator">:</span> Sensors <span class="token operator">=</span> <span class="token punctuation">[</span>s0<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s3<span class="token punctuation">,</span> s4<span class="token punctuation">,</span> s5<span class="token punctuation">,</span> s6<span class="token punctuation">,</span> s7<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// i.e. üß† ‚Üê [0, 0.5, 4, 0.002, 0, 3.76, 0, 1.245]</span></code></pre></div><h3 id="brain-output" style="position:relative">Brain output<a href="#brain-output" aria-label="brain output permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>Every <code class="language-text">100ms</code> the brain should produce two integers as an output:</p><ol><li>One number as a signal for the engine: <code class="language-text">engineSignal</code></li><li>One number as a signal for the steering wheel: <code class="language-text">wheelSignal</code></li></ol><p>Each number should be of the type <code class="language-text">MuscleSignal</code> and might take one of three values: <code class="language-text">-1</code>, <code class="language-text">0</code>, or <code class="language-text">+1</code>.</p><h3 id="brain-formulasfunctions" style="position:relative">Brain formulas/functions<a href="#brain-formulasfunctions" aria-label="brain formulasfunctions permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>Keeping in mind the brain&#x27;s input and output mentioned above we may say that the brain is just a function:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token punctuation">{</span> engineSignal<span class="token punctuation">,</span> wheelSignal <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">brainToMuscleSignal</span><span class="token punctuation">(</span>
  <span class="token function">brainFunction</span><span class="token punctuation">(</span>sensors<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// i.e. { engineSignal: 0, wheelSignal: -1 } ‚Üê üß† ‚Üê [0, 0.5, 4, 0.002, 0, 3.76, 0, 1.245]</span></code></pre></div><p>Where <code class="language-text">brainToMuscleSignal()</code> is a function that converts raw brain signals (any float number) to muscle signals (to  <code class="language-text">-1</code>, <code class="language-text">0</code>, or <code class="language-text">+1</code> number) so that muscles could understand it. We&#x27;ll implement this converter function below.</p><p>The main question now is what kind of a function the <code class="language-text">brainFunction()</code> is.</p><p>To make the car smarter and its movements to be more sophisticated we could go with a <a href="https://en.wikipedia.org/wiki/Multilayer_perceptron">Multilayer Perceptron</a>. The name is a bit scary but this is a simple Neural Network with a basic architecture (think of it as a big formula with many parameters/coefficients).</p><blockquote><p>I&#x27;ve covered Multilayer Perceptrons with a bit more details in my <a href="https://github.com/trekhleb/homemade-machine-learning#-multilayer-perceptron-mlp">homemade-machine-learning</a>, <a href="https://github.com/trekhleb/machine-learning-experiments#multilayer-perceptron-mlp-or-simple-neural-network-nn">machine-learning-experiments</a>, and <a href="https://github.com/trekhleb/nano-neuron">nano-neuron</a> projects. You may even challenge that simple network <a href="https://trekhleb.dev/machine-learning-experiments/#/experiments/DigitsRecognitionMLP">to recognize your written digits</a>.</p></blockquote><p>However, to avoid the introduction of a whole new concept of Neural Networks, we&#x27;ll go with a much simpler approach and we&#x27;ll use two <strong>Linear Polynomials</strong> with multiple variables (to be more precise, each polynomial will have exactly <code class="language-text">8</code> variables, since we have <code class="language-text">8</code> sensors) which will look something like this:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript">engineSignal <span class="token operator">=</span> <span class="token function">brainToMuscleSignal</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>e0 <span class="token operator">*</span> s0<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e1 <span class="token operator">*</span> s1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token operator">...</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e7 <span class="token operator">*</span> s7<span class="token punctuation">)</span> <span class="token operator">+</span> e8 <span class="token comment">// &lt;- brainFunction</span>
<span class="token punctuation">)</span>

wheelSignal <span class="token operator">=</span> <span class="token function">brainToMuscleSignal</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>w0 <span class="token operator">*</span> s0<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>w1 <span class="token operator">*</span> s1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token operator">...</span> <span class="token operator">+</span> <span class="token punctuation">(</span>w7 <span class="token operator">*</span> s7<span class="token punctuation">)</span> <span class="token operator">+</span> w8 <span class="token comment">// &lt;- brainFunction</span>
<span class="token punctuation">)</span></code></pre></div><p>Where:</p><ul><li><code class="language-text">[s0, s1, ..., s7]</code> - the <code class="language-text">8</code> variables, which are the <code class="language-text">8</code> sensor values. These are dynamic.</li><li><code class="language-text">[e0, e1, ..., e8]</code> - the <code class="language-text">9</code> coefficients for the engine polynomial. These the car will need to learn, and they will be static.</li><li><code class="language-text">[w0, w1, ..., w8]</code> - the <code class="language-text">9</code> coefficients for the steering wheel polynomial. These the car will need to learn, and they will be static</li></ul><p>The cost of using the simpler function for the brain will be that the car won&#x27;t be able to learn some sophisticated moves and also won&#x27;t be able to generalize well and adapt well to unknown surroundings. But for our particular parking lot and for the sake of demonstrating the work of a genetic algorithm it should still be enough.</p><p>We may implement the generic polynomial function in the following way:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Coefficients</span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Calculates the value of a linear polynomial based on the coefficients and variables.</span>
<span class="token keyword">const</span> linearPolynomial <span class="token operator">=</span> <span class="token punctuation">(</span>coefficients<span class="token operator">:</span> Coefficients<span class="token punctuation">,</span> variables<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>coefficients<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token punctuation">(</span>variables<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Incompatible number of polynomial coefficients and variables&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  coefficients<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>coefficient<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> coefficientIndex<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>coefficientIndex <span class="token operator">&lt;</span> variables<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">+=</span> coefficient <span class="token operator">*</span> variables<span class="token punctuation">[</span>coefficientIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// The last coefficient needs to be added up without multiplication.</span>
      result <span class="token operator">+=</span> coefficient
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>The car&#x27;s brain in this case will consist of two polynomials and will look like this:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> engineSignal<span class="token operator">:</span> MuscleSignal <span class="token operator">=</span> <span class="token function">brainToMuscleSignal</span><span class="token punctuation">(</span>
  <span class="token function">linearPolynomial</span><span class="token punctuation">(</span>engineCoefficients<span class="token punctuation">,</span> sensors<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> wheelSignal<span class="token operator">:</span> MuscleSignal <span class="token operator">=</span> <span class="token function">brainToMuscleSignal</span><span class="token punctuation">(</span>
  <span class="token function">linearPolynomial</span><span class="token punctuation">(</span>wheelCoefficients<span class="token punctuation">,</span> sensors<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>The output of a <code class="language-text">linearPolynomial()</code> function is a float number. The <code class="language-text">brainToMuscleSignal()</code> function need to convert the wide range of floats to three particular integers, and it will do it in two steps:</p><ol><li>Convert the float of a wide range (i.e. <code class="language-text">0.456</code> or <code class="language-text">3673.45</code> or <code class="language-text">-280</code>) to the float in a range of <code class="language-text">(0...1)</code> (i.e. <code class="language-text">0.05</code> or <code class="language-text">0.86</code>)</li><li>Convert the float in a range of <code class="language-text">(0...1)</code> to one of three integer values of <code class="language-text">-1</code>, <code class="language-text">0</code>, or <code class="language-text">+1</code>. For example, the floats that are close to <code class="language-text">0</code> will be converted to <code class="language-text">-1</code>, the floats that are close to <code class="language-text">0.5</code> will be converted to <code class="language-text">0</code>, and the floats that are close to <code class="language-text">1</code> will be converted to <code class="language-text">1</code>.</li></ol><p>To do the first part of the conversion we need to introduce a <a href="https://en.wikipedia.org/wiki/Sigmoid_function">Sigmoid Function</a> which implements the following formula:</p><p><img src="/posts-assets/e0b73cd456f76e894946be33d57233e5/05-sigmoid-01.svg" alt="Sigmoid formula"/></p><p>It converts the wide range of floats (the <code class="language-text">x</code> axis) to float numbers with a limited range of <code class="language-text">(0...1)</code> (the <code class="language-text">y</code> axis). This is exactly what we need.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:49.6%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3UlEQVQoz4WSVw6EMAxEc/+Tgui9k9WzNCgbYPdj5Njj7rht2/yyLB65rutN7vvum6bxfd9fNiH2JY8jQIEQT5Jk4zjeuOM4vnTgwg5jqept2/phGCwQDszzbDyF4ACFHVVwlDzP096SAEeSkmSapgvoYXHgMFAFUtUIJknXdSbLsrwS4q99aRp0OODquvZpmlpQkiQePc9zO0RVVZY0y7IrKfaiKMwPTj5IbI7R4lFjnc4ZUZwQrwu4sO2no+CkFbx9G8G+jU4fVwuPpGOEnYh77fDXt2E3/zrUd/oAUB4OVlCmibQAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Sigmoid graph" title="Sigmoid graph" src="/static/a75b6c7e13981513b7dbdfc328615e32/00d43/05-sigmoid-02.png" srcSet="/static/a75b6c7e13981513b7dbdfc328615e32/63868/05-sigmoid-02.png 250w,/static/a75b6c7e13981513b7dbdfc328615e32/0b533/05-sigmoid-02.png 500w,/static/a75b6c7e13981513b7dbdfc328615e32/00d43/05-sigmoid-02.png 1000w,/static/a75b6c7e13981513b7dbdfc328615e32/aa440/05-sigmoid-02.png 1500w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>Here is how the conversion steps would look on the Sigmoid graph.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:50.4%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1ElEQVQoz22SS2sUQRSF51e6c6+7CK4EQYKI/gHBjYiIS0Fw4UIkuDKgOBElvhDjJDqT6Vd1dVd1PT+5NckgaMPhdHXdvnXOPTXzwbPWx1TDSWFBM6yIMeK9J6VE3/eMoyEm8CEQCuK2RtbCsp4pW/FofoOH8+s8PtjlwbtrPPt0l5wohTF4tE2Yw6fk5xdJe1dILy6R9m+RvCHEVBpJrRw+C8EzWo2ZBtTYsNYnVPo31o2YaUQcdF2NWbwhHr3EHb3C/9jDHe8z6Y5hGDBmZBxHrLXMpGtOGXl8cIxOMboe6wfMpBmcoqp/otoaG8BMAeMSxieCtXiBWHauqJyJd6U6lFL0vaLta9btsnCjKtq+4td6gdYaN1m8dxvIHCfHNE34GAuXhtJouVxSVVVBr3rquinctg160KxOVzRNU8JRbUtdVXTrU4ZvX2hXS7TqaJq22J/lnMswz1kQU9ywxJrBGIM1Rl5J926Sr14g396BOzvk3cvkJ/eJQI5BQgk450rs/2NJUFzI6UGuydePhIPX+MM54fN7/Ie3hMV3XIgE7zcK5aeNon9Z9mU+kmD5BluI4iCq2Vwxqd0q/JvPL+u5wrbdzKfsuekMrihyEsaZGwnlD7GF+nHAmZTHAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Conversion steps on the graph" title="Conversion steps on the graph" src="/static/1c617102a51e3f8e0e6b919763c7f506/00d43/05-sigmoid-03.png" srcSet="/static/1c617102a51e3f8e0e6b919763c7f506/63868/05-sigmoid-03.png 250w,/static/1c617102a51e3f8e0e6b919763c7f506/0b533/05-sigmoid-03.png 500w,/static/1c617102a51e3f8e0e6b919763c7f506/00d43/05-sigmoid-03.png 1000w,/static/1c617102a51e3f8e0e6b919763c7f506/aa440/05-sigmoid-03.png 1500w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>The implementation of two conversion steps mentioned above would look like this:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Calculates the sigmoid value for a given number.</span>
<span class="token keyword">const</span> sigmoid <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token constant">E</span> <span class="token operator">**</span> <span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Converts sigmoid value (0...1) to the muscle signals (-1, 0, +1)</span>
<span class="token comment">// The margin parameter is a value between 0 and 0.5:</span>
<span class="token comment">// [0 ... (0.5 - margin) ... 0.5 ... (0.5 + margin) ... 1]</span>
<span class="token keyword">const</span> sigmoidToMuscleSignal <span class="token operator">=</span> <span class="token punctuation">(</span>sigmoidValue<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> margin<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token operator">:</span> MuscleSignal <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token generic-function"><span class="token function">sigmoidValue</span> <span class="token generic class-name"><span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">-</span> margin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sigmoidValue <span class="token operator">&gt;</span></span></span> <span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">+</span> margin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Converts raw brain signal to the muscle signal.</span>
<span class="token keyword">const</span> brainToMuscleSignal <span class="token operator">=</span> <span class="token punctuation">(</span>rawBrainSignal<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> MuscleSignal <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> normalizedBrainSignal <span class="token operator">=</span> <span class="token function">sigmoid</span><span class="token punctuation">(</span>rawBrainSignal<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">sigmoidToMuscleSignal</span><span class="token punctuation">(</span>normalizedBrainSignal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h2 id="cars-genome-dna" style="position:relative">Car&#x27;s genome (DNA)<a href="#cars-genome-dna" aria-label="cars genome dna permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><blockquote><p>‚òùüèª The main conclusion from the &quot;Eyes&quot;, &quot;Muscles&quot; and &quot;Brain&quot; sections above should be this: the coefficients <code class="language-text">[e0, e1, ..., e8]</code> and <code class="language-text">[w0, w1, ..., w8]</code> defines the behavior of the car. These <code class="language-text">18</code> numbers together form the unique car&#x27;s Genome (or car&#x27;s DNA).</p></blockquote><h3 id="car-genome-in-a-decimal-form" style="position:relative">Car genome in a decimal form<a href="#car-genome-in-a-decimal-form" aria-label="car genome in a decimal form permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>Let&#x27;s join the <code class="language-text">[e0, e1, ..., e8]</code> and <code class="language-text">[w0, w1, ..., w8]</code> brain coefficients together to form a car&#x27;s genome in a decimal form:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Car genome as a list of decimal numbers (coefficients).</span>
<span class="token keyword">const</span> carGenomeBase10 <span class="token operator">=</span> <span class="token punctuation">[</span>e0<span class="token punctuation">,</span> e1<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> e8<span class="token punctuation">,</span> w0<span class="token punctuation">,</span> w1<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> w8<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// i.e. carGenomeBase10 = [17.5, 0.059, -46, 25, 156, -0.085, -0.207, -0.546, 0.071, -58, 41, 0.011, 252, -3.5, -0.017, 1.532, -360, 0.157]</span></code></pre></div><h3 id="car-genome-in-a-binary-form" style="position:relative">Car genome in a binary form<a href="#car-genome-in-a-binary-form" aria-label="car genome in a binary form permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>Let&#x27;s move one step deeper (to the level of the genes) and convert the decimal numbers of the car&#x27;s genome to the binary format (to the plain <code class="language-text">1</code>s and <code class="language-text">0</code>s).</p><blockquote><p>I&#x27;ve described in the detail the process of converting the floating-point numbers to binary numbers in the <a href="https://trekhleb.dev/blog/2021/binary-floating-point/">Binary representation of the floating-point numbers</a> article. You might want to check it out if the code in this section is not clear.</p></blockquote><p>Here is a quick example of how the floating-point number may be converted to the <code class="language-text">16 bits</code> binary number (again, feel free to <a href="https://trekhleb.dev/blog/2021/binary-floating-point/">read this first</a> if the example is confusing):</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:70.4%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2klEQVQoz21SWW4bMQyd+x+muUBzg/wEMAKkTr1MOnZmPLsWSlwLJY5ToKHeByXx8ZGiKvoy3O/3z8/P2+22aZqf9/c/7u5UDZHWdWVm+88qJLptmBgRc85EiDlhTmaqqohI/4R9kSUExuRgWOMlkRczNUM2DzoHdWAsJlpgH5lUb06VYqAMkGKIPmMmKeWpWcrZ+cjywTER+0aZAWJcPEwhLTEtLqbZkwf2UTywix8QYkXM5/O567q2bQ+Hw+Vyqcz54NvOvfTuMMdm9HC8WLdoM1rd62nU02jNaAHYu3X3e9e27dPT08PDw36/r0xUlUVYVVhRVIktoYVsgBZzQUhG/F3ZJiJCLJkkEyeWrCpaXsQyFSZgQXoHXzvXG1khryHPxDlzRAaSxIKqJGo+XZUdFH+FkhGwnCC/Kyf0gGtChwyALhMgp5KIgIUy2RoLU7UoF+h1fpWZMiXihJxECAlEiARFmEs75W+wmOqtYP0ct1Z2vSzrM7Q8nhmbya29b60iZj9NKUI/tosf5nl52f6aHA7OLou9TXYa7TzKNC8A8Xg8vr6+7na7x8fHuq4rxBxCiDHO0wwAfT907du4YrdYvxbyn9GagYdhDCHUdT0MfV3Xm83mdDr9BWJsK0cx3K4CAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Example of floating to binary numbers conversion" title="Example of floating to binary numbers conversion" src="/static/37c26c34af1206980a09f87cf666e045/00d43/06-floating-point-conversion-01.png" srcSet="/static/37c26c34af1206980a09f87cf666e045/63868/06-floating-point-conversion-01.png 250w,/static/37c26c34af1206980a09f87cf666e045/0b533/06-floating-point-conversion-01.png 500w,/static/37c26c34af1206980a09f87cf666e045/00d43/06-floating-point-conversion-01.png 1000w,/static/37c26c34af1206980a09f87cf666e045/aa440/06-floating-point-conversion-01.png 1500w,/static/37c26c34af1206980a09f87cf666e045/e8950/06-floating-point-conversion-01.png 2000w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>In our case, to reduce the genome length, we will convert each floating coefficient to the non-standard <code class="language-text">10 bits</code> binary number (<code class="language-text">1</code> sign bit, <code class="language-text">4</code> exponent bits, <code class="language-text">5</code> fraction bits).</p><p>We have <code class="language-text">18</code> coefficients in total, every coefficient will be converted to <code class="language-text">10</code> bits number. It means that the car&#x27;s genome will be an array of <code class="language-text">0</code>s and <code class="language-text">1</code>s with a length of <code class="language-text">18 * 10 = 180 bits</code>.</p><p>For example, for the genome in a decimal format that was mentioned above, its binary representation would look like this:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Gene</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Genome</span> <span class="token operator">=</span> Gene<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> genome<span class="token operator">:</span> Genome <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// Engine coefficients.</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 17.5</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 0.059</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- -46</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 25</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 156</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- -0.085</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- -0.207</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- -0.546</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 0.071</span>

  <span class="token comment">// Wheels coefficients.</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- -58</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 41</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 0.011</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 252</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- -3.5</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- -0.017</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 1.532</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- -360</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 0.157</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div><p>Oh my! The binary genome looks so cryptic. But can you imagine, that these <code class="language-text">180</code> zeroes and ones alone define how the car behaves in the parking lot! It&#x27;s like you hacked someone&#x27;s DNA and know what each gene means exactly. Amazing!</p><p>By the way, you may see the exact values of genomes and coefficients for the best performing car on the <a href="https://trekhleb.dev/self-parking-car-evolution?parking=evolution#/">Evolution Simulator</a> dashboard:</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:40.400000000000006%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwElEQVQoz52R6wrDIAyFff+3HNsK09bLvNuWMyKkyGAX+uMzR9TkmIhFayzThHy/IuaMGCNSSj2eQdDirUW0FillpCEhxZxzj6x5z/od4b1HoMe1HcnGhLXWTmvtYNyPuieUUuIhJdL1gkQuB0dnECEEdJfOgTTDPeHq27Z9Zd/37lZoraHmGUZJWGNgBuiMNRX5Z1iCLiulEKcbSoyotaGU0uHKFNd1/Qm9Ec45WGth3PNwxbA7agl9hwt9gobyAtS6a6R+5ZjqAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Car genomes and coefficients examples" title="Car genomes and coefficients examples" src="/static/54aadfc43059bd9be9ac8b02581e6998/00d43/06-genome-examples.png" srcSet="/static/54aadfc43059bd9be9ac8b02581e6998/63868/06-genome-examples.png 250w,/static/54aadfc43059bd9be9ac8b02581e6998/0b533/06-genome-examples.png 500w,/static/54aadfc43059bd9be9ac8b02581e6998/00d43/06-genome-examples.png 1000w,/static/54aadfc43059bd9be9ac8b02581e6998/aa440/06-genome-examples.png 1500w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>Here is the source code that performs the conversion from binary to decimal format for the floating-point numbers (the brain will need it to decode the genome and to produce the muscle signals based on the genome data):</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Bit</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Bits</span> <span class="token operator">=</span> Bit<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">PrecisionConfig</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  signBitsCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  exponentBitsCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  fractionBitsCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  totalBitsCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">PrecisionConfigs</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  custom<span class="token operator">:</span> PrecisionConfig<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> precisionConfigs<span class="token operator">:</span> PrecisionConfigs <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// Custom-made 10-bits precision for faster evolution progress.</span>
  custom<span class="token operator">:</span> <span class="token punctuation">{</span>
    signBitsCount<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    exponentBitsCount<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    fractionBitsCount<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    totalBitsCount<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Converts the binary representation of the floating-point number to decimal float number.</span>
<span class="token keyword">function</span> <span class="token function">bitsToFloat</span><span class="token punctuation">(</span>bits<span class="token operator">:</span> Bits<span class="token punctuation">,</span> precisionConfig<span class="token operator">:</span> PrecisionConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> signBitsCount<span class="token punctuation">,</span> exponentBitsCount <span class="token punctuation">}</span> <span class="token operator">=</span> precisionConfig<span class="token punctuation">;</span>

  <span class="token comment">// Figuring out the sign.</span>
  <span class="token keyword">const</span> sign <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">**</span> bits<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// -1^1 = -1, -1^0 = 1</span>

  <span class="token comment">// Calculating the exponent value.</span>
  <span class="token keyword">const</span> exponentBias <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token punctuation">(</span>exponentBitsCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> exponentBits <span class="token operator">=</span> bits<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>signBitsCount<span class="token punctuation">,</span> signBitsCount <span class="token operator">+</span> exponentBitsCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> exponentUnbiased <span class="token operator">=</span> exponentBits<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>exponentSoFar<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> currentBit<span class="token operator">:</span> Bit<span class="token punctuation">,</span> bitIndex<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> bitPowerOfTwo <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token punctuation">(</span>exponentBitsCount <span class="token operator">-</span> bitIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> exponentSoFar <span class="token operator">+</span> currentBit <span class="token operator">*</span> bitPowerOfTwo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> exponent <span class="token operator">=</span> exponentUnbiased <span class="token operator">-</span> exponentBias<span class="token punctuation">;</span>

  <span class="token comment">// Calculating the fraction value.</span>
  <span class="token keyword">const</span> fractionBits <span class="token operator">=</span> bits<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>signBitsCount <span class="token operator">+</span> exponentBitsCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fraction <span class="token operator">=</span> fractionBits<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>fractionSoFar<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> currentBit<span class="token operator">:</span> Bit<span class="token punctuation">,</span> bitIndex<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> bitPowerOfTwo <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token operator">-</span><span class="token punctuation">(</span>bitIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> fractionSoFar <span class="token operator">+</span> currentBit <span class="token operator">*</span> bitPowerOfTwo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Putting all parts together to calculate the final number.</span>
  <span class="token keyword">return</span> sign <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">**</span> exponent<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> fraction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Converts the 8-bit binary representation of the floating-point number to decimal float number.</span>
<span class="token keyword">function</span> <span class="token function">bitsToFloat10</span><span class="token punctuation">(</span>bits<span class="token operator">:</span> Bits<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">bitsToFloat</span><span class="token punctuation">(</span>bits<span class="token punctuation">,</span> precisionConfigs<span class="token punctuation">.</span>custom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h3 id="brain-function-working-with-binary-genome" style="position:relative">Brain function working with binary genome<a href="#brain-function-working-with-binary-genome" aria-label="brain function working with binary genome permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>Previously our brain function was working with the decimal form of <code class="language-text">engineCoefficients</code> and <code class="language-text">wheelCoefficients</code> polynomial coefficients directly. However, these coefficients are now encoded in the binary form of a genome. Let&#x27;s add a <code class="language-text">decodeGenome()</code> function that will extract coefficients from the genome and let&#x27;s rewrite our brain functions:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Car has 16 distance sensors.</span>
<span class="token keyword">const</span> <span class="token constant">CAR_SENSORS_NUM</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

<span class="token comment">// Additional formula coefficient that is not connected to a sensor.</span>
<span class="token keyword">const</span> <span class="token constant">BIAS_UNITS</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// How many genes do we need to encode each numeric parameter for the formulas.</span>
<span class="token keyword">const</span> <span class="token constant">GENES_PER_NUMBER</span> <span class="token operator">=</span> precisionConfigs<span class="token punctuation">.</span>custom<span class="token punctuation">.</span>totalBitsCount<span class="token punctuation">;</span>

<span class="token comment">// Based on 8 distance sensors we need to provide two formulas that would define car&#x27;s behavior:</span>
<span class="token comment">// 1. Engine formula (input: 8 sensors; output: -1 (backward), 0 (neutral), +1 (forward))</span>
<span class="token comment">// 2. Wheels formula (input: 8 sensors; output: -1 (left), 0 (straight), +1 (right))</span>
<span class="token keyword">const</span> <span class="token constant">ENGINE_FORMULA_GENES_NUM</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">CAR_SENSORS_NUM</span> <span class="token operator">+</span> <span class="token constant">BIAS_UNITS</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">GENES_PER_NUMBER</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">WHEELS_FORMULA_GENES_NUM</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">CAR_SENSORS_NUM</span> <span class="token operator">+</span> <span class="token constant">BIAS_UNITS</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">GENES_PER_NUMBER</span><span class="token punctuation">;</span>

<span class="token comment">// The length of the binary genome of the car.</span>
<span class="token keyword">const</span> <span class="token constant">GENOME_LENGTH</span> <span class="token operator">=</span> <span class="token constant">ENGINE_FORMULA_GENES_NUM</span> <span class="token operator">+</span> <span class="token constant">WHEELS_FORMULA_GENES_NUM</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">DecodedGenome</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  engineFormulaCoefficients<span class="token operator">:</span> Coefficients<span class="token punctuation">,</span>
  wheelsFormulaCoefficients<span class="token operator">:</span> Coefficients<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Converts the genome from a binary form to the decimal form.</span>
<span class="token keyword">const</span> genomeToNumbers <span class="token operator">=</span> <span class="token punctuation">(</span>genome<span class="token operator">:</span> Genome<span class="token punctuation">,</span> genesPerNumber<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>genome<span class="token punctuation">.</span>length <span class="token operator">%</span> genesPerNumber <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Wrong number of genes in the numbers genome&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> numbers<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> numberIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> numberIndex <span class="token operator">&lt;</span> genome<span class="token punctuation">.</span>length<span class="token punctuation">;</span> numberIndex <span class="token operator">+=</span> genesPerNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token function">bitsToFloat10</span><span class="token punctuation">(</span>genome<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>numberIndex<span class="token punctuation">,</span> numberIndex <span class="token operator">+</span> genesPerNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    numbers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> numbers<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Converts the genome from a binary form to the decimal form</span>
<span class="token comment">// and splits the genome into two sets of coefficients (one set for each muscle).</span>
<span class="token keyword">const</span> decodeGenome <span class="token operator">=</span> <span class="token punctuation">(</span>genome<span class="token operator">:</span> Genome<span class="token punctuation">)</span><span class="token operator">:</span> DecodedGenome <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> engineGenes<span class="token operator">:</span> Gene<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> genome<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">ENGINE_FORMULA_GENES_NUM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wheelsGenes<span class="token operator">:</span> Gene<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> genome<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>
    <span class="token constant">ENGINE_FORMULA_GENES_NUM</span><span class="token punctuation">,</span>
    <span class="token constant">ENGINE_FORMULA_GENES_NUM</span> <span class="token operator">+</span> <span class="token constant">WHEELS_FORMULA_GENES_NUM</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> engineFormulaCoefficients<span class="token operator">:</span> Coefficients <span class="token operator">=</span> <span class="token function">genomeToNumbers</span><span class="token punctuation">(</span>engineGenes<span class="token punctuation">,</span> <span class="token constant">GENES_PER_NUMBER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wheelsFormulaCoefficients<span class="token operator">:</span> Coefficients <span class="token operator">=</span> <span class="token function">genomeToNumbers</span><span class="token punctuation">(</span>wheelsGenes<span class="token punctuation">,</span> <span class="token constant">GENES_PER_NUMBER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    engineFormulaCoefficients<span class="token punctuation">,</span>
    wheelsFormulaCoefficients<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Update brain function for the engine muscle.</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> getEngineMuscleSignal <span class="token operator">=</span> <span class="token punctuation">(</span>genome<span class="token operator">:</span> Genome<span class="token punctuation">,</span> sensors<span class="token operator">:</span> Sensors<span class="token punctuation">)</span><span class="token operator">:</span> MuscleSignal <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>engineFormulaCoefficients<span class="token operator">:</span> coefficients<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">decodeGenome</span><span class="token punctuation">(</span>genome<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> rawBrainSignal <span class="token operator">=</span> <span class="token function">linearPolynomial</span><span class="token punctuation">(</span>coefficients<span class="token punctuation">,</span> sensors<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">brainToMuscleSignal</span><span class="token punctuation">(</span>rawBrainSignal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Update brain function for the wheels muscle.</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> getWheelsMuscleSignal <span class="token operator">=</span> <span class="token punctuation">(</span>genome<span class="token operator">:</span> Genome<span class="token punctuation">,</span> sensors<span class="token operator">:</span> Sensors<span class="token punctuation">)</span><span class="token operator">:</span> MuscleSignal <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>wheelsFormulaCoefficients<span class="token operator">:</span> coefficients<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">decodeGenome</span><span class="token punctuation">(</span>genome<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> rawBrainSignal <span class="token operator">=</span> <span class="token function">linearPolynomial</span><span class="token punctuation">(</span>coefficients<span class="token punctuation">,</span> sensors<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">brainToMuscleSignal</span><span class="token punctuation">(</span>rawBrainSignal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><h2 id="self-driving-car-problem-statement" style="position:relative">Self-driving car problem statement<a href="#self-driving-car-problem-statement" aria-label="self driving car problem statement permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><blockquote><p>‚òùüèª So, finally, we&#x27;ve got to the point when the high-level problem of making the car to be a self-parking car is broken down to the straightforward optimization problem of finding the optimal combination of <code class="language-text">180</code> ones and zeros (finding the &quot;good enough&quot; car&#x27;s genome). Sounds simple, doesn&#x27;t it?</p></blockquote><h3 id="naive-approach" style="position:relative">Naive approach<a href="#naive-approach" aria-label="naive approach permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>We could approach the problem of finding the &quot;good enough&quot; genome in a naive way and try out all possible combinations of genes:</p><ol><li><code class="language-text">[0, ..., 0, 0]</code>, and then...</li><li><code class="language-text">[0, ..., 0, 1]</code>, and then...</li><li><code class="language-text">[0, ..., 1, 0]</code>, and then...</li><li><code class="language-text">[0, ..., 1, 1]</code>, and then...</li><li>...</li></ol><p>But, let&#x27;s do some math. With <code class="language-text">180</code> bits and with each bit being equal either to <code class="language-text">0</code> or to <code class="language-text">1</code> we would have <code class="language-text">2^180</code> (or <code class="language-text">1.53 * 10^54</code>) possible combinations. Let&#x27;s say we would need to give <code class="language-text">15s</code> to each car to see if it will park successfully or not. Let&#x27;s also say that we may run a simulation for <code class="language-text">10</code> cars at once. Then we would need <code class="language-text">15 * (1.53 * 10^54) / 10 = 2.29 * 10^54 [seconds]</code> which is <code class="language-text">7.36 * 10^46 [years]</code>. Pretty long waiting time. Just as a side thought, it is only <code class="language-text">2.021 * 10^3 [years]</code> that have passed after Christ was born.</p><h3 id="genetic-approach" style="position:relative">Genetic approach<a href="#genetic-approach" aria-label="genetic approach permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>We need a faster algorithm to find the optimal value of the genome. This is where the genetic algorithm comes to the rescue. We might not find the best value of the genome, but there is a chance that we may find the optimal value of it. And, what is, more importantly, we don&#x27;t need to wait that long. With the <a href="https://trekhleb.dev/self-parking-car-evolution">Evolution Simulator</a> I was able to find a pretty good genome within <code class="language-text">24 [hours]</code>.</p><h2 id="genetic-algorithm-basics" style="position:relative">Genetic algorithm basics<a href="#genetic-algorithm-basics" aria-label="genetic algorithm basics permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>A <a href="https://en.wikipedia.org/wiki/Genetic_algorithm">genetic algorithms</a> (GA) inspired by the process of natural selection, and are commonly used to generate high-quality solutions to optimization problems by relying on biologically inspired operators such as <em>crossover</em>, <em>mutation</em> and <em>selection</em>.</p><p>The problem of finding the &quot;good enough&quot; combination of genes for the car looks like an optimization problem, so there is a good chance that GA will help us here.</p><p>We&#x27;re not going to cover a genetic algorithm in all details, but on a high level here are the basic steps that we will need to do:</p><ol><li><strong>CREATE</strong> ‚Äì the very first generation of cars <a href="https://en.wikipedia.org/wiki/Laws_of_thermodynamics">can&#x27;t come out of nothing</a>, so we will generate a set of random car genomes (set of binary arrays with the length of <code class="language-text">180</code>) at the very beginning. For example, we may create <code class="language-text">~1000</code> cars. With a bigger population the chances to find the optimal solution (and to find it faster) increase.</li><li><strong>SELECT</strong> - we will need to select the fittest individuums out of the current generation for further mating (see the next step). The fitness of each individuum will be defined based on the fitness function, which in our case, will show how close the car approached the target parking spot. The closer the car to the parking spot, the fitter it is.</li><li><strong>MATE</strong> ‚Äì simply saying we will allow the selected <em>&quot;‚ôÇ father-cars&quot;</em> to have <em>&quot;sex&quot;</em> with the selected <em>&quot;‚ôÄ mother-cars&quot;</em> so that their genomes could mix in a <code class="language-text">~50/50</code> proportion and produce <em>&quot;‚ôÇ‚ôÄ children-cars&quot;</em> genomes. The idea is that the children cars might get better (or worse) in self-parking, by taking the best (or the worst) bits from their parents.</li><li><strong>MUTATE</strong> - during the mating process some genes may randomly mutate (<code class="language-text">1</code>s and <code class="language-text">0</code>s in child genome may flip). This may bring a wider variety of children genomes and, thus, a wider variety of children cars behavior. Imagine that the 1st bit was accidentally set to <code class="language-text">0</code> for all <code class="language-text">~1000</code> cars. The only way to try the car with the 1st bit being set to <code class="language-text">1</code> is through the random mutations. At the same time, extensive mutations may ruin healthy genomes.</li><li>Go to &quot;Step 2&quot; unless the number of generations has reached the limit (i.e. <code class="language-text">100</code> generations have passed) or unless the top-performing individuums have reached the expected fitness function value (i.e. the best car has approached the parking spot closer than <code class="language-text">1 meter</code>). Otherwise, quit.</li></ol><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:20.4%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA30lEQVQY002Pu07DQBBF/an8CN9BwR8gOkRFkCVKoKAjCaRAwk4cP5PYOzu76z3IDkWOdIpb3NGdBLgCBs5E74kiDmstVnTWGMHKlB0igqoixjAaM3f+HYGbxPWiQ96gnYkhCFW1ZhgyVIX2tKc9FVg1HPqa+pDTmyPee5bLJd+bDepkMqqeRyT9asf2/p3u7Tcejhu2+W2sqjvKKmO1e+Fz+zwf/cpf+fh5IKvWlPuaxeKJNE3puhZrhbIsY1EUJGLMdXD+Yvo4rw8hoE5xsw7nJ895omka2rbl4t2Jxz/BHC/XRQBwiQAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Genetic algorithm flow" title="Genetic algorithm flow" src="/static/983b27180208af55ca432cae58db4a19/00d43/07-genetic-algorithm-flow-01.png" srcSet="/static/983b27180208af55ca432cae58db4a19/63868/07-genetic-algorithm-flow-01.png 250w,/static/983b27180208af55ca432cae58db4a19/0b533/07-genetic-algorithm-flow-01.png 500w,/static/983b27180208af55ca432cae58db4a19/00d43/07-genetic-algorithm-flow-01.png 1000w,/static/983b27180208af55ca432cae58db4a19/aa440/07-genetic-algorithm-flow-01.png 1500w,/static/983b27180208af55ca432cae58db4a19/e8950/07-genetic-algorithm-flow-01.png 2000w,/static/983b27180208af55ca432cae58db4a19/66900/07-genetic-algorithm-flow-01.png 2630w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><h2 id="evolving-the-cars-brain-using-a-genetic-algorithm" style="position:relative">Evolving the car&#x27;s brain using a Genetic Algorithm<a href="#evolving-the-cars-brain-using-a-genetic-algorithm" aria-label="evolving the cars brain using a genetic algorithm permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>Before launching the genetic algorithm let&#x27;s go and create the functions for the &quot;CREATE&quot;, &quot;SELECT&quot;, &quot;MATE&quot; and &quot;MUTATE&quot; steps of the algorithm.</p><h3 id="functions-for-the-create-step" style="position:relative">Functions for the CREATE step<a href="#functions-for-the-create-step" aria-label="functions for the create step permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>The <code class="language-text">createGeneration()</code> function will create an array of random genomes (a.k.a. population or generation) and will accept two parameters:</p><ul><li><code class="language-text">generationSize</code> - defines the size of the generation. This generation size will be preserved from generation to generation.</li><li><code class="language-text">genomeLength</code> - defines the genome length of each individuum in the cars population. In our case, the length of the genome will be <code class="language-text">180</code>.</li></ul><p>There is a <code class="language-text">50/50</code> chance for each gene of a genome to be either <code class="language-text">0</code> or <code class="language-text">1</code>.</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Generation</span> <span class="token operator">=</span> Genome<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">GenerationParams</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  generationSize<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  genomeLength<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createGenome</span><span class="token punctuation">(</span>length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> Genome <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">(</span>length<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createGeneration</span><span class="token punctuation">(</span>params<span class="token operator">:</span> GenerationParams<span class="token punctuation">)</span><span class="token operator">:</span> Generation <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> generationSize<span class="token punctuation">,</span> genomeLength <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">(</span>generationSize<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">createGenome</span><span class="token punctuation">(</span>genomeLength<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h3 id="functions-for-the-mutate-step" style="position:relative">Functions for the MUTATE step<a href="#functions-for-the-mutate-step" aria-label="functions for the mutate step permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>The <code class="language-text">mutate()</code> function will mutate some genes randomly based on the <code class="language-text">mutationProbability</code> value.</p><p>For example, if the <code class="language-text">mutationProbability = 0.1</code> then there is a <code class="language-text">10%</code> chance for each genome to be mutated. Let&#x27;s say if we would have a genome of length <code class="language-text">10</code> that looks like <code class="language-text">[0, 0, 0, 0, 0, 0 ,0 ,0 ,0 ,0]</code>, then after the mutation, there will be a chance that 1 gene will be mutated and we may get a genome that might look like <code class="language-text">[0, 0, 0, 1, 0, 0 ,0 ,0 ,0 ,0]</code>.</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// The number between 0 and 1.</span>
<span class="token keyword">type</span> <span class="token class-name">Probability</span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

<span class="token comment">// @see: https://en.wikipedia.org/wiki/Mutation_(genetic_algorithm)</span>
<span class="token keyword">function</span> <span class="token function">mutate</span><span class="token punctuation">(</span>genome<span class="token operator">:</span> Genome<span class="token punctuation">,</span> mutationProbability<span class="token operator">:</span> Probability<span class="token punctuation">)</span><span class="token operator">:</span> Genome <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> geneIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> geneIndex <span class="token operator">&lt;</span> genome<span class="token punctuation">.</span>length<span class="token punctuation">;</span> geneIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> gene<span class="token operator">:</span> Gene <span class="token operator">=</span> genome<span class="token punctuation">[</span>geneIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> mutatedGene<span class="token operator">:</span> Gene <span class="token operator">=</span> gene <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    genome<span class="token punctuation">[</span>geneIndex<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> mutationProbability <span class="token operator">?</span> mutatedGene <span class="token operator">:</span> gene<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> genome<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h3 id="functions-for-the-mate-step" style="position:relative">Functions for the MATE step<a href="#functions-for-the-mate-step" aria-label="functions for the mate step permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>The <code class="language-text">mate()</code> function will accept the <code class="language-text">father</code> and the <code class="language-text">mother</code> genomes and will produce two children. We will imitate the real-world scenario and also do the mutation during the mating.</p><p>Each bit of the child genome will be defined based on the values of the correspondent bit of the father&#x27;s or mother&#x27;s genomes. There is a <code class="language-text">50/50%</code> probability that the child will inherit the bit of the father or the mother. For example, let&#x27;s say we have genomes of length <code class="language-text">4</code> (for simplicity reasons):</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Father&#x27;s genome: [0, 0, 1, 1]
Mother&#x27;s genome: [0, 1, 0, 1]
                  ‚Üì  ‚Üì  ‚Üì  ‚Üì
Possible kid #1: [0, 1, 1, 1]
Possible kid #2: [0, 0, 1, 1]</code></pre></div><p>In the example above the mutation were not taken into account.</p><p>Here is the function implementation:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Performs Uniform Crossover: each bit is chosen from either parent with equal probability.</span>
<span class="token comment">// @see: https://en.wikipedia.org/wiki/Crossover_(genetic_algorithm)</span>
<span class="token keyword">function</span> <span class="token function">mate</span><span class="token punctuation">(</span>
  father<span class="token operator">:</span> Genome<span class="token punctuation">,</span>
  mother<span class="token operator">:</span> Genome<span class="token punctuation">,</span>
  mutationProbability<span class="token operator">:</span> Probability<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span>Genome<span class="token punctuation">,</span> Genome<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>father<span class="token punctuation">.</span>length <span class="token operator">!==</span> mother<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Cannot mate different species&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> firstChild<span class="token operator">:</span> Genome <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> secondChild<span class="token operator">:</span> Genome <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// Conceive children.</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> geneIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> geneIndex <span class="token operator">&lt;</span> father<span class="token punctuation">.</span>length<span class="token punctuation">;</span> geneIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    firstChild<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> father<span class="token punctuation">[</span>geneIndex<span class="token punctuation">]</span> <span class="token operator">:</span> mother<span class="token punctuation">[</span>geneIndex<span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    secondChild<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> father<span class="token punctuation">[</span>geneIndex<span class="token punctuation">]</span> <span class="token operator">:</span> mother<span class="token punctuation">[</span>geneIndex<span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token function">mutate</span><span class="token punctuation">(</span>firstChild<span class="token punctuation">,</span> mutationProbability<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">mutate</span><span class="token punctuation">(</span>secondChild<span class="token punctuation">,</span> mutationProbability<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h3 id="functions-for-the-select-step" style="position:relative">Functions for the SELECT step<a href="#functions-for-the-select-step" aria-label="functions for the select step permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>To select the fittest individuums for further mating we need a way to find out the fitness of each genome. To do this we will use a so-called fitness function.</p><p>The fitness function is always related to the particular task that we try to solve, and it is not generic. In our case, the fitness function will measure the distance between the car and the parking spot. The closer the car to the parking spot, the fitter it is. We will implement the fitness function a bit later, but for now, let&#x27;s introduce the interface for it:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">FitnessFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span>genome<span class="token operator">:</span> Genome<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span><span class="token punctuation">;</span></code></pre></div><p>Now, let&#x27;s say we have fitness values for each individuum in the population. Let&#x27;s also say that we sorted all individuums by their fitness values so that the first individuums are the strongest ones. How should we select the fathers and the mothers from this array? We need to do the selection in a way, that the higher the fitness value of the individuum, the higher the chances of this individuum being selected for mating. The <code class="language-text">weightedRandom()</code> function will help us with this.</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Picks the random item based on its weight.</span>
<span class="token comment">// The items with a higher weight will be picked more often.</span>
<span class="token keyword">const</span> weightedRandom <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>items<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> weights<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span> item<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> index<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>items<span class="token punctuation">.</span>length <span class="token operator">!==</span> weights<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Items and weights must be of the same size&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Preparing the cumulative weights array.</span>
  <span class="token comment">// For example:</span>
  <span class="token comment">// - weights = [1, 4, 3]</span>
  <span class="token comment">// - cumulativeWeights = [1, 5, 8]</span>
  <span class="token keyword">const</span> cumulativeWeights<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> weights<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cumulativeWeights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> weights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>cumulativeWeights<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Getting the random number in a range [0...sum(weights)]</span>
  <span class="token comment">// For example:</span>
  <span class="token comment">// - weights = [1, 4, 3]</span>
  <span class="token comment">// - maxCumulativeWeight = 8</span>
  <span class="token comment">// - range for the random number is [0...8]</span>
  <span class="token keyword">const</span> maxCumulativeWeight <span class="token operator">=</span> cumulativeWeights<span class="token punctuation">[</span>cumulativeWeights<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> randomNumber <span class="token operator">=</span> maxCumulativeWeight <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Picking the random item based on its weight.</span>
  <span class="token comment">// The items with higher weight will be picked more often.</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cumulativeWeights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> randomNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        item<span class="token operator">:</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
        index<span class="token operator">:</span> i<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    item<span class="token operator">:</span> items<span class="token punctuation">[</span>items<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    index<span class="token operator">:</span> items<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>The usage of this function is pretty straightforward. Let&#x27;s say you really like bananas and want to eat them more often than strawberries. Then you may call <code class="language-text">const fruit = weightedRandom([&#x27;banana&#x27;, &#x27;strawberry&#x27;], [9, 1])</code>, and in <code class="language-text">‚âà9</code> out of <code class="language-text">10</code> cases the <code class="language-text">fruit</code> variable will be equal to <code class="language-text">banana</code>, and only in <code class="language-text">‚âà1</code> out of <code class="language-text">10</code> times it will be equal to <code class="language-text">strawberry</code>.</p><p>To avoid losing the best individuums (let&#x27;s call them champions) during the mating process we may also introduce a so-called <code class="language-text">longLivingChampionsPercentage</code> parameter. For example, if the <code class="language-text">longLivingChampionsPercentage = 10</code>, then <code class="language-text">10%</code> of the best cars from the previous population will be carried over to the new generation. You may think about it as there are some long-living individuums that can live a long life and see their children and even grandchildren.</p><p>Here is the actual implementation of the <code class="language-text">select()</code> function:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// The number between 0 and 100.</span>
<span class="token keyword">type</span> <span class="token class-name">Percentage</span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">SelectionOptions</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  mutationProbability<span class="token operator">:</span> Probability<span class="token punctuation">,</span>
  longLivingChampionsPercentage<span class="token operator">:</span> Percentage<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// @see: https://en.wikipedia.org/wiki/Selection_(genetic_algorithm)</span>
<span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span>
  generation<span class="token operator">:</span> Generation<span class="token punctuation">,</span>
  fitness<span class="token operator">:</span> FitnessFunction<span class="token punctuation">,</span>
  options<span class="token operator">:</span> SelectionOptions<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    mutationProbability<span class="token punctuation">,</span>
    longLivingChampionsPercentage<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>

  <span class="token keyword">const</span> newGeneration<span class="token operator">:</span> Generation <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> oldGeneration <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>generation<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// First one - the fittest one.</span>
  oldGeneration<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>genomeA<span class="token operator">:</span> Genome<span class="token punctuation">,</span> genomeB<span class="token operator">:</span> Genome<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fitnessA <span class="token operator">=</span> <span class="token function">fitness</span><span class="token punctuation">(</span>genomeA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fitnessB <span class="token operator">=</span> <span class="token function">fitness</span><span class="token punctuation">(</span>genomeB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fitnessA <span class="token operator">&lt;</span> fitnessB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fitnessA <span class="token operator">&gt;</span> fitnessB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Let long-liver champions continue living in the new generation.</span>
  <span class="token keyword">const</span> longLiversCount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>longLivingChampionsPercentage <span class="token operator">*</span> oldGeneration<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>longLiversCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    oldGeneration<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> longLiversCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>longLivingGenome<span class="token operator">:</span> Genome<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      newGeneration<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>longLivingGenome<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Get the data about he fitness of each individuum.</span>
  <span class="token keyword">const</span> fitnessPerOldGenome<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> oldGeneration<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>genome<span class="token operator">:</span> Genome<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fitness</span><span class="token punctuation">(</span>genome<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Populate the next generation until it becomes the same size as a old generation.</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>newGeneration<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> generation<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Select random father and mother from the population.</span>
    <span class="token comment">// The fittest individuums have higher chances to be selected.</span>
    <span class="token keyword">let</span> father<span class="token operator">:</span> Genome <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fatherGenomeIndex<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> mother<span class="token operator">:</span> Genome <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> matherGenomeIndex<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// To produce children the father and mother need each other.</span>
    <span class="token comment">// It must be two different individuums.</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>father <span class="token operator">||</span> <span class="token operator">!</span>mother <span class="token operator">||</span> fatherGenomeIndex <span class="token operator">===</span> matherGenomeIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>
        item<span class="token operator">:</span> randomFather<span class="token punctuation">,</span>
        index<span class="token operator">:</span> randomFatherGenomeIndex<span class="token punctuation">,</span>
      <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">weightedRandom</span><span class="token generic class-name"><span class="token operator">&lt;</span>Genome<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>generation<span class="token punctuation">,</span> fitnessPerOldGenome<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> <span class="token punctuation">{</span>
        item<span class="token operator">:</span> randomMother<span class="token punctuation">,</span>
        index<span class="token operator">:</span> randomMotherGenomeIndex<span class="token punctuation">,</span>
      <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">weightedRandom</span><span class="token generic class-name"><span class="token operator">&lt;</span>Genome<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>generation<span class="token punctuation">,</span> fitnessPerOldGenome<span class="token punctuation">)</span><span class="token punctuation">;</span>

      father <span class="token operator">=</span> randomFather<span class="token punctuation">;</span>
      fatherGenomeIndex <span class="token operator">=</span> randomFatherGenomeIndex<span class="token punctuation">;</span>

      mother <span class="token operator">=</span> randomMother<span class="token punctuation">;</span>
      matherGenomeIndex <span class="token operator">=</span> randomMotherGenomeIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Let father and mother produce two children.</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>firstChild<span class="token punctuation">,</span> secondChild<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mate</span><span class="token punctuation">(</span>father<span class="token punctuation">,</span> mother<span class="token punctuation">,</span> mutationProbability<span class="token punctuation">)</span><span class="token punctuation">;</span>

    newGeneration<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Depending on the number of long-living champions it is possible that</span>
    <span class="token comment">// there will be the place for only one child, sorry.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newGeneration<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> generation<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newGeneration<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>secondChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> newGeneration<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h3 id="fitness-function" style="position:relative">Fitness function<a href="#fitness-function" aria-label="fitness function permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>The fitness of the car will be defined by the distance from the car to the parking spot. The higher the distance, the lower the fitness.</p><p>The final distance we will calculate is an average distance from <code class="language-text">4</code> car wheels to the correspondent <code class="language-text">4</code> corners of the parking spot. This distance we will call the <code class="language-text">loss</code> which is inversely proportional to the <code class="language-text">fitness</code>.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:51.6%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACnklEQVQoz22Ty05TCxSG98ScB1AHZ3IS38Chx4kP4NScqYkTHTgw3jAa44moRajQFipyKZTLpuzdfSlgW7EXKhc5uwVayu69hVJ6UY9EfYLPbJw6+LOy1sq/sr6VLGFovciDuRX+VdexL28zFEsjmw308ifcawW6ZiI8lhLYFj/iju2g5I/wl5s4Q0nu9Exzr1fkqVvBPfcOLd9E6JpYxP5qgH7nEC/6BhjodzAZjKLVv3PfNcXL5924Xw/jcA4y6HQirm4hllrcu3QZ259/4f7jLP2nTtN36gy+aBJhJGowNj3L6LTIkGcSSV9gfjWJtn/MSPjDSW9CUvHKKtrbEP5MFa1xzGi3i/F/riN2PcF77Sbi1ZvIRgHBQlOKbfyFFkqpg1LsoJY+oRRa6JXPaOXPKFZe+8rcbhOXnuChHMH5NoymeZAqTZTDH2iNb6ilDoJl/K2K7ZN7WVEtNFF26/jHepi4cY4N6W+23Oc5GrvI0sdF5ottZLN24hPUQotAqY1eaqNZsgYVWlh1ufoV1TwimNjAnz5gYcWH3neBTOAKZtzOYXicSDaPVv2CXvq1iGAhTqQbTKYPmd1rIpqtX8ilDqGNLeLvwgTMMmqlSSi1y6Y6RTBhIG/m8AbXGdk+wLN9wEy2iWYh25b+427va26/cHGnZ5Bnbg9TcQO90ibxYYEls0y8ss9aKoWWzRPbCBI0drC7hrnb3cutJzYe2V7hGJ9CzlQRetQYg45+vOOjjL0Zxuf1IIZjBGodotkVosYemXwV4+h/1Noxq8YS0ZU49ul5hh123i8vE9A1RHEWaauIIGXrzKxtM7+5i5TMISdzSJka0l6dSEgnmEoRqzeIVffRc0Ui4QBaKofPPMBnmCjpCvJOGX+mcvIQPwFUWW3o4C7zWgAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="The distance from the car to the parking spot" title="The distance from the car to the parking spot" src="/static/7d312047b334eaced870833a6a1e0b75/00d43/08-distance-to-parkin-lot.png" srcSet="/static/7d312047b334eaced870833a6a1e0b75/63868/08-distance-to-parkin-lot.png 250w,/static/7d312047b334eaced870833a6a1e0b75/0b533/08-distance-to-parkin-lot.png 500w,/static/7d312047b334eaced870833a6a1e0b75/00d43/08-distance-to-parkin-lot.png 1000w,/static/7d312047b334eaced870833a6a1e0b75/3ceac/08-distance-to-parkin-lot.png 1456w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>Calculating the distance between each wheel and each corner separately (instead of just calculating the distance from the car center to the parking spot center) will make the car preserve the proper orientation relative to the parking spot.</p><p>The distance between two points in space will be calculated based on the <a href="https://en.wikipedia.org/wiki/Pythagorean_theorem">Pythagorean theorem</a> like this:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">NumVec3</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Calculates the XZ distance between two points in space.</span>
<span class="token comment">// The vertical Y distance is not being taken into account.</span>
<span class="token keyword">const</span> <span class="token function-variable function">euclideanDistance</span> <span class="token operator">=</span> <span class="token punctuation">(</span>from<span class="token operator">:</span> NumVec3<span class="token punctuation">,</span> to<span class="token operator">:</span> NumVec3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fromX <span class="token operator">=</span> from<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fromZ <span class="token operator">=</span> from<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> toX <span class="token operator">=</span> to<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> toZ <span class="token operator">=</span> to<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fromX <span class="token operator">-</span> toX<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>fromZ <span class="token operator">-</span> toZ<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>The distance (the <code class="language-text">loss</code>) between the car and the parking spot will be calculated like this:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">RectanglePoints</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  fl<span class="token operator">:</span> NumVec3<span class="token punctuation">,</span> <span class="token comment">// Front-left</span>
  fr<span class="token operator">:</span> NumVec3<span class="token punctuation">,</span> <span class="token comment">// Front-right</span>
  bl<span class="token operator">:</span> NumVec3<span class="token punctuation">,</span> <span class="token comment">// Back-left</span>
  br<span class="token operator">:</span> NumVec3<span class="token punctuation">,</span> <span class="token comment">// Back-right</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">GeometricParams</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  wheelsPosition<span class="token operator">:</span> RectanglePoints<span class="token punctuation">,</span>
  parkingLotCorners<span class="token operator">:</span> RectanglePoints<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> carLoss <span class="token operator">=</span> <span class="token punctuation">(</span>params<span class="token operator">:</span> GeometricParams<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> wheelsPosition<span class="token punctuation">,</span> parkingLotCorners <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    fl<span class="token operator">:</span> flWheel<span class="token punctuation">,</span>
    fr<span class="token operator">:</span> frWheel<span class="token punctuation">,</span>
    br<span class="token operator">:</span> brWheel<span class="token punctuation">,</span>
    bl<span class="token operator">:</span> blWheel<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> wheelsPosition<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    fl<span class="token operator">:</span> flCorner<span class="token punctuation">,</span>
    fr<span class="token operator">:</span> frCorner<span class="token punctuation">,</span>
    br<span class="token operator">:</span> brCorner<span class="token punctuation">,</span>
    bl<span class="token operator">:</span> blCorner<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> parkingLotCorners<span class="token punctuation">;</span>

  <span class="token keyword">const</span> flDistance <span class="token operator">=</span> <span class="token function">euclideanDistance</span><span class="token punctuation">(</span>flWheel<span class="token punctuation">,</span> flCorner<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> frDistance <span class="token operator">=</span> <span class="token function">euclideanDistance</span><span class="token punctuation">(</span>frWheel<span class="token punctuation">,</span> frCorner<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> brDistance <span class="token operator">=</span> <span class="token function">euclideanDistance</span><span class="token punctuation">(</span>brWheel<span class="token punctuation">,</span> brCorner<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> blDistance <span class="token operator">=</span> <span class="token function">euclideanDistance</span><span class="token punctuation">(</span>blWheel<span class="token punctuation">,</span> blCorner<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>flDistance <span class="token operator">+</span> frDistance <span class="token operator">+</span> brDistance <span class="token operator">+</span> blDistance<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Since the <code class="language-text">fitness</code> should be inversely proportional to the <code class="language-text">loss</code> we&#x27;ll calculate it like this:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> carFitness <span class="token operator">=</span> <span class="token punctuation">(</span>params<span class="token operator">:</span> GeometricParams<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> loss <span class="token operator">=</span> <span class="token function">carLoss</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Adding +1 to avoid a division by zero.</span>
  <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span>loss <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>You may see the <code class="language-text">fitness</code> and the <code class="language-text">loss</code> values for a specific genome and for a current car position on the <a href="https://trekhleb.dev/self-parking-car-evolution?parking=evolution#/">Evolution Simulator</a> dashboard:</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:44.800000000000004%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0klEQVQoz42SyQ7DIAxE+f/fbA+pICxhzaapBpWKpOvhBWNG2B4ijDEYxxE5Z6SU6vqJdt7r+lwIAYIf7z0Sk4+DGOMT7nvOBXpKKRA+BDhrYZSCURLeucOl8zy/sCxL5d2ZkEphuF7gbwPibUByFrmUwyj/wOLU15En7xGZzBkhxuoFobB1s23bT6gTWmtIKWG0Bh+Ie93FXEkr0Pt7pnZIMS9sppJm+rqu2Pe9Vmf8i+ohX3iaJjjnYK09wBxhdxS3gt94/jbNN8ZnmP82aj/yHeCruUrbXw6QAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Evolution simulator dashboard" title="Evolution simulator dashboard" src="/static/1c3f61cc619441e0365b67d01b32729c/00d43/09-fitness-function.png" srcSet="/static/1c3f61cc619441e0365b67d01b32729c/63868/09-fitness-function.png 250w,/static/1c3f61cc619441e0365b67d01b32729c/0b533/09-fitness-function.png 500w,/static/1c3f61cc619441e0365b67d01b32729c/00d43/09-fitness-function.png 1000w,/static/1c3f61cc619441e0365b67d01b32729c/aa440/09-fitness-function.png 1500w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><h2 id="launching-the-evolution" style="position:relative">Launching the evolution<a href="#launching-the-evolution" aria-label="launching the evolution permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>Let&#x27;s put the evolution functions together. We&#x27;re going to &quot;create the world&quot;, launch the evolution loop, make the time going, the generation evolving, and the cars learning how to park.</p><p>To get the fitness values of each car we need to run a simulation of the cars behavior in a virtual 3D world. The <a href="https://trekhleb.dev/self-parking-car-evolution">Evolution Simulator</a> does exactly that - it runs the code below in the simulator, which is <a href="https://github.com/trekhleb/self-parking-car-evolution">made with Three.js</a>:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Evolution setup example.</span>
<span class="token comment">// Configurable via the Evolution Simulator.</span>
<span class="token keyword">const</span> <span class="token constant">GENERATION_SIZE</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">LONG_LIVING_CHAMPIONS_PERCENTAGE</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">MUTATION_PROBABILITY</span> <span class="token operator">=</span> <span class="token number">0.04</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">MAX_GENERATIONS_NUM</span> <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>

<span class="token comment">// Fitness function.</span>
<span class="token comment">// It is like an annual doctor&#x27;s checkup for the cars.</span>
<span class="token keyword">const</span> carFitnessFunction <span class="token operator">=</span> <span class="token punctuation">(</span>genome<span class="token operator">:</span> Genome<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// The evolution simulator calculates and stores the fitness values for each car in the fitnessValues map.</span>
  <span class="token comment">// Here we will just fetch the pre-calculated fitness value for the car in current generation.</span>
  <span class="token keyword">const</span> genomeKey <span class="token operator">=</span> genome<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> fitnessValues<span class="token punctuation">[</span>genomeKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Creating the &quot;world&quot; with the very first cars generation.</span>
<span class="token keyword">let</span> generationIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> generation<span class="token operator">:</span> Generation <span class="token operator">=</span> <span class="token function">createGeneration</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  generationSize<span class="token operator">:</span> <span class="token constant">GENERATION_SIZE</span><span class="token punctuation">,</span>
  genomeLength<span class="token operator">:</span> <span class="token constant">GENOME_LENGTH</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- 180 genes</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Starting the &quot;time&quot;.</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>generationIndex <span class="token operator">&lt;</span> <span class="token constant">MAX_GENERATIONS_NUM</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// SIMULATION IS NEEDED HERE to pre-calculate the fitness values.</span>

  <span class="token comment">// Selecting, mating, and mutating the current generation.</span>
  generation <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span>
    generation<span class="token punctuation">,</span>
    carFitnessFunction<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      mutationProbability<span class="token operator">:</span> <span class="token constant">MUTATION_PROBABILITY</span><span class="token punctuation">,</span>
      longLivingChampionsPercentage<span class="token operator">:</span> <span class="token constant">LONG_LIVING_CHAMPIONS_PERCENTAGE</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Make the &quot;time&quot; go by.</span>
  generationIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Here we may check the fittest individuum of the latest generation.</span>
<span class="token keyword">const</span> fittestCar <span class="token operator">=</span> generation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div><p>After running the <code class="language-text">select()</code> function, the <code class="language-text">generation</code> array is sorted by the fitness values in descending order. Therefore, the fittest car will always be the first car in the array.</p><p><strong>The 1st generation</strong> of cars with random genomes will behave something like this:</p><p><img src="/posts-assets/f14ff147d0f8357d01cea24ca93d01b1/02-cars-before-01.gif" alt="The 1st generation of cars with random genomes"/></p><p><strong>On the ‚âà40th generation</strong> the cars start learning what the self-parking is and start getting closer to the parking spot:</p><p><img src="/posts-assets/a0fd3fcb4932b9c3c8719a74988d29e9/03-car-after-01.gif" alt="The 40th generation start learning how to park"/></p><p>Another example with a bit more challenging starting point:</p><p><img src="/posts-assets/cf87a6ec520ab03a37f1913c58349678/03-car-after-03.gif" alt="More challenging starting point for self-parking"/></p><p>The cars are hitting some other cars along the way, and also are not perfectly fitting the parking spot, but this is only the 40th generation since the creation of the world for them, so you may give the cars some more time to learn.</p><p>From generation to generation we may see how the loss values are going down (which means that fitness values are going up). The <code class="language-text">P50 Avg Loss</code> shows the average loss value (average distance from the cars to the parking spot) of the <code class="language-text">50%</code> of fittest cars. The <code class="language-text">Min Loss</code> shows the loss value of the fittest car in each generation.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:42.4%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQoz22RCQqFMAxEe/+bFsRq3bUaeYGR0v8LcaZNMlkM13XZsix23/dnz/P8oHgbR26M0YZh8HuQ4L7vtm2bo+w8TzdiwFKKC4Hi5MzzbMdxGCfgIJhTJ0iMQPG2IFb7vcNxHN3RVm7x3xtI93CEwaBROdqV9qW31lcXUdwnyCfn7HuYpsmXC1/X1XcLx09h7hSvBYnThC5IyySllNxIYA1wCoAIwRGmYNd11ve9G7EYb2gFzd+ORxf6USycThSn8bRDDl1yfwFY4HNA6/xJ+wAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Loss history" title="Loss history" src="/static/edd62c536dda3ae024670270a28f3285/00d43/10-loss-history-00.png" srcSet="/static/edd62c536dda3ae024670270a28f3285/63868/10-loss-history-00.png 250w,/static/edd62c536dda3ae024670270a28f3285/0b533/10-loss-history-00.png 500w,/static/edd62c536dda3ae024670270a28f3285/00d43/10-loss-history-00.png 1000w,/static/edd62c536dda3ae024670270a28f3285/aa440/10-loss-history-00.png 1500w,/static/edd62c536dda3ae024670270a28f3285/c8ad9/10-loss-history-00.png 1564w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>You may see that on average the <code class="language-text">50%</code> of the fittest cars of the generation are learning to get closer to the parking spot (from <code class="language-text">5.5m</code> away from the parking spot to <code class="language-text">3.5m</code> in 35 generations). The trend for the <code class="language-text">Min Loss</code> values is less obvious (from <code class="language-text">1m</code> to <code class="language-text">0.5m</code> with some noise signals), however from the animations above you may see that cars have learned some basic parking moves.</p><h2 id="conclusion" style="position:relative">Conclusion<a href="#conclusion" aria-label="conclusion permalink" class="gatsby-remark-autolink-header-anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>In this article, we&#x27;ve broken down the high-level task of creating the self-parking car to the straightforward low-level task of finding the optimal combination of <code class="language-text">180</code> ones and zeroes (finding the optimal car genome).</p><p>Then we&#x27;ve applied the genetic algorithm to find the optimal car genome. It allowed us to get pretty good results in several hours of simulation (instead of many years of running the naive approach).</p><p>You may launch the üöï <a href="https://trekhleb.dev/self-parking-car-evolution">Self-parking Car Evolution Simulator</a> to see the evolution process directly in your browser. The simulator gives you the following opportunities:</p><ul><li>You may <a href="https://trekhleb.dev/self-parking-car-evolution?parking=evolution#/">train the cars from scratch</a> and adjust genetic parameters by yourself</li><li>You may <a href="https://trekhleb.dev/self-parking-car-evolution?parking=automatic#/">see the trained self-parking cars in action</a></li><li>You may also <a href="https://trekhleb.dev/self-parking-car-evolution?parking=manual#/">try to park the car manually</a></li></ul><p>The full genetic source code that was shown in this article may also be found in the <a href="https://github.com/trekhleb/self-parking-car-evolution">Evolution Simulator repository</a>. If you are one of those folks who will actually count and check the number of lines to make sure there are less than 500 of them (excluding tests), please feel free to check the code <a href="https://github.com/trekhleb/self-parking-car-evolution/tree/master/src/libs">here</a> ü•∏.</p><p>There are still some <strong>unresolved issues</strong> with the code and the simulator:</p><ul><li>The car&#x27;s brain is oversimplified and it uses linear equations instead of, let&#x27;s say, neural networks. It makes the car not adaptable to the new surroundings or to the new parking lot types.</li><li>We don&#x27;t decrease the car&#x27;s fitness value when the car is hitting the other car. Therefore the car doesn&#x27;t &quot;feel&quot; any guilt in creating the road accident.</li><li>The evolution simulator is not stable. It means that the same car genome may produce different fitness values, which makes the evolution less efficient.</li><li>The evolution simulator is also very heavy in terms of performance, which slows down the evolution progress since we can&#x27;t train, let&#x27;s say, 1000 cars at once.</li><li>Also the Evolution Simulator requires the browser tab to be open and active to perform the simulation.</li><li>and <a href="https://github.com/trekhleb/self-parking-car-evolution/issues">more</a>...</li></ul><p>However, the purpose of this article was to have some fun while learning how the genetic algorithm works and not to build a production-ready self-parking Teslas. So, even with the issues mentioned above, I hope you&#x27;ve had a good time going through the article.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1000px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:34.400000000000006%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4ElEQVQoz0WR3U9SARjGzz/Sf9BdbV15010XdmFuba2uumtu5bJlkKgIgmBgoKU5QBRcng++FMONzWKCUUPCjyMHS8TxZbllW/e/tjOqi3d79tv7Pnv2vIJy2EDuzF8dKTdJbBcIiRJvS1XW6r8RS8dIsQTR7SKRShtFa/27UcpNfU9S6whyB+hmah3l6AcruS94XG76jFYWNlIoCR/LmSzOV/ME/T5WYgkimTxyufU/TMdDkMtNHUhaW4fxSpWljzu8WE0xt7WDHOzD+eASsmjFn9nHZDKxGPCzFAwSLajIlTMiWktPLGlnCNH0e5RUGnkzg1gqEv9aRdFqvDtRSe7nqaz3crFxmczyHd5kVcbng4xarDwzmXF7vaQ/F0lt5Ujl8qx/KiLMzc4ihoMMDz5hxDGJvFchXlaJaVVCuQIWt5GxyUc8NA3g2txFUmvYkllGQmuYrXa8Uy7C4TALgQBRWUawWc0Ynw5wq6eX3u4bGGb8xL6dI6sNRLWJWD4nefyL0F4b8aCuP2y1doF95jW20WEMBiMezxTPh4awT0wgOBwOem52c72ri2tXr3B7zMfiboOo1kA6bJA8avLh9DuJSlPvWDo4JXHyk0HnS+7fu8vj/n4cdjue6Wks4zb+AEZgqm9jsro/AAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Fin" title="Fin" src="/static/2db3aeabaed948b4c0bdf4f361c42b09/00d43/11-fin.png" srcSet="/static/2db3aeabaed948b4c0bdf4f361c42b09/63868/11-fin.png 250w,/static/2db3aeabaed948b4c0bdf4f361c42b09/0b533/11-fin.png 500w,/static/2db3aeabaed948b4c0bdf4f361c42b09/00d43/11-fin.png 1000w,/static/2db3aeabaed948b4c0bdf4f361c42b09/aa440/11-fin.png 1500w" sizes="(max-width: 1000px) 100vw, 1000px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p></article></div><div class="flex flex-row justify-center items-center mt-16"><div class="max-w-md"><div class="bg-white rounded-md shadow-md p-8"><h1 class="text-grey-darkest uppercase font-bold text-xl mb-3">Subscribe to the Newsletter</h1><p class="text-sm mb-3">Get my latest posts and project updates by email</p><form action="https://dev.us1.list-manage.com/subscribe/post?u=7714f14ff32085c685da2cfaa&amp;amp;id=53ffa81463" method="post" class="flex flex-col"><input type="text" placeholder="First Name" name="FNAME" class="border py-2 px-3 mb-3 rounded border-gray-300 border-solid appearance-none" required=""/><input type="email" placeholder="Email" name="EMAIL" class="border py-2 px-3 mb-3 rounded border-gray-300 border-solid appearance-none" required=""/><div class="hidden" aria-hidden="true"><input type="text" name="b_7714f14ff32085c685da2cfaa_53ffa81463" tabindex="-1"/></div><input type="submit" value="Subscribe" class="transition duration-200 ease-in-out bg-black text-white py-2 px-3 rounded shadow-sm cursor-pointer hover:bg-gray-800"/></form></div></div></div></article><footer class="px-6 sm:px-12 py-12"><div class="flex flex-col sm:flex-row items-center "><div style="flex:1" class="flex flex-row items-center mb-6 sm:mb-0"><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 text-xs mr-5" href="/subscribe"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg><span class="w-2"></span>Subscribe</a><a href="https://github.com/trekhleb/trekhleb.github.io/discussions" class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 text-xs mr-5"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="w-2"></span>Feedback</a><a class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 text-xs" href="/rss.xml"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg><span class="w-2"></span>RSS</a></div><div style="flex:1" class="flex flex-row items-center justify-center"><ul class="flex flex-row flex-wrap "><li class="flex flex-row items-center last:mr-0 mr-2 ml-2"><a href="https://www.linkedin.com/in/trekhleb/" class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 " title="Oleksii Trekhleb on LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="flex flex-row items-center last:mr-0 mr-2 ml-2"><a href="https://github.com/trekhleb" class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 " title="Oleksii Trekhleb on GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li><li class="flex flex-row items-center last:mr-0 mr-2 ml-2"><a href="https://twitter.com/Trekhleb" class="transition duration-200 ease-in-out flex flex-row items-center hover:text-red-600 " title="Oleksii Trekhleb on Twitter"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a></li></ul></div><div style="flex:1" class="hidden sm:flex">¬†</div></div></footer></div></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-YJ73BX984Z"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YJ73BX984Z', {"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2021/self-parking-car-evolution/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-30c4ba17a25433b2f0b8.js"],"app":["/app-fdc1157e733f6e22b946.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-7bddcc35cbc5ebb2d643.js"],"component---src-pages-blog-tsx":["/component---src-pages-blog-tsx-09e5ed745cd76684f8ac.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-700f213869b8e0037911.js"],"component---src-pages-projects-tsx":["/component---src-pages-projects-tsx-fe63cc35823f422545d1.js"],"component---src-pages-subscribe-confirm-index-tsx":["/component---src-pages-subscribe-confirm-index-tsx-f0f03729e4a6c8deac2e.js"],"component---src-pages-subscribe-index-tsx":["/component---src-pages-subscribe-index-tsx-74105908ff8e45585a18.js"],"component---src-pages-subscribe-thanks-index-tsx":["/component---src-pages-subscribe-thanks-index-tsx-13232374e4ac47c08c53.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-bb545a793b49d0c28aad.js"],"component---src-templates-project-tsx":["/component---src-templates-project-tsx-523dfb78f07150592d23.js"]};/*]]>*/</script><script src="/polyfill-30c4ba17a25433b2f0b8.js" nomodule=""></script><script src="/component---src-templates-post-tsx-bb545a793b49d0c28aad.js" async=""></script><script src="/commons-eaa46c7810bde7d7eddf.js" async=""></script><script src="/app-fdc1157e733f6e22b946.js" async=""></script><script src="/framework-71606407157990ae5149.js" async=""></script><script src="/webpack-runtime-59f39c0b60ad4f4ae095.js" async=""></script></body></html>